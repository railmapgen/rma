import{j as e,h as he,aq as Re,a1 as V,ak as Z,M as Q,al as N,G as ee,H as ne,J as se,ar as vn,K as j,B as I,an as Y,am as K,T as pe,as as me,b as ge,L as Ue,N as Be,O as dn,ad as Cn,ae as Tn,af as yn,ag as qe,ah as ie,ai as An,aj as ae,Q as y,ao as Mn,ap as oe,at as P,au as Ge,av as Ve,aw as Fe,ax as q,ay as On,az as Ee,aA as Ze,aB as Qe,a0 as Ne,aC as Hn,aD as Pn,k as Dn,W as re,R as Rn,U as En,aE as Wn}from"./chakra-wE9oIWsU.js";import{u as In,r as O,R as hn,a as Ln,b as un,c as Un,d as Bn,e as R,f as F,g as pn,v as je,M as Gn,h as Vn,i as Fn,s as X,p as _n,l as G,n as Yn,j as Xn,k as $n,m as Jn,A as en,o as Kn,q as qn,t as Zn,w as Qn,x as Nn,E as Se,y as es,z as D,B as ns,C as ss,D as ts,F as is,G as as,H as os,I as we,J as nn,K as rs,S as ce,L as ls,N as cs,O as M,V as g,P as sn,Q as tn,T as an,U as on,W as mn,X as gn,Y as xn,Z as ds,_ as jn,$ as Oe,a0 as ke,a1 as hs,a2 as rn,a3 as us,a4 as ps,a5 as ms,a6 as gs,a7 as xs,a8 as js,a9 as fs,aa as bs,ab as ws,ac as zs}from"./index-Cu7io_6-.js";import{a as We,m as B,d as T,T as ln}from"./react-DFJlY5Ze.js";import{R as ks}from"./rmg-output-3U3NKduu.js";var Ie=function(s){return In(O.ready(),s)};function He(s){var i=s.fields,r=s.noLabel,n=s.minW;return e.jsx(he,{wrap:"wrap",children:i.map(function(a,d){if(a.hidden)return e.jsx(We.Fragment,{},d);var h=a.minW||n,u=h==="full";return e.jsx(hn,{className:u?"mw-full":"",label:a.label,flex:u?void 0:1,minW:u?void 0:h,noLabel:r,oneLine:a.oneLine,helper:a.helper,errorMessage:a.errorMessage,children:function(t){switch(t.type){case"input":return e.jsx(Bn,{placeholder:t.placeholder,defaultValue:t.value,type:t.variant,validator:t.validator,onDebouncedChange:t.onChange,delay:t.debouncedDelay,optionList:t.optionList,isDisabled:t.isDisabled});case"output":return e.jsx(ks,{noWrap:t.noWrap,children:t.value});case"textarea":return e.jsx(Un,{placeholder:t.placeholder,defaultValue:t.value,onDebouncedChange:t.onChange,isDisabled:t.isDisabled});case"slider":return e.jsx(un,{defaultValue:t.value,min:t.min,max:t.max,step:t.step,onThrottledChange:t.onChange,leftIcon:t.leftIcon,rightIcon:t.rightIcon,isDisabled:t.isDisabled});case"select":return e.jsx(Ln,{defaultValue:t.value,onChange:function(p){var x,o=p.target.value;return(x=t.onChange)===null||x===void 0?void 0:x.call(t,typeof t.value=="number"?Number(o):o.toString())},options:t.options,disabledOptions:t.disabledOptions,isInvalid:t.isInvalid,isDisabled:t.isDisabled});case"switch":return e.jsx(Re,{isChecked:t.isChecked,isDisabled:t.isDisabled,onChange:function(p){var x,o=p.target.checked;return(x=t.onChange)===null||x===void 0?void 0:x.call(t,o)}});case"custom":return t.component;default:return e.jsx("div",{})}}(a)},d)})})}var Ss={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const vs=()=>{const s=navigator.platform.toLowerCase();return s.includes("win")?"win":s.includes("android")?"android":s.includes("mac")?"mac":s.includes("iphone")||s.includes("ipad")?"ios":s.includes("linux")?"linux":"unknown"},Cs=vs();function Ts(){const{reconciledPhrases:s,currentStyle:i,currentStationID:r,currentStage:n,currentVoice:a}=R(b=>b.runtime),{preference:{previewAudio:d}}=R(b=>b.app),h=F(),{t:u}=B(),[t,p]=T.useState(!1),[x,o]=T.useState(!1),c=pn();T.useEffect(()=>{var A,S;const b=(S=(A=je[i])==null?void 0:A.defaultLang)==null?void 0:S[a],C=c.find(l=>l.lang===b);o(!!C)},[a,c]);const w=()=>{var _,U,L,z,H,W,$,ue,ve;h(X({status:"info",message:u("header.paly.previewWarning")}));const b=window.speechSynthesis;if(b.paused&&b.speaking){p(!0),b.resume();return}const C=(U=(_=s[r])==null?void 0:_[n])==null?void 0:U[a],A=_n(C!=null?C:[]),S=A===""?" ":A,l=new SpeechSynthesisUtterance(S),m=(W=d[a])!=null?W:(H=(z=(L=je[i])==null?void 0:L.preferredPreviewVoiceName)==null?void 0:z[a])==null?void 0:H[Cs],f=b.getVoices().find(Ye=>Ye.name===m),E=(ue=($=je[i])==null?void 0:$.defaultLang)==null?void 0:ue[a];if(f)l.voice=f;else if(E)l.lang=E;else{G.error("Preview language not found for",a);return}l.onend=()=>{p(!1)},p(!0),G.debug('Previewing audio "'.concat(S,'" with ').concat((ve=l.voice)==null?void 0:ve.name)),b.speak(l)},k=()=>{window.speechSynthesis.pause(),p(!1)};return e.jsx(V,{size:"sm",variant:"ghost","aria-label":"Settings",icon:x?t?e.jsx(Gn,{}):e.jsx(Vn,{}):e.jsx(Fn,{}),isDisabled:!x,onClick:t?k:w})}const ys=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B(),a=O.getAppVersion();return e.jsxs(Z,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(ee,{children:n("header.about.title")}),e.jsx(ne,{}),e.jsxs(se,{paddingBottom:10,children:[e.jsxs(he,{direction:"row",children:[e.jsx(vn,{boxSize:"128px",src:"/rma//logo192.png"}),e.jsxs(he,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(j,{fontSize:"xl",as:"b",children:n("header.about.rma")}),e.jsx(j,{children:a}),e.jsx(j,{}),e.jsx(j,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(I,{margin:5,children:e.jsx(j,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(Y,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx(K,{children:e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(j,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(j,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]})}),e.jsx(Y,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs(K,{children:[e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(j,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(j,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(j,{fontSize:"sm",as:"i",children:"#rma, #rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(Y,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),e.jsxs(K,{children:[e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",pb:1,children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),e.jsx(j,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",pb:1,children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),e.jsx(j,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function fe(s){const i=s.sizes.shift(),r=Math.max(Math.ceil(i[0]),1),n=Math.max(Math.ceil(i[1]),1),a=[r-1,n-1,1,1],d=performance.now(),h=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let u,t;h?(u=new OffscreenCanvas(1,1),t=new OffscreenCanvas(r,n)):(u=document.createElement("canvas"),u.width=1,u.height=1,t=document.createElement("canvas"),t.width=r,t.height=n);const p=u.getContext("2d"),x=t.getContext("2d");x&&(x.fillRect.apply(x,a),p.drawImage(t,r-1,n-1,1,1,0,0,1,1));const o=p&&p.getImageData(0,0,1,1).data[3]!==0,c=parseInt(performance.now()-d);return[u,t].forEach(w=>{w.height=0,w.width=0}),h?(postMessage({width:r,height:n,testTime:c,isTestPass:o}),!o&&s.sizes.length&&setTimeout(()=>{fe(s)},0)):o?s.onSuccess({width:r,height:n,testTime:c}):(s.onError({width:r,height:n,testTime:c}),s.sizes.length&&setTimeout(()=>{fe(s)},0)),o}const Pe={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},de={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},xe={};function De(s){const i=s.width===s.height,r=s.height===1,n=s.width===1,a=[];if(!s.width||!s.height)s.sizes.forEach(d=>{const h=i||r?d:1,u=i||n?d:1;a.push([h,u])});else{const d=s.min||de.min,h=s.step||de.step;let u=Math.max(s.width,s.height);for(;u>=d;){const t=i||r?u:1,p=i||n?u:1;a.push([t,p]),u-=h}}return a}function ze(s){const i=typeof window<"u",r=i&&"Promise"in window,n=i&&"HTMLCanvasElement"in window,a=i&&"OffscreenCanvas"in window,d=URL.createObjectURL(new Blob([])).slice(-36),h=performance.now(),{onError:u,onSuccess:t,...p}=s,x=()=>parseInt(performance.now()-h);let o=null;if(!n)return!1;if(s.useWorker&&a){const c="\n            var canvasTest = ".concat(fe.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),w=new Blob([c],{type:"application/javascript"}),k=URL.createObjectURL(w);o=new Worker(k),URL.revokeObjectURL(k),o.onmessage=function(b){const{width:C,height:A,testTime:S,isTestPass:l}=b.data,m={width:C,height:A,testTime:S,totalTime:x()};l?(xe[d].onSuccess(m),delete xe[d]):xe[d].onError(m)}}if(r)return new Promise(c=>{const w={...s,onError(k){let{width:b,height:C,testTime:A}=k;const S={width:b,height:C,testTime:A,totalTime:x()};let l;if(s.sizes.length===0)l=!0;else{const[[m,f]]=s.sizes.slice(-1);l=b===m&&C===f}u(S),l&&c({...S,success:!1})},onSuccess(k){let{width:b,height:C,testTime:A}=k;const S={width:b,height:C,testTime:A,totalTime:x()};t(S),c({...S,success:!0})}};if(o){const{onError:k,onSuccess:b}=w;xe[d]={onError:k,onSuccess:b},o.postMessage(p)}else fe(w)});if(o)xe[d]={onError:u,onSuccess:t},o.postMessage(p);else return fe(s)}const As={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=De({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...Pe.area]}),r={...de,...s,sizes:i};return ze(r)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=De({width:1,height:s.max,min:s.min,step:s.step,sizes:[...Pe.height]}),r={...de,...s,sizes:i};return ze(r)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=De({width:s.max,height:1,min:s.min,step:s.step,sizes:[...Pe.width]}),r={...de,...s,sizes:i};return ze(r)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={...de,...s};return i.sizes=[...i.sizes],i.width&&i.height&&(i.sizes=[[i.width,i.height]]),ze(i)}},Le=(s,i,r)=>{const n=new Blob([r],{type:i});_e(s,n)},_e=(s,i)=>{const r=window.URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)},Ms=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B(),a=F(),{reconciledPhrases:d}=R(t=>t.runtime),{points:h}=R(t=>t.audio),u=Object.keys(d).length*100;return e.jsxs(Z,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(ee,{children:n("header.audioTask.new.title")}),e.jsx(ne,{}),e.jsxs(se,{paddingBottom:10,children:[e.jsx(j,{children:n("header.audioTask.new.content1")}),e.jsxs(j,{children:[n("header.audioTask.new.content2"),u]}),e.jsx(j,{children:n("header.audioTask.new.content3")}),e.jsx(j,{children:n("header.audioTask.new.content4")})]}),e.jsx(Ue,{children:e.jsx(Be,{style:{alignSelf:"center"},onClick:()=>a(Yn()),isDisabled:h<u,children:n("header.audioTask.new.create")})})]})]})},Os=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B(),a=F(),{telemetry:{project:d}}=R(l=>l.app),{tasks:h,points:u}=R(l=>l.audio),{rmtToken:t,reconciledPhrases:p}=R(l=>l.runtime),{project:x}=R(l=>l.param),{style:o,metadata:c}=x,w=O.isAllowAnalytics(),k=dn("primary.500","primary.300"),[b,C]=T.useState(!1);T.useEffect(()=>{i&&a(Xn())},[i]);const A=async l=>{const m=await Qn("".concat(Nn.AUDIOTASKS,"/").concat(l,"/download"),{},t);if(!m||!m.ok)throw new Error("Download error");_e("".concat(l,".zip"),await m.blob())},S=()=>{w&&O.event(Se.DOWNLOAD_TEXT,d?{style:o,"#stations":Object.keys(c).length}:{});const l=es(p);Le("RMA_".concat(new Date().valueOf(),".txt"),"text/plain",l.join("\n"))};return e.jsxs(Z,{isOpen:i,onClose:r,size:"4xl",scrollBehavior:"inside",children:[e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(ee,{children:n("header.download.audio")}),e.jsx(ne,{}),e.jsxs(se,{paddingBottom:10,children:[e.jsx(j,{fontSize:"lg",mb:"4",children:n("header.audioTask.desc")}),e.jsx(j,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleZH")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-zh.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),e.jsx(j,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleEN")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-en.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),t?e.jsxs(e.Fragment,{children:[e.jsxs(he,{pl:"4",pr:"4",mt:"10",mb:"4",children:[e.jsx(j,{as:"b",fontSize:"4xl",children:u}),e.jsx(j,{style:{alignSelf:"self-end",marginLeft:"10px"},children:"pts"}),e.jsx(he,{style:{flex:1}}),e.jsx(j,{as:"b",style:{alignSelf:"self-end"},children:n("header.audioTask.title")}),e.jsx(he,{style:{flex:1}}),e.jsx(V,{icon:e.jsx($n,{}),variant:"ghost",style:{alignSelf:"center"},"aria-label":n("header.audioTask.topUp"),isDisabled:!0}),e.jsx(V,{icon:e.jsx(Jn,{}),variant:"ghost",style:{alignSelf:"center"},"aria-label":n("header.audioTask.new.title"),onClick:()=>C(!0)}),e.jsx(Ms,{isOpen:b,onClose:()=>C(!1)})]}),e.jsx(Cn,{height:"100%",overflowY:"auto",children:e.jsxs(Tn,{variant:"simple",height:"100%",children:[e.jsx(yn,{children:e.jsxs(qe,{children:[e.jsx(ie,{children:n("header.audioTask.table.id")}),e.jsx(ie,{children:n("header.audioTask.table.status")}),e.jsx(ie,{children:n("header.audioTask.table.createdAt")}),e.jsx(ie,{children:n("header.audioTask.table.updatedAt")}),e.jsx(ie,{children:n("header.audioTask.table.points")}),e.jsx(ie,{children:n("header.audioTask.table.actions")})]})}),e.jsx(An,{children:h.map(({id:l,status:m,createdAt:f,updatedAt:E,points:_})=>e.jsxs(qe,{children:[e.jsx(ae,{children:l}),e.jsx(ae,{children:m}),e.jsx(ae,{children:new Date(f).toLocaleString()}),e.jsx(ae,{children:new Date(E).toLocaleString()}),e.jsx(ae,{children:_}),e.jsxs(ae,{children:[m===en.CREATED&&e.jsx(V,{icon:e.jsx(qn,{}),"aria-label":n("Cancel Task"),onClick:()=>a(Kn(l))}),m===en.COMPLETED&&e.jsx(V,{icon:e.jsx(Zn,{}),"aria-label":n("Download Audio"),onClick:()=>A(l)})]})]},l))})]})})]}):e.jsx(j,{mt:"10",textAlign:"center",children:n("header.audioTask.loginFirst")}),e.jsx(K,{mt:10,children:e.jsxs(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[n("header.audioTask.freeInternet1"),e.jsx(y,{color:k,fontSize:"sm",lineHeight:"100%",onClick:S,children:n("header.audioTask.freeInternet2")}),n("header.audioTask.freeInternet3")]})})]})]})]})},Hs=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B();return e.jsxs(Z,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(ee,{children:n("header.download.termsAndConditions")}),e.jsx(ne,{}),e.jsx(se,{children:e.jsxs(Mn,{children:[e.jsxs(oe,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(y,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(P,{as:D})]}),", ",e.jsxs(y,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(P,{as:D})]})," or ",e.jsxs(y,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(P,{as:D})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(y,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(P,{as:D})]}),"，",e.jsxs(y,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(P,{as:D})]}),"或",e.jsxs(y,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(P,{as:D})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(oe,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(y,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(P,{as:D})]})," and ",e.jsxs(y,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(P,{as:D})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(y,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(P,{as:D})]}),"及",e.jsxs(y,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(P,{as:D})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(oe,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(y,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(P,{as:D})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(y,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(P,{as:D})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(oe,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(oe,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(y,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(P,{as:D})]})," ","– the open-source emoji and icon project. License:",e.jsxs(y,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(P,{as:D})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(y,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(P,{as:D})]}),"所设计。许可证：",e.jsxs(y,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(P,{as:D})]})]}),e.jsxs(oe,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Ps(){const{telemetry:{project:s}}=R(v=>v.app),i=F(),{realColumns:r}=R(v=>v.crawl),{project:n}=R(v=>v.param),{reconciledPhrases:a,currentStationID:d,currentStage:h,currentVoice:u}=R(v=>v.runtime),{isModalOpen:t}=R(v=>v.audio),{style:p,metadata:x}=n,o=O.isAllowAnalytics(),{t:c}=B(),[w,k]=T.useState("png"),b={png:c("header.download.png"),svg:c("header.download.svg")},[C,A]=T.useState({width:1,height:1,benchmark:.001}),[S,l]=T.useState(200),m=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],f=Object.fromEntries(m.map(v=>[v,"".concat(v,"%")])),[E,_]=T.useState([]),U=[{type:"select",label:c("header.download.format"),value:w,options:b,onChange:v=>k(v==="png"?"png":"svg")}],L=[],z=[{type:"select",label:c("header.download.scale"),value:S,options:f,disabledOptions:E,onChange:v=>l(v)}],[H,W]=T.useState(!1),[$,ue]=T.useState(!1),[ve,Ye]=T.useState(!1),[Xe,bn]=T.useState(!1);T.useEffect(()=>{(async()=>{const te=await As.maxArea({usePromise:!0,useWorker:!0});A(te)})()},[]),T.useEffect(()=>{if(H){const[v,te]=[r*we*S/100,nn*we*S/100],Ce=m.filter(J=>v*J/100>C.width||te*J/100>C.height);_(Ce)}},[H]);const wn=()=>{o&&O.event(Se.DOWNLOAD_PARAM,s?{style:p,"#stations":Object.keys(x).length}:{}),Le("RMA_".concat(new Date().valueOf(),".json"),"application/json",JSON.stringify(n,null,2))},zn=()=>{var Je,Ke;const v=(Ke=(Je=a[d])==null?void 0:Je[h])==null?void 0:Ke[u],te=rs(v!=null?v:[]),Ce=te===""?" ":te,J=document.getElementById("crawl").cloneNode(!0),$e=J.outerHTML;if(w==="svg"){Le("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",$e);return}document.body.appendChild(J);const kn="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent($e)));document.body.removeChild(J),J.remove();const be=document.createElement("canvas"),[Te,ye]=[r*we*S/100,nn*we*S/100];be.width=Te,be.height=ye;const Ae=be.getContext("2d");Ae.fillStyle="black",Ae.fillRect(0,0,Te,ye);const Me=new Image;Me.onload=()=>{setTimeout(()=>{Ae.drawImage(Me,0,0,Te,ye),be.toBlob(Sn=>{_e("RMA_".concat(Ce,".png"),Sn)},"image/png")},0)},Me.src=kn};return e.jsxs(Ge,{id:"download",children:[e.jsx(Ve,{as:V,size:"sm",variant:"ghost",icon:e.jsx(ns,{})}),e.jsxs(Fe,{children:[e.jsx(q,{icon:e.jsx(ss,{}),onClick:wn,children:c("header.download.config")}),e.jsx(q,{icon:e.jsx(ts,{}),onClick:()=>W(!0),children:c("header.download.image")}),e.jsx(q,{icon:e.jsx(as,{}),onClick:()=>i(is()),children:c("header.download.audio")})]}),e.jsxs(Z,{size:"xl",isOpen:H,onClose:()=>W(!1),children:[e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(ee,{children:c("header.download.image")}),e.jsx(ne,{}),e.jsxs(se,{children:[e.jsx(He,{fields:U}),w==="svg"&&e.jsx(He,{fields:L}),w==="png"&&e.jsx(He,{fields:z}),w==="png"&&E.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(j,{as:"i",fontSize:"sm",children:c("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(j,{as:"i",fontSize:"sm",children:c("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(y,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(P,{as:D})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(On,{isChecked:Xe,onChange:v=>bn(v.target.checked),children:e.jsxs(j,{children:[c("header.download.termsAndConditionsInfo"),e.jsxs(y,{color:"teal.500",onClick:()=>ue(!0),children:[c("header.download.termsAndConditions")," ",e.jsx(P,{as:D})]}),c("header.download.period")]})})]}),e.jsx(Ue,{children:e.jsx(Ee,{children:e.jsx(Be,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Xe||w==="png"&&E.includes(S),onClick:zn,children:c("header.download.confirm")})})}),e.jsx(Hs,{isOpen:$,onClose:()=>ue(!1)})]})]}),e.jsx(Os,{isOpen:t,onClose:()=>i(os())})]})}const fn=s=>{var a,d,h,u;const i=["linestart"],r=[["linestart"]];let n=0;for(;i.length;){let t=i.shift(),p=r[n].slice(-1)[0]||null;for(p&&t!=="linestart"?r[n].push(t):r[n]=[t];t!=="lineend";){p=t;const x=s[p].children;switch(x.length){case 1:t=x[0];break;case 2:{const o=s[p].branch.right,c=o[1];o[0]==="through"?(r.push(r[n].slice()),i.push(c)):n===0&&(r.push([p]),i.push(c)),t=x.filter(w=>w!==c)[0];break}}if(r[n].push(t),p===((d=(a=s[t].branch)==null?void 0:a.left)==null?void 0:d[1])&&((u=(h=s[t].branch)==null?void 0:h.left)==null?void 0:u[0])==="nonthrough")break}n++}return r},Ds=(s,i,r="left",n="left",a,d=!0,h=!1,u="none",t=!1,p=ce.local)=>({[M.Arrival]:{[g.ChineseWuSimplifiedXiaotong]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:r,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[g.ChineseMandarinSimplified]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:r,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[g.ChineseWuSimplifiedYunzhe]:{terminal:s.en,terminalPinyin:s.en,doorDirection:r,thanksForTaking:a==null?void 0:a.at(1),thanksForTakingPinyin:a==null?void 0:a.at(1)}},[M.Departure]:{[g.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:d,loop:u,loopTerminal:t,service:p},[g.ChineseMandarinSimplified]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:d,loop:u,loopTerminal:t,service:p},[g.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:a==null?void 0:a.at(1),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.en,terminalPinyin:s.en,nextDoorDirection:n,lineName:i[1],lineNamePinyin:i[1],service:p}},[M.Midway]:{[g.ChineseWuSimplifiedXiaotong]:{caution:h},[g.ChineseMandarinSimplified]:{caution:h},[g.ChineseWuSimplifiedYunzhe]:{}}}),le=s=>{for(const i in s)s[i]=s[i].replaceAll("\\"," ").replaceAll("\n"," ");return s},Rs=(s,i,r=ce.local)=>{var A,S,l;const n=structuredClone(ls),{line_name:a,stn_list:d,loop:h,direction:u}=s,t="left",p="left",x=fn(d).map(m=>m.slice(1,-1));u===cs.left&&x.forEach(m=>m.reverse());let o=(A=x.at(i))!=null?A:x.at(-1);r!==ce.local&&(o=o.filter(m=>d[m].services.includes(r)));const c=o,w=new Set(c.map(m=>d[m].services).flat()),k=c.at(-1),b=x.map(m=>m[m.length-1]).find(m=>m!==k),{localisedName:C}=d[k];le(C),n.baseVariants=Ds(C,a,t,p,void 0,void 0,void 0,h?"inner":"none",!1,w.has(r)?r:ce.local);for(const[m,f]of c.entries()){const{localisedName:E}=d[f];if(le(E),n.metadata[f]={name:(S=Object.values(E).at(0))!=null?S:""},n.stations[f]={},n.stations[f][M.Midway]={[g.ChineseWuSimplifiedXiaotong]:{},[g.ChineseMandarinSimplified]:{},[g.ChineseWuSimplifiedYunzhe]:{}},m!==0&&(n.stations[f][M.Arrival]={[g.ChineseWuSimplifiedXiaotong]:{name:E.zh,namePinyin:E.zh},[g.ChineseMandarinSimplified]:{name:E.zh,namePinyin:E.zh},[g.ChineseWuSimplifiedYunzhe]:{name:E.en,namePinyin:E.en}}),m!==c.length-1||h){const _=h&&m===c.length-1?c[0]:c[m+1],{localisedName:U}=d[_];le(U);const L=d[_].transfer.groups.map(z=>{var H;return(H=z.lines)==null?void 0:H.map(W=>W.name)}).filter(z=>z!==void 0);if(n.stations[f][M.Departure]={[g.ChineseWuSimplifiedXiaotong]:{next:U.zh,nextPinyin:U.zh,int:L==null?void 0:L.map(z=>z==null?void 0:z.map(H=>H[0]))},[g.ChineseMandarinSimplified]:{next:U.zh,nextPinyin:U.zh,int:L==null?void 0:L.map(z=>z==null?void 0:z.map(H=>H[0]))},[g.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:!1,next:U.en,nextPinyin:U.en,int:L==null?void 0:L.map(z=>z==null?void 0:z.map(H=>H[1])),noteLastTrain:!1}},b&&m+1<c.length&&((l=d[c[m+1]].branch)!=null&&l[u==="l"?sn.left:sn.right])){const{localisedName:z}=d[b];le(z),n.stations[f][M.Departure][g.ChineseWuSimplifiedXiaotong]={...n.stations[f][M.Departure][g.ChineseWuSimplifiedXiaotong],branchTerminalName:z.zh,branchTerminalNamePinyin:z.zh},n.stations[f][M.Departure][g.ChineseMandarinSimplified]={...n.stations[f][M.Departure][g.ChineseMandarinSimplified],branchTerminalName:z.zh,branchTerminalNamePinyin:z.zh},n.stations[f][M.Departure][g.ChineseWuSimplifiedYunzhe]={...n.stations[f][M.Departure][g.ChineseWuSimplifiedYunzhe],branchTerminalName:z.en,branchTerminalNamePinyin:z.en}}if(r!==ce.local){const H=c.slice(m+1,-1).map(W=>{const{localisedName:$}=d[W];return le($),$});n.stations[f][M.Departure][g.ChineseWuSimplifiedXiaotong]={...n.stations[f][M.Departure][g.ChineseWuSimplifiedXiaotong],stopovers:H.map(W=>W.zh)},n.stations[f][M.Departure][g.ChineseMandarinSimplified]={...n.stations[f][M.Departure][g.ChineseMandarinSimplified],stopovers:H.map(W=>W.zh)},n.stations[f][M.Departure][g.ChineseWuSimplifiedYunzhe]={...n.stations[f][M.Departure][g.ChineseWuSimplifiedYunzhe],stopovers:H.map(W=>W.en)}}}}if(h){const m=c[0],{localisedName:f}=d[m];le(f),n.stations[m][M.Arrival]={[g.ChineseWuSimplifiedXiaotong]:{name:f.zh,namePinyin:f.zh,doorDirection:t},[g.ChineseMandarinSimplified]:{name:f.zh,namePinyin:f.zh,doorDirection:t},[g.ChineseWuSimplifiedYunzhe]:{name:f.en,namePinyin:f.en,doorDirection:t}}}return n},Es=()=>{var x;const{t:s}=B(),i=F(),r=O.isAllowAnalytics(),{rmgParam:n,route:a,service:d}=R(o=>o.import),h=n?fn(n.stn_list).map(o=>[o.at(1),o.at(-2)]):[],u=n?h.map(o=>o.map(c=>Object.values(n.stn_list[c].localisedName).join(" "))):[],t=new Set(Object.values((x=n==null?void 0:n.stn_list)!=null?x:{}).map(o=>o.services).flat()),p=()=>{if(n){r&&O.event(Se.IMPORT_RMG_PARAM);try{const o=Rs(structuredClone(n),a,d);i(mn(o)),i(gn(Object.keys(o.metadata)[0])),i(xn(M.Departure))}catch(o){i(X({status:"error",message:s("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",o)}finally{i(on()),i(tn(0)),i(an(ce.local))}}};return e.jsxs(Z,{isOpen:n!==void 0,onClose:()=>i(on()),size:"lg",children:[e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(ee,{children:s("import.title")}),e.jsx(ne,{color:"white"}),e.jsxs(se,{py:3,children:[h.length===1&&t.size===1&&e.jsx(j,{children:s("import.goodToGo")}),h.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{fontSize:"md",mb:4,children:s("import.routes")}),e.jsx(Ze,{onChange:o=>i(tn(Number(o))),value:a.toString(),children:e.jsx(Ee,{spacing:4,align:"stretch",children:u.map((o,c)=>e.jsx(I,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:a===c?"blue.500":"gray.200",children:e.jsx(Qe,{value:c.toString(),colorScheme:"blue",children:e.jsx(K,{align:"start",spacing:1,ml:2,children:e.jsx(j,{fontSize:"sm",children:o.join(" <=> ")})})})},c))})})]}),t.size>1&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{fontSize:"md",mb:4,children:s("import.services")}),e.jsx(Ze,{onChange:o=>i(an(o)),value:d,children:e.jsx(Ee,{spacing:4,align:"stretch",children:[...t].map(o=>e.jsx(I,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:d===o?"blue.500":"gray.200",children:e.jsx(Qe,{value:o,colorScheme:"blue",children:e.jsx(K,{align:"start",spacing:1,ml:2,children:e.jsx(j,{fontSize:"sm",children:s("import.service.".concat(o))})})})},o))})})]})]}),e.jsx(Ue,{children:e.jsx(Be,{colorScheme:"teal",variant:"outline",onClick:p,children:s("import.import")})})]})]})},Ws="rmg-bridge--",Is={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Ls(s){const{isOpen:i,onClose:r}=s,{t:n}=B(),a=F(),[d]=We.useState(crypto.randomUUID()),h="/rmg/#/import?"+new URLSearchParams({parentComponent:O.getAppName(),parentId:d}),u=t=>{try{a(jn(t))}catch(p){a(X({status:"error",message:n("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",p)}finally{r()}};return We.useEffect(()=>{const t=new BroadcastChannel(Ws+d);return t.onmessage=p=>{const{event:x,data:o}=p.data;G.info("Received event from RMG app clip:",x),x==="CLOSE"?r():x==="IMPORT"&&u(o)},()=>t.close()},[]),e.jsx(ds,{isOpen:i,onClose:r,sx:Is,children:e.jsx("iframe",{src:h,loading:"lazy"})})}function Us(){const s=F(),{t:i}=B(),{preference:{import:{route:r,service:n}}}=R(o=>o.app),a=Ie(O.getEnv),d=T.useRef(null),h=T.useRef(null),[u,t]=T.useState(!1),p=async o=>{var w;const c=(w=o.target.files)==null?void 0:w[0];if(G.info("OpenActions.handleUpload():: received file",c),(c==null?void 0:c.type)!=="application/json")s(X({status:"error",message:i("header.open.invalidType")})),G.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const k=await cn(c),b=JSON.parse(k);if(!("baseVariants"in b)){s(X({status:"error",message:i("header.open.invalidType")})),G.error("OpenActions.handleUpload():: Not a valid RMA project."),o.target.value="";return}s(mn(b)),s(gn(Object.keys(b.metadata)[0])),s(xn(M.Departure))}catch(k){s(X({status:"error",message:i("header.open.unknownError")})),G.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",k)}o.target.value=""},x=async o=>{var w;const c=(w=o.target.files)==null?void 0:w[0];if(G.info("OpenActions.handleUpload():: received file",c),(c==null?void 0:c.type)!=="application/json")s(X({status:"error",message:i("header.open.invalidType")})),G.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const k=await cn(c);s(jn(JSON.parse(k)))}catch(k){s(X({status:"error",message:i("header.open.unknownError")})),G.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",k)}o.target.value=""};return e.jsxs(Ge,{children:[e.jsx(Ve,{as:V,size:"sm",variant:"ghost",icon:e.jsx(Oe,{})}),e.jsxs(Fe,{children:[e.jsx("input",{id:"upload_project",ref:d,type:"file",accept:".json",hidden:!0,onChange:p,"data-testid":"file-upload"}),e.jsx(q,{icon:e.jsx(Oe,{}),onClick:()=>{var o;return(o=d==null?void 0:d.current)==null?void 0:o.click()},children:i("header.open.config")}),e.jsx("input",{id:"upload_RMG",ref:h,type:"file",accept:".json",hidden:!0,onChange:x,"data-testid":"file-upload"}),a===ke.DEV&&e.jsx(q,{icon:e.jsx(Oe,{}),onClick:()=>{var o;return(o=h==null?void 0:h.current)==null?void 0:o.click()},children:i("header.open.RMG")}),e.jsx(q,{icon:e.jsx(hs,{}),onClick:()=>t(!0),children:i("header.open.projectRMG")})]}),e.jsx(Ls,{isOpen:u,onClose:()=>t(!1)})]})}const cn=s=>new Promise(i=>{const r=new FileReader;r.onloadend=()=>i(r.result),r.readAsText(s)}),Bs=s=>{var A,S;const{isOpen:i,onClose:r}=s,{telemetry:{project:n},preference:{import:{route:a,service:d},previewAudio:h}}=R(l=>l.app),u=F(),{t}=B(),p=dn("primary.500","primary.300"),{scale:x}=R(l=>l.crawl),o=pn(),[c,w]=T.useState({[g.ChineseMandarinSimplified]:[],[g.ChineseWuSimplifiedXiaotong]:[],[g.ChineseWuSimplifiedYunzhe]:[]});T.useEffect(()=>{w({[g.ChineseMandarinSimplified]:o.filter(l=>{var m,f;return l.lang===((f=(m=je[rn.ShanghaiMetro])==null?void 0:m.defaultLang)==null?void 0:f[g.ChineseMandarinSimplified])}).map(l=>l.name),[g.ChineseWuSimplifiedXiaotong]:[],[g.ChineseWuSimplifiedYunzhe]:o.filter(l=>{var m,f;return l.lang===((f=(m=je[rn.ShanghaiMetro])==null?void 0:m.defaultLang)==null?void 0:f[g.ChineseWuSimplifiedYunzhe])}).map(l=>l.name)})},[o]);const k=(l,m)=>{u(m==="undefined"?ps(l):ms([l,m]))},b=O.isAllowAnalytics(),C=l=>{u(gs(l))};return e.jsxs(Z,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(ee,{children:t("header.settings.title")}),e.jsx(ne,{}),e.jsx(se,{children:e.jsxs(K,{divider:e.jsx(Pn,{borderColor:"gray.200"}),children:[e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(Y,{fontSize:"md",children:t("header.settings.crawl.title")}),e.jsx(I,{mt:"3",children:e.jsx(hn,{label:t("header.settings.crawl.scale"),children:e.jsx(un,{defaultValue:x,value:x,min:.1,max:1,step:.1,onThrottledChange:l=>u(us(l))})})})]}),e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(Y,{fontSize:"md",children:t("header.settings.previewAudio.title")}),e.jsxs(I,{mt:"3",children:[e.jsxs(I,{mb:"1",display:"flex",children:[e.jsx(j,{flex:"1",children:t("header.settings.previewAudio.shmetro-zh")}),e.jsxs(Ne,{size:"xs",width:"300px",ml:"1",defaultValue:(A=h[g.ChineseMandarinSimplified])!=null?A:"undefined",onChange:({target:{value:l}})=>k(g.ChineseMandarinSimplified,l),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),c[g.ChineseMandarinSimplified].map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs(I,{mb:"1",display:"flex",children:[e.jsx(j,{flex:"1",children:t("header.settings.previewAudio.shmetro-en")}),e.jsxs(Ne,{size:"xs",width:"300px",ml:"1",defaultValue:(S=h[g.ChineseWuSimplifiedYunzhe])!=null?S:"undefined",onChange:({target:{value:l}})=>k(g.ChineseWuSimplifiedYunzhe,l),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),c[g.ChineseWuSimplifiedYunzhe].map(l=>e.jsx("option",{value:l,children:l},l))]})]})]})]}),e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(Y,{fontSize:"md",children:t("header.settings.telemetry.title")}),e.jsxs(I,{mt:"3",children:[e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.info")}),e.jsxs(I,{mt:"3",mb:"1",children:[e.jsxs(I,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:t("header.settings.telemetry.essential")}),e.jsx(Hn,{label:t("header.settings.telemetry.essentialTooltip"),children:e.jsx(Re,{isChecked:b,isDisabled:!0})})]}),e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.essentialInfo")}),e.jsxs(y,{color:p,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[t("header.settings.telemetry.essentialLink")," ",e.jsx(P,{as:D})]})]}),e.jsxs(I,{mt:"1",mb:"1",children:[e.jsxs(I,{display:"flex",children:[e.jsx(j,{flex:"1",children:t("header.settings.telemetry.additional")}),e.jsx(Re,{isChecked:n,onChange:({target:{checked:l}})=>C(l)})]}),e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})};function Gs(){const{t:s}=B();F();const i=O.isAllowAnalytics(),[r,n]=T.useState(!1),[a,d]=T.useState(!1),h=Ie(O.getEnv),u=Ie(O.getAppVersion);T.useEffect(()=>{i&&h!==ke.DEV&&O.event(Se.APP_LOAD,{isStandaloneWindow:O.isStandaloneWindow()})},[h]);const t=p=>{O.getI18nInstance().changeLanguage(p)};return e.jsxs(xs,{children:[e.jsx(Y,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rma")}),e.jsx(js,{environment:h,version:u,popoverHeader:h===ke.PRD?void 0:e.jsxs(ln,{i18nKey:"header.popoverHeader",environment:h,children:["You're on ",{environment:h}," environment!"]}),popoverBody:h===ke.PRD?void 0:e.jsx(ln,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(Dn,{ml:"auto",children:[e.jsx(re,{children:e.jsx(Ts,{})}),e.jsx(re,{children:e.jsx(Us,{})}),e.jsx(re,{children:e.jsx(Ps,{})}),e.jsx(re,{children:e.jsx(V,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(fs,{}),onClick:()=>n(!0)})}),O.isStandaloneWindow()&&e.jsx(re,{children:e.jsxs(Ge,{children:[e.jsx(Ve,{as:V,icon:e.jsx(bs,{}),variant:"ghost",size:"sm"}),e.jsx(Fe,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(p=>e.jsx(q,{onClick:()=>t(p),children:Ss[p][p]},p))})]})}),e.jsx(re,{children:e.jsx(V,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(ws,{}),onClick:()=>d(!0)})})]}),e.jsx(Bs,{isOpen:r,onClose:()=>n(!1)}),e.jsx(ys,{isOpen:a,onClose:()=>d(!1)}),e.jsx(Es,{})]})}function Vs(){const s=F(),i=R(n=>n.runtime.globalAlerts),r=n=>{O.isStandaloneWindow()?window.open("/".concat(n),"_blank"):O.openApp({appId:n})};return e.jsx(e.Fragment,{children:Object.entries(i).map(([n,{message:a,url:d,linkedApp:h}])=>e.jsxs(Rn,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(En,{}),h?e.jsx(y,{onClick:()=>r(h),children:a}):d?e.jsx(y,{href:d,target:"_blank",children:a}):a,e.jsx(Wn,{ml:"auto",onClick:()=>s(zs(n))})]},n))})}function $s(){return e.jsxs(e.Fragment,{children:[e.jsx(Gs,{}),e.jsx(Vs,{})]})}export{$s as default};
