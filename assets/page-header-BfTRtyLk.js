import{j as e,h as he,aq as Ie,a1 as X,ak as J,M as K,al as q,G as Z,H as Q,J as N,ar as gn,K as x,B as U,an as V,am as $,T as pe,as as me,b as xe,L as Te,N as ue,at as jn,O as _e,au as fn,ap as se,Q as C,av as H,aw as bn,q as wn,R as je,U as fe,ad as zn,ae as kn,af as Sn,ag as $e,ah as ae,ai as vn,aj as oe,ao as Cn,ax as Fe,ay as Ve,az as Ye,aA as te,aB as Tn,aC as Le,aD as Je,aE as Ke,a0 as qe,aF as yn,aG as An,k as Mn,W as re,aH as On}from"./chakra-BiadmNKO.js";import{u as Hn,r as D,R as rn,a as Pn,b as ln,c as Dn,d as Rn,e as W,f as G,g as cn,v as be,M as En,h as Wn,i as In,s as Y,p as Ln,l as _,n as Un,j as P,k as Bn,m as Gn,o as _n,q as Fn,A as Ze,t as Vn,w as Yn,x as Xn,y as $n,z as Jn,E as ye,B as Kn,C as qn,D as Zn,F as Qn,G as Nn,H as es,I as ns,J as Se,K as Qe,S as ce,L as ss,N as ts,O,V as j,P as Ne,Q as en,T as nn,U as sn,W as dn,X as hn,Y as un,Z as is,_ as pn,$ as De,a0 as Ce,a1 as as,a2 as tn,a3 as os,a4 as rs,a5 as ls,a6 as cs,a7 as ds,a8 as hs,a9 as us,aa as ps,ab as ms,ac as xs}from"./index-CudYbHmD.js";import{a as Ue,m as B,d as T,T as an}from"./react-DFJlY5Ze.js";import{R as gs}from"./rmg-output-B97GirQX.js";var Be=function(s){return Hn(D.ready(),s)};function Re(s){var i=s.fields,r=s.noLabel,n=s.minW;return e.jsx(he,{wrap:"wrap",children:i.map(function(a,c){if(a.hidden)return e.jsx(Ue.Fragment,{},c);var d=a.minW||n,p=d==="full";return e.jsx(rn,{className:p?"mw-full":"",label:a.label,flex:p?void 0:1,minW:p?void 0:d,noLabel:r,oneLine:a.oneLine,helper:a.helper,errorMessage:a.errorMessage,children:function(t){switch(t.type){case"input":return e.jsx(Rn,{placeholder:t.placeholder,defaultValue:t.value,type:t.variant,validator:t.validator,onDebouncedChange:t.onChange,delay:t.debouncedDelay,optionList:t.optionList,isDisabled:t.isDisabled});case"output":return e.jsx(gs,{noWrap:t.noWrap,children:t.value});case"textarea":return e.jsx(Dn,{placeholder:t.placeholder,defaultValue:t.value,onDebouncedChange:t.onChange,isDisabled:t.isDisabled});case"slider":return e.jsx(ln,{defaultValue:t.value,min:t.min,max:t.max,step:t.step,onThrottledChange:t.onChange,leftIcon:t.leftIcon,rightIcon:t.rightIcon,isDisabled:t.isDisabled});case"select":return e.jsx(Pn,{defaultValue:t.value,onChange:function(l){var g,o=l.target.value;return(g=t.onChange)===null||g===void 0?void 0:g.call(t,typeof t.value=="number"?Number(o):o.toString())},options:t.options,disabledOptions:t.disabledOptions,isInvalid:t.isInvalid,isDisabled:t.isDisabled});case"switch":return e.jsx(Ie,{isChecked:t.isChecked,isDisabled:t.isDisabled,onChange:function(l){var g,o=l.target.checked;return(g=t.onChange)===null||g===void 0?void 0:g.call(t,o)}});case"custom":return t.component;default:return e.jsx("div",{})}}(a)},c)})})}var js={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const fs=()=>{const s=navigator.platform.toLowerCase();return s.includes("win")?"win":s.includes("android")?"android":s.includes("mac")?"mac":s.includes("iphone")||s.includes("ipad")?"ios":s.includes("linux")?"linux":"unknown"},bs=fs();function ws(){const{reconciledPhrases:s,currentStyle:i,currentStationID:r,currentStage:n,currentVoice:a}=W(b=>b.runtime),{preference:{previewAudio:c}}=W(b=>b.app),d=G(),{t:p}=B(),[t,l]=T.useState(!1),[g,o]=T.useState(!1),m=cn();T.useEffect(()=>{var A,v;const b=(v=(A=be[i])==null?void 0:A.defaultLang)==null?void 0:v[a],y=m.find(u=>u.lang===b);o(!!y)},[a,m]);const k=()=>{var F,I,E,z,R,L,ee,ze,ke;d(Y({status:"info",message:p("header.paly.previewWarning")}));const b=window.speechSynthesis;if(b.paused&&b.speaking){l(!0),b.resume();return}const y=(I=(F=s[r])==null?void 0:F[n])==null?void 0:I[a],A=Ln(y!=null?y:[]),v=A===""?" ":A,u=new SpeechSynthesisUtterance(v),f=(L=c[a])!=null?L:(R=(z=(E=be[i])==null?void 0:E.preferredPreviewVoiceName)==null?void 0:z[a])==null?void 0:R[bs],h=b.getVoices().find(S=>S.name===f),M=(ze=(ee=be[i])==null?void 0:ee.defaultLang)==null?void 0:ze[a];if(h)u.voice=h;else if(M)u.lang=M;else{_.error("Preview language not found for",a);return}u.onend=()=>{l(!1)},l(!0),_.debug('Previewing audio "'.concat(v,'" with ').concat((ke=u.voice)==null?void 0:ke.name)),b.speak(u)},w=()=>{window.speechSynthesis.pause(),l(!1)};return e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Settings",icon:g?t?e.jsx(En,{}):e.jsx(Wn,{}):e.jsx(In,{}),isDisabled:!g,onClick:t?w:k})}const zs=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B(),a=D.getAppVersion();return e.jsxs(J,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.about.title")}),e.jsx(Q,{}),e.jsxs(N,{paddingBottom:10,children:[e.jsxs(he,{direction:"row",children:[e.jsx(gn,{boxSize:"128px",src:"/rma//logo192.png"}),e.jsxs(he,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(x,{fontSize:"xl",as:"b",children:n("header.about.rma")}),e.jsx(x,{children:a}),e.jsx(x,{}),e.jsx(x,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(U,{margin:5,children:e.jsx(x,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(V,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx($,{children:e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(xe,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(x,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(x,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]})}),e.jsx(V,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs($,{children:[e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(xe,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(x,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(xe,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(x,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(x,{fontSize:"sm",as:"i",children:"#rma, #rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(V,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),e.jsxs($,{children:[e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(xe,{display:"block",width:"100%",pb:1,children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),e.jsx(x,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),e.jsxs(pe,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(me,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(xe,{display:"block",width:"100%",pb:1,children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),e.jsx(x,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function we(s){const i=s.sizes.shift(),r=Math.max(Math.ceil(i[0]),1),n=Math.max(Math.ceil(i[1]),1),a=[r-1,n-1,1,1],c=performance.now(),d=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let p,t;d?(p=new OffscreenCanvas(1,1),t=new OffscreenCanvas(r,n)):(p=document.createElement("canvas"),p.width=1,p.height=1,t=document.createElement("canvas"),t.width=r,t.height=n);const l=p.getContext("2d"),g=t.getContext("2d");g&&(g.fillRect.apply(g,a),l.drawImage(t,r-1,n-1,1,1,0,0,1,1));const o=l&&l.getImageData(0,0,1,1).data[3]!==0,m=parseInt(performance.now()-c);return[p,t].forEach(k=>{k.height=0,k.width=0}),d?(postMessage({width:r,height:n,testTime:m,isTestPass:o}),!o&&s.sizes.length&&setTimeout(()=>{we(s)},0)):o?s.onSuccess({width:r,height:n,testTime:m}):(s.onError({width:r,height:n,testTime:m}),s.sizes.length&&setTimeout(()=>{we(s)},0)),o}const Ee={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},de={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},ge={};function We(s){const i=s.width===s.height,r=s.height===1,n=s.width===1,a=[];if(!s.width||!s.height)s.sizes.forEach(c=>{const d=i||r?c:1,p=i||n?c:1;a.push([d,p])});else{const c=s.min||de.min,d=s.step||de.step;let p=Math.max(s.width,s.height);for(;p>=c;){const t=i||r?p:1,l=i||n?p:1;a.push([t,l]),p-=d}}return a}function ve(s){const i=typeof window<"u",r=i&&"Promise"in window,n=i&&"HTMLCanvasElement"in window,a=i&&"OffscreenCanvas"in window,c=URL.createObjectURL(new Blob([])).slice(-36),d=performance.now(),{onError:p,onSuccess:t,...l}=s,g=()=>parseInt(performance.now()-d);let o=null;if(!n)return!1;if(s.useWorker&&a){const m="\n            var canvasTest = ".concat(we.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),k=new Blob([m],{type:"application/javascript"}),w=URL.createObjectURL(k);o=new Worker(w),URL.revokeObjectURL(w),o.onmessage=function(b){const{width:y,height:A,testTime:v,isTestPass:u}=b.data,f={width:y,height:A,testTime:v,totalTime:g()};u?(ge[c].onSuccess(f),delete ge[c]):ge[c].onError(f)}}if(r)return new Promise(m=>{const k={...s,onError(w){let{width:b,height:y,testTime:A}=w;const v={width:b,height:y,testTime:A,totalTime:g()};let u;if(s.sizes.length===0)u=!0;else{const[[f,h]]=s.sizes.slice(-1);u=b===f&&y===h}p(v),u&&m({...v,success:!1})},onSuccess(w){let{width:b,height:y,testTime:A}=w;const v={width:b,height:y,testTime:A,totalTime:g()};t(v),m({...v,success:!0})}};if(o){const{onError:w,onSuccess:b}=k;ge[c]={onError:w,onSuccess:b},o.postMessage(l)}else we(k)});if(o)ge[c]={onError:p,onSuccess:t},o.postMessage(l);else return we(s)}const ks={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=We({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...Ee.area]}),r={...de,...s,sizes:i};return ve(r)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=We({width:1,height:s.max,min:s.min,step:s.step,sizes:[...Ee.height]}),r={...de,...s,sizes:i};return ve(r)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=We({width:s.max,height:1,min:s.min,step:s.step,sizes:[...Ee.width]}),r={...de,...s,sizes:i};return ve(r)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={...de,...s};return i.sizes=[...i.sizes],i.width&&i.height&&(i.sizes=[[i.width,i.height]]),ve(i)}},Ge=(s,i,r)=>{const n=new Blob([r],{type:i});Xe(s,n)},Xe=(s,i)=>{const r=window.URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)},Ss=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B(),a=G(),{reconciledPhrases:c}=W(t=>t.runtime),{points:d}=W(t=>t.audio),p=Object.keys(c).length*100;return e.jsxs(J,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.audioTask.new.title")}),e.jsx(Q,{}),e.jsxs(N,{paddingBottom:10,children:[e.jsx(x,{children:n("header.audioTask.new.content1")}),e.jsxs(x,{children:[n("header.audioTask.new.content2"),p]}),e.jsx(x,{children:n("header.audioTask.new.content3")}),e.jsx(x,{children:n("header.audioTask.new.content4")})]}),e.jsx(Te,{children:e.jsx(ue,{style:{alignSelf:"center"},onClick:()=>a(Un()),isDisabled:d<p,children:n("header.audioTask.new.create")})})]})]})},vs=s=>{jn();const{t:i}=B(),{isOpen:r,onClose:n}=s,a=G(),c=_e("primary.500","primary.300"),[d,p]=T.useState("");return e.jsxs(J,{isOpen:r,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:i("header.audioTask.redeem.title")}),e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(x,{mb:"4",children:i("header.audioTask.redeem.desc")}),e.jsx(fn,{children:e.jsx(se,{children:e.jsxs(C,{color:c,href:"https://afdian.com/item/851c2bb4110d11f0935a5254001e7c00",isExternal:!0,children:["爱发电 ",e.jsx(H,{as:P})]})})}),e.jsxs(bn,{mt:"5",direction:{base:"column",sm:"row"},children:[e.jsx(x,{mr:"auto",children:i("header.audioTask.redeem.input")}),e.jsx(wn,{w:"200px",value:d,onChange:t=>p(t.target.value)}),e.jsx(ue,{colorScheme:"teal",onClick:()=>a(Bn(d.trim())),children:i("header.audioTask.redeem.redeem")})]})]}),e.jsx(Te,{})]})]})},Cs="https://github.com/railmapgen/rma/issues/new?template=task-report.yml",Ts=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B(),a=G(),{telemetry:{project:c}}=W(h=>h.app),{tasks:d,points:p}=W(h=>h.audio),{rmtToken:t,reconciledPhrases:l}=W(h=>h.runtime),{project:g}=W(h=>h.param),{style:o,metadata:m}=g,k=D.isAllowAnalytics(),w=_e("primary.500","primary.300"),[b,y]=T.useState(!1),[A,v]=T.useState(!1);T.useEffect(()=>{i&&a(Gn())},[i]);const u=async h=>{const M=await $n("".concat(Jn.AUDIOTASKS,"/").concat(h,"/download"),{},t);if(!M||!M.ok)throw new Error("Download error");Xe("".concat(h,".zip"),await M.blob())},f=()=>{k&&D.event(ye.DOWNLOAD_TEXT,c?{style:o,"#stations":Object.keys(m).length}:{});const h=Kn(l);Ge("RMA_".concat(new Date().valueOf(),".txt"),"text/plain",h.join("\n"))};return e.jsxs(J,{isOpen:i,onClose:r,size:"4xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.download.audio")}),e.jsx(Q,{}),e.jsxs(N,{paddingBottom:10,children:[e.jsx(x,{fontSize:"lg",mb:"4",children:n("header.audioTask.desc")}),e.jsx(x,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleZH")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-zh.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),e.jsx(x,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleEN")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-en.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),e.jsxs(je,{status:"info",mt:"4",children:[e.jsx(fe,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note1")})]}),e.jsxs(je,{status:"info",mt:"4",children:[e.jsx(fe,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note2")})]}),e.jsxs(je,{status:"info",mt:"4",children:[e.jsx(fe,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note3")})]}),e.jsxs(je,{status:"warning",mt:"4",children:[e.jsx(fe,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note4")})]}),t?e.jsxs(e.Fragment,{children:[e.jsxs(he,{pl:"4",pr:"4",mt:"10",mb:"4",children:[e.jsx(x,{as:"b",fontSize:"4xl",children:p}),e.jsx(x,{style:{alignSelf:"self-end",marginLeft:"10px"},children:"pts"}),e.jsx(he,{style:{flex:1}}),e.jsx(x,{as:"b",style:{alignSelf:"self-end"},children:n("header.audioTask.title")}),e.jsx(he,{style:{flex:1}}),e.jsx(ue,{leftIcon:e.jsx(_n,{}),style:{alignSelf:"center"},onClick:()=>v(!0),mr:"2",children:n("header.audioTask.topUp")}),e.jsx(vs,{isOpen:A,onClose:()=>v(!1)}),e.jsx(ue,{leftIcon:e.jsx(Fn,{}),style:{alignSelf:"center"},onClick:()=>y(!0),children:n("header.audioTask.new.title")}),e.jsx(Ss,{isOpen:b,onClose:()=>y(!1)})]}),e.jsx(zn,{height:"100%",overflowY:"auto",children:e.jsxs(kn,{variant:"simple",height:"100%",children:[e.jsx(Sn,{children:e.jsxs($e,{children:[e.jsx(ae,{children:n("header.audioTask.table.id")}),e.jsx(ae,{children:n("header.audioTask.table.status")}),e.jsx(ae,{children:n("header.audioTask.table.createdAt")}),e.jsx(ae,{children:n("header.audioTask.table.updatedAt")}),e.jsx(ae,{children:n("header.audioTask.table.points")}),e.jsx(ae,{children:n("header.audioTask.table.actions")})]})}),e.jsx(vn,{children:d.map(({id:h,status:M,createdAt:F,updatedAt:I,points:E})=>e.jsxs($e,{children:[e.jsx(oe,{children:h}),e.jsx(oe,{children:M}),e.jsx(oe,{children:new Date(F).toLocaleString()}),e.jsx(oe,{children:new Date(I).toLocaleString()}),e.jsx(oe,{children:E}),e.jsxs(oe,{children:[M===Ze.CREATED&&e.jsx(X,{icon:e.jsx(Yn,{}),"aria-label":n("Cancel Task"),onClick:()=>a(Vn(h))}),M===Ze.COMPLETED&&e.jsx(X,{icon:e.jsx(Xn,{}),"aria-label":n("Download Audio"),onClick:()=>u(h)})]})]},h))})]})}),e.jsx($,{mt:10,children:e.jsxs(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[n("header.audioTask.report1"),e.jsx(C,{color:w,fontSize:"sm",lineHeight:"100%",onClick:()=>window.open(Cs,"_blank"),children:n("header.audioTask.report2")}),n("header.audioTask.report3")]})})]}):e.jsx(x,{mt:"10",textAlign:"center",children:n("header.audioTask.loginFirst")}),e.jsx($,{mt:10,children:e.jsxs(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[n("header.audioTask.freeInternet1"),e.jsx(C,{color:w,fontSize:"sm",lineHeight:"100%",onClick:f,children:n("header.audioTask.freeInternet2")}),n("header.audioTask.freeInternet3")]})})]})]})]})},ys=s=>{const{isOpen:i,onClose:r}=s,{t:n}=B();return e.jsxs(J,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.download.termsAndConditions")}),e.jsx(Q,{}),e.jsx(N,{children:e.jsxs(Cn,{children:[e.jsxs(se,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(C,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(H,{as:P})]}),", ",e.jsxs(C,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(H,{as:P})]})," or ",e.jsxs(C,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(H,{as:P})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(C,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(H,{as:P})]}),"，",e.jsxs(C,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(H,{as:P})]}),"或",e.jsxs(C,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(H,{as:P})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(se,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(C,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:P})]})," and ",e.jsxs(C,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:P})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(C,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:P})]}),"及",e.jsxs(C,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:P})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(se,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(C,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(H,{as:P})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(C,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(H,{as:P})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(se,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(se,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(C,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:P})]})," ","– the open-source emoji and icon project. License:",e.jsxs(C,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:P})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(C,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:P})]}),"所设计。许可证：",e.jsxs(C,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:P})]})]}),e.jsxs(se,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function As(){const{telemetry:{project:s}}=W(S=>S.app),i=G(),{content:r,realColumns:n}=W(S=>S.crawl),{project:a}=W(S=>S.param),{isModalOpen:c}=W(S=>S.audio),{style:d,metadata:p}=a,t=D.isAllowAnalytics(),{t:l}=B(),[g,o]=T.useState("png"),m={png:l("header.download.png"),svg:l("header.download.svg")},[k,w]=T.useState({width:1,height:1,benchmark:.001}),[b,y]=T.useState(200),A=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],v=Object.fromEntries(A.map(S=>[S,"".concat(S,"%")])),[u,f]=T.useState([]),h=[{type:"select",label:l("header.download.format"),value:g,options:m,onChange:S=>o(S==="png"?"png":"svg")}],M=[],F=[{type:"select",label:l("header.download.scale"),value:b,options:v,disabledOptions:u,onChange:S=>y(S)}],[I,E]=T.useState(!1),[z,R]=T.useState(!1),[L,ee]=T.useState(!1);T.useEffect(()=>{(async()=>{const ie=await ks.maxArea({usePromise:!0,useWorker:!0});w(ie)})()},[]),T.useEffect(()=>{if(I){const[S,ie]=[n*Se*b/100,Qe*Se*b/100],Ae=A.filter(ne=>S*ne/100>k.width||ie*ne/100>k.height);f(Ae)}},[I]);const ze=()=>{t&&D.event(ye.DOWNLOAD_PARAM,s?{style:d,"#stations":Object.keys(p).length}:{}),Ge("RMA_".concat(new Date().valueOf(),".json"),"application/json",JSON.stringify(a,null,2))},ke=()=>{const S=document.getElementById("crawl").cloneNode(!0),ie=S.outerHTML;if(g==="svg"){Ge("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",ie);return}document.body.appendChild(S);const Ae="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(ie)));document.body.removeChild(S),S.remove();const ne=document.createElement("canvas"),[Me,Oe]=[n*Se*b/100,Qe*Se*b/100];ne.width=Me,ne.height=Oe;const He=ne.getContext("2d");He.fillStyle="black",He.fillRect(0,0,Me,Oe);const Pe=new Image;Pe.onload=()=>{setTimeout(()=>{He.drawImage(Pe,0,0,Me,Oe),ne.toBlob(xn=>{Xe("RMA_".concat(r,".png"),xn)},"image/png")},0)},Pe.src=Ae};return e.jsxs(Fe,{id:"download",children:[e.jsx(Ve,{as:X,size:"sm",variant:"ghost",icon:e.jsx(qn,{})}),e.jsxs(Ye,{children:[e.jsx(te,{icon:e.jsx(Zn,{}),onClick:ze,children:l("header.download.config")}),e.jsx(te,{icon:e.jsx(Qn,{}),onClick:()=>E(!0),children:l("header.download.image")}),e.jsx(te,{icon:e.jsx(es,{}),onClick:()=>i(Nn()),children:l("header.download.audio")})]}),e.jsxs(J,{size:"xl",isOpen:I,onClose:()=>E(!1),children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:l("header.download.image")}),e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(Re,{fields:h}),g==="svg"&&e.jsx(Re,{fields:M}),g==="png"&&e.jsx(Re,{fields:F}),g==="png"&&u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(x,{as:"i",fontSize:"sm",children:l("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(x,{as:"i",fontSize:"sm",children:l("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(C,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(H,{as:P})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(Tn,{isChecked:L,onChange:S=>ee(S.target.checked),children:e.jsxs(x,{children:[l("header.download.termsAndConditionsInfo"),e.jsxs(C,{color:"teal.500",onClick:()=>R(!0),children:[l("header.download.termsAndConditions")," ",e.jsx(H,{as:P})]}),l("header.download.period")]})})]}),e.jsx(Te,{children:e.jsx(Le,{children:e.jsx(ue,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!L||g==="png"&&u.includes(b),onClick:ke,children:l("header.download.confirm")})})}),e.jsx(ys,{isOpen:z,onClose:()=>R(!1)})]})]}),e.jsx(Ts,{isOpen:c,onClose:()=>i(ns())})]})}const mn=s=>{var a,c,d,p;const i=["linestart"],r=[["linestart"]];let n=0;for(;i.length;){let t=i.shift(),l=r[n].slice(-1)[0]||null;for(l&&t!=="linestart"?r[n].push(t):r[n]=[t];t!=="lineend";){l=t;const g=s[l].children;switch(g.length){case 1:t=g[0];break;case 2:{const o=s[l].branch.right,m=o[1];o[0]==="through"?(r.push(r[n].slice()),i.push(m)):n===0&&(r.push([l]),i.push(m)),t=g.filter(k=>k!==m)[0];break}}if(r[n].push(t),l===((c=(a=s[t].branch)==null?void 0:a.left)==null?void 0:c[1])&&((p=(d=s[t].branch)==null?void 0:d.left)==null?void 0:p[0])==="nonthrough")break}n++}return r},Ms=(s,i,r="left",n="left",a,c=!0,d=!1,p="none",t=!1,l=ce.local)=>({[O.Arrival]:{[j.ChineseWuSimplifiedXiaotong]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:r,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[j.ChineseMandarinSimplified]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:r,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[j.ChineseWuSimplifiedYunzhe]:{terminal:s.en,terminalPinyin:s.en,doorDirection:r,thanksForTaking:a==null?void 0:a.at(1),thanksForTakingPinyin:a==null?void 0:a.at(1)}},[O.Departure]:{[j.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:c,loop:p,loopTerminal:t,service:l},[j.ChineseMandarinSimplified]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:c,loop:p,loopTerminal:t,service:l},[j.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:a==null?void 0:a.at(1),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.en,terminalPinyin:s.en,nextDoorDirection:n,lineName:i[1],lineNamePinyin:i[1],service:l}},[O.Midway]:{[j.ChineseWuSimplifiedXiaotong]:{caution:d},[j.ChineseMandarinSimplified]:{caution:d},[j.ChineseWuSimplifiedYunzhe]:{}}}),le=s=>{for(const i in s)s[i]=s[i].replaceAll("\\"," ").replaceAll("\n"," ");return s},Os=(s,i,r=ce.local)=>{var A,v,u;const n=structuredClone(ss),{line_name:a,stn_list:c,loop:d,direction:p}=s,t="left",l="left",g=mn(c).map(f=>f.slice(1,-1));p===ts.left&&g.forEach(f=>f.reverse());let o=(A=g.at(i))!=null?A:g.at(-1);r!==ce.local&&(o=o.filter(f=>c[f].services.includes(r)));const m=o,k=new Set(m.map(f=>c[f].services).flat()),w=m.at(-1),b=g.map(f=>f[f.length-1]).find(f=>f!==w),{localisedName:y}=c[w];le(y),n.baseVariants=Ms(y,a,t,l,void 0,void 0,void 0,d?"inner":"none",!1,k.has(r)?r:ce.local);for(const[f,h]of m.entries()){const{localisedName:M}=c[h];if(le(M),n.metadata[h]={name:(v=Object.values(M).at(0))!=null?v:""},n.stations[h]={},n.stations[h][O.Midway]={[j.ChineseWuSimplifiedXiaotong]:{},[j.ChineseMandarinSimplified]:{},[j.ChineseWuSimplifiedYunzhe]:{}},f!==0&&(n.stations[h][O.Arrival]={[j.ChineseWuSimplifiedXiaotong]:{name:M.zh,namePinyin:M.zh},[j.ChineseMandarinSimplified]:{name:M.zh,namePinyin:M.zh},[j.ChineseWuSimplifiedYunzhe]:{name:M.en,namePinyin:M.en}}),f!==m.length-1||d){const F=d&&f===m.length-1?m[0]:m[f+1],{localisedName:I}=c[F];le(I);const E=c[F].transfer.groups.map(z=>{var R;return(R=z.lines)==null?void 0:R.map(L=>L.name)}).filter(z=>z!==void 0);if(n.stations[h][O.Departure]={[j.ChineseWuSimplifiedXiaotong]:{next:I.zh,nextPinyin:I.zh,int:E==null?void 0:E.map(z=>z==null?void 0:z.map(R=>R[0]))},[j.ChineseMandarinSimplified]:{next:I.zh,nextPinyin:I.zh,int:E==null?void 0:E.map(z=>z==null?void 0:z.map(R=>R[0]))},[j.ChineseWuSimplifiedYunzhe]:{next:I.en,nextPinyin:I.en,int:E==null?void 0:E.map(z=>z==null?void 0:z.map(R=>R[1])),noteLastTrain:!1}},b&&f+1<m.length&&((u=c[m[f+1]].branch)!=null&&u[p==="l"?Ne.left:Ne.right])){const{localisedName:z}=c[b];le(z),n.stations[h][O.Departure][j.ChineseWuSimplifiedXiaotong]={...n.stations[h][O.Departure][j.ChineseWuSimplifiedXiaotong],branchTerminalName:z.zh,branchTerminalNamePinyin:z.zh},n.stations[h][O.Departure][j.ChineseMandarinSimplified]={...n.stations[h][O.Departure][j.ChineseMandarinSimplified],branchTerminalName:z.zh,branchTerminalNamePinyin:z.zh},n.stations[h][O.Departure][j.ChineseWuSimplifiedYunzhe]={...n.stations[h][O.Departure][j.ChineseWuSimplifiedYunzhe],branchTerminalName:z.en,branchTerminalNamePinyin:z.en}}if(r!==ce.local){const R=m.slice(f+1,-1).map(L=>{const{localisedName:ee}=c[L];return le(ee),ee});n.stations[h][O.Departure][j.ChineseWuSimplifiedXiaotong]={...n.stations[h][O.Departure][j.ChineseWuSimplifiedXiaotong],stopovers:R.map(L=>L.zh)},n.stations[h][O.Departure][j.ChineseMandarinSimplified]={...n.stations[h][O.Departure][j.ChineseMandarinSimplified],stopovers:R.map(L=>L.zh)},n.stations[h][O.Departure][j.ChineseWuSimplifiedYunzhe]={...n.stations[h][O.Departure][j.ChineseWuSimplifiedYunzhe],stopovers:R.map(L=>L.en)}}}}if(d){const f=m[0],{localisedName:h}=c[f];le(h),n.stations[f][O.Arrival]={[j.ChineseWuSimplifiedXiaotong]:{name:h.zh,namePinyin:h.zh,doorDirection:t},[j.ChineseMandarinSimplified]:{name:h.zh,namePinyin:h.zh,doorDirection:t},[j.ChineseWuSimplifiedYunzhe]:{name:h.en,namePinyin:h.en,doorDirection:t}}}return n},Hs=()=>{var g;const{t:s}=B(),i=G(),r=D.isAllowAnalytics(),{rmgParam:n,route:a,service:c}=W(o=>o.import),d=n?mn(n.stn_list).map(o=>[o.at(1),o.at(-2)]):[],p=n?d.map(o=>o.map(m=>Object.values(n.stn_list[m].localisedName).join(" "))):[],t=new Set(Object.values((g=n==null?void 0:n.stn_list)!=null?g:{}).map(o=>o.services).flat()),l=()=>{if(n){r&&D.event(ye.IMPORT_RMG_PARAM);try{const o=Os(structuredClone(n),a,c);i(dn(o)),i(hn(Object.keys(o.metadata)[0])),i(un(O.Departure))}catch(o){i(Y({status:"error",message:s("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",o)}finally{i(sn()),i(en(0)),i(nn(ce.local))}}};return e.jsxs(J,{isOpen:n!==void 0,onClose:()=>i(sn()),size:"lg",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:s("import.title")}),e.jsx(Q,{color:"white"}),e.jsxs(N,{py:3,children:[d.length===1&&t.size===1&&e.jsx(x,{children:s("import.goodToGo")}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(V,{fontSize:"md",mb:4,children:s("import.routes")}),e.jsx(Je,{onChange:o=>i(en(Number(o))),value:a.toString(),children:e.jsx(Le,{spacing:4,align:"stretch",children:p.map((o,m)=>e.jsx(U,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:a===m?"blue.500":"gray.200",children:e.jsx(Ke,{value:m.toString(),colorScheme:"blue",children:e.jsx($,{align:"start",spacing:1,ml:2,children:e.jsx(x,{fontSize:"sm",children:o.join(" <=> ")})})})},m))})})]}),t.size>1&&e.jsxs(e.Fragment,{children:[e.jsx(V,{fontSize:"md",mb:4,children:s("import.services")}),e.jsx(Je,{onChange:o=>i(nn(o)),value:c,children:e.jsx(Le,{spacing:4,align:"stretch",children:[...t].map(o=>e.jsx(U,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:c===o?"blue.500":"gray.200",children:e.jsx(Ke,{value:o,colorScheme:"blue",children:e.jsx($,{align:"start",spacing:1,ml:2,children:e.jsx(x,{fontSize:"sm",children:s("import.service.".concat(o))})})})},o))})})]})]}),e.jsx(Te,{children:e.jsx(ue,{colorScheme:"teal",variant:"outline",onClick:l,children:s("import.import")})})]})]})},Ps="rmg-bridge--",Ds={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Rs(s){const{isOpen:i,onClose:r}=s,{t:n}=B(),a=G(),[c]=Ue.useState(crypto.randomUUID()),d="/rmg/#/import?"+new URLSearchParams({parentComponent:D.getAppName(),parentId:c}),p=t=>{try{a(pn(t))}catch(l){a(Y({status:"error",message:n("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",l)}finally{r()}};return Ue.useEffect(()=>{const t=new BroadcastChannel(Ps+c);return t.onmessage=l=>{const{event:g,data:o}=l.data;_.info("Received event from RMG app clip:",g),g==="CLOSE"?r():g==="IMPORT"&&p(o)},()=>t.close()},[]),e.jsx(is,{isOpen:i,onClose:r,sx:Ds,children:e.jsx("iframe",{src:d,loading:"lazy"})})}function Es(){const s=G(),{t:i}=B(),{preference:{import:{route:r,service:n}}}=W(o=>o.app),a=Be(D.getEnv),c=T.useRef(null),d=T.useRef(null),[p,t]=T.useState(!1),l=async o=>{var k;const m=(k=o.target.files)==null?void 0:k[0];if(_.info("OpenActions.handleUpload():: received file",m),(m==null?void 0:m.type)!=="application/json")s(Y({status:"error",message:i("header.open.invalidType")})),_.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const w=await on(m),b=JSON.parse(w);if(!("baseVariants"in b)){s(Y({status:"error",message:i("header.open.invalidType")})),_.error("OpenActions.handleUpload():: Not a valid RMA project."),o.target.value="";return}s(dn(b)),s(hn(Object.keys(b.metadata)[0])),s(un(O.Departure))}catch(w){s(Y({status:"error",message:i("header.open.unknownError")})),_.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",w)}o.target.value=""},g=async o=>{var k;const m=(k=o.target.files)==null?void 0:k[0];if(_.info("OpenActions.handleUpload():: received file",m),(m==null?void 0:m.type)!=="application/json")s(Y({status:"error",message:i("header.open.invalidType")})),_.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const w=await on(m);s(pn(JSON.parse(w)))}catch(w){s(Y({status:"error",message:i("header.open.unknownError")})),_.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",w)}o.target.value=""};return e.jsxs(Fe,{children:[e.jsx(Ve,{as:X,size:"sm",variant:"ghost",icon:e.jsx(De,{})}),e.jsxs(Ye,{children:[e.jsx("input",{id:"upload_project",ref:c,type:"file",accept:".json",hidden:!0,onChange:l,"data-testid":"file-upload"}),e.jsx(te,{icon:e.jsx(De,{}),onClick:()=>{var o;return(o=c==null?void 0:c.current)==null?void 0:o.click()},children:i("header.open.config")}),e.jsx("input",{id:"upload_RMG",ref:d,type:"file",accept:".json",hidden:!0,onChange:g,"data-testid":"file-upload"}),a===Ce.DEV&&e.jsx(te,{icon:e.jsx(De,{}),onClick:()=>{var o;return(o=d==null?void 0:d.current)==null?void 0:o.click()},children:i("header.open.RMG")}),e.jsx(te,{icon:e.jsx(as,{}),onClick:()=>t(!0),children:i("header.open.projectRMG")})]}),e.jsx(Rs,{isOpen:p,onClose:()=>t(!1)})]})}const on=s=>new Promise(i=>{const r=new FileReader;r.onloadend=()=>i(r.result),r.readAsText(s)}),Ws=s=>{var A,v;const{isOpen:i,onClose:r}=s,{telemetry:{project:n},preference:{import:{route:a,service:c},previewAudio:d}}=W(u=>u.app),p=G(),{t}=B(),l=_e("primary.500","primary.300"),{scale:g}=W(u=>u.crawl),o=cn(),[m,k]=T.useState({[j.ChineseMandarinSimplified]:[],[j.ChineseWuSimplifiedXiaotong]:[],[j.ChineseWuSimplifiedYunzhe]:[]});T.useEffect(()=>{k({[j.ChineseMandarinSimplified]:o.filter(u=>{var f,h;return u.lang===((h=(f=be[tn.ShanghaiMetro])==null?void 0:f.defaultLang)==null?void 0:h[j.ChineseMandarinSimplified])}).map(u=>u.name),[j.ChineseWuSimplifiedXiaotong]:[],[j.ChineseWuSimplifiedYunzhe]:o.filter(u=>{var f,h;return u.lang===((h=(f=be[tn.ShanghaiMetro])==null?void 0:f.defaultLang)==null?void 0:h[j.ChineseWuSimplifiedYunzhe])}).map(u=>u.name)})},[o]);const w=(u,f)=>{p(f==="undefined"?rs(u):ls([u,f]))},b=D.isAllowAnalytics(),y=u=>{p(cs(u))};return e.jsxs(J,{isOpen:i,onClose:r,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:t("header.settings.title")}),e.jsx(Q,{}),e.jsx(N,{children:e.jsxs($,{divider:e.jsx(An,{borderColor:"gray.200"}),children:[e.jsxs(U,{width:"100%",mb:"3",children:[e.jsx(V,{fontSize:"md",children:t("header.settings.crawl.title")}),e.jsx(U,{mt:"3",children:e.jsx(rn,{label:t("header.settings.crawl.scale"),children:e.jsx(ln,{defaultValue:g,value:g,min:.1,max:1,step:.1,onThrottledChange:u=>p(os(u))})})})]}),e.jsxs(U,{width:"100%",mb:"3",children:[e.jsx(V,{fontSize:"md",children:t("header.settings.previewAudio.title")}),e.jsxs(U,{mt:"3",children:[e.jsxs(U,{mb:"1",display:"flex",children:[e.jsx(x,{flex:"1",children:t("header.settings.previewAudio.shmetro-zh")}),e.jsxs(qe,{size:"xs",width:"300px",ml:"1",defaultValue:(A=d[j.ChineseMandarinSimplified])!=null?A:"undefined",onChange:({target:{value:u}})=>w(j.ChineseMandarinSimplified,u),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),m[j.ChineseMandarinSimplified].map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs(U,{mb:"1",display:"flex",children:[e.jsx(x,{flex:"1",children:t("header.settings.previewAudio.shmetro-en")}),e.jsxs(qe,{size:"xs",width:"300px",ml:"1",defaultValue:(v=d[j.ChineseWuSimplifiedYunzhe])!=null?v:"undefined",onChange:({target:{value:u}})=>w(j.ChineseWuSimplifiedYunzhe,u),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),m[j.ChineseWuSimplifiedYunzhe].map(u=>e.jsx("option",{value:u,children:u},u))]})]})]})]}),e.jsxs(U,{width:"100%",mb:"3",children:[e.jsx(V,{fontSize:"md",children:t("header.settings.telemetry.title")}),e.jsxs(U,{mt:"3",children:[e.jsx(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.info")}),e.jsxs(U,{mt:"3",mb:"1",children:[e.jsxs(U,{display:"flex",mb:"1",children:[e.jsx(x,{flex:"1",children:t("header.settings.telemetry.essential")}),e.jsx(yn,{label:t("header.settings.telemetry.essentialTooltip"),children:e.jsx(Ie,{isChecked:b,isDisabled:!0})})]}),e.jsx(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.essentialInfo")}),e.jsxs(C,{color:l,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[t("header.settings.telemetry.essentialLink")," ",e.jsx(H,{as:P})]})]}),e.jsxs(U,{mt:"1",mb:"1",children:[e.jsxs(U,{display:"flex",children:[e.jsx(x,{flex:"1",children:t("header.settings.telemetry.additional")}),e.jsx(Ie,{isChecked:n,onChange:({target:{checked:u}})=>y(u)})]}),e.jsx(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})};function Is(){const{t:s}=B();G();const i=D.isAllowAnalytics(),[r,n]=T.useState(!1),[a,c]=T.useState(!1),d=Be(D.getEnv),p=Be(D.getAppVersion);T.useEffect(()=>{i&&d!==Ce.DEV&&D.event(ye.APP_LOAD,{isStandaloneWindow:D.isStandaloneWindow()})},[d]);const t=l=>{D.getI18nInstance().changeLanguage(l)};return e.jsxs(ds,{children:[e.jsx(V,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rma")}),e.jsx(hs,{environment:d,version:p,popoverHeader:d===Ce.PRD?void 0:e.jsxs(an,{i18nKey:"header.popoverHeader",environment:d,children:["You're on ",{environment:d}," environment!"]}),popoverBody:d===Ce.PRD?void 0:e.jsx(an,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(Mn,{ml:"auto",children:[e.jsx(re,{children:e.jsx(ws,{})}),e.jsx(re,{children:e.jsx(Es,{})}),e.jsx(re,{children:e.jsx(As,{})}),e.jsx(re,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(us,{}),onClick:()=>n(!0)})}),D.isStandaloneWindow()&&e.jsx(re,{children:e.jsxs(Fe,{children:[e.jsx(Ve,{as:X,icon:e.jsx(ps,{}),variant:"ghost",size:"sm"}),e.jsx(Ye,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(l=>e.jsx(te,{onClick:()=>t(l),children:js[l][l]},l))})]})}),e.jsx(re,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(ms,{}),onClick:()=>c(!0)})})]}),e.jsx(Ws,{isOpen:r,onClose:()=>n(!1)}),e.jsx(zs,{isOpen:a,onClose:()=>c(!1)}),e.jsx(Hs,{})]})}function Ls(){const s=G(),i=W(n=>n.runtime.globalAlerts),r=n=>{D.isStandaloneWindow()?window.open("/".concat(n),"_blank"):D.openApp({appId:n})};return e.jsx(e.Fragment,{children:Object.entries(i).map(([n,{message:a,url:c,linkedApp:d}])=>e.jsxs(je,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(fe,{}),d?e.jsx(C,{onClick:()=>r(d),children:a}):c?e.jsx(C,{href:c,target:"_blank",children:a}):a,e.jsx(On,{ml:"auto",onClick:()=>s(xs(n))})]},n))})}function Fs(){return e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),e.jsx(Ls,{})]})}export{Fs as default};
