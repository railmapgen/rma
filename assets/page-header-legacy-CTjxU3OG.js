System.register(["./chakra-legacy-Cd_onqHs.js","./index-legacy-YDJI-5X7.js","./react-legacy-hZgLs8_m.js","./rmg-output-legacy-c0w5dFxW.js"],(function(e,n){"use strict";var i,s,a,t,r,o,l,d,h,c,m,p,u,x,j,g,f,w,z,b,k,v,y,S,C,T,H,O,A,D,M,E,W,P,R,N,I,L,U,_,B,G,Y,F,V,X,$,J,K,q,Z,Q,ee,ne,ie,se,ae,te,re,oe,le,de,he,ce,me,pe,ue,xe,je,ge,fe,we,ze,be,ke,ve,ye,Se,Ce,Te,He,Oe,Ae,De,Me,Ee,We,Pe,Re,Ne,Ie,Le,Ue,_e,Be,Ge,Ye,Fe,Ve,Xe,$e,Je,Ke,qe,Ze,Qe,en,nn,sn,an,tn,rn,on,ln,dn,hn,cn,mn,pn,un,xn,jn,gn,fn;return{setters:[e=>{i=e.j,s=e.h,a=e.aq,t=e.a1,r=e.ak,o=e.M,l=e.al,d=e.G,h=e.H,c=e.J,m=e.ar,p=e.K,u=e.B,x=e.an,j=e.am,g=e.T,f=e.as,w=e.b,z=e.L,b=e.N,k=e.at,v=e.O,y=e.au,S=e.ap,C=e.Q,T=e.av,H=e.aw,O=e.q,A=e.R,D=e.U,M=e.ad,E=e.ae,W=e.af,P=e.ag,R=e.ah,N=e.ai,I=e.aj,L=e.ao,U=e.ax,_=e.ay,B=e.az,G=e.aA,Y=e.aB,F=e.aC,V=e.aD,X=e.aE,$=e.a0,J=e.aF,K=e.aG,q=e.k,Z=e.W,Q=e.aH},e=>{ee=e.u,ne=e.r,ie=e.R,se=e.a,ae=e.b,te=e.c,re=e.d,oe=e.e,le=e.f,de=e.g,he=e.v,ce=e.M,me=e.h,pe=e.i,ue=e.s,xe=e.p,je=e.l,ge=e.n,fe=e.j,we=e.k,ze=e.m,be=e.o,ke=e.q,ve=e.A,ye=e.t,Se=e.w,Ce=e.x,Te=e.y,He=e.z,Oe=e.E,Ae=e.B,De=e.C,Me=e.D,Ee=e.F,We=e.G,Pe=e.H,Re=e.I,Ne=e.J,Ie=e.K,Le=e.S,Ue=e.L,_e=e.N,Be=e.O,Ge=e.V,Ye=e.P,Fe=e.Q,Ve=e.T,Xe=e.U,$e=e.W,Je=e.X,Ke=e.Y,qe=e.Z,Ze=e._,Qe=e.$,en=e.a0,nn=e.a1,sn=e.a2,an=e.a3,tn=e.a4,rn=e.a5,on=e.a6,ln=e.a7,dn=e.a8,hn=e.a9,cn=e.aa,mn=e.ab,pn=e.ac},e=>{un=e.a,xn=e.m,jn=e.d,gn=e.T},e=>{fn=e.R}],execute:function(){e("default",(function(){return i.jsxs(i.Fragment,{children:[i.jsx($n,{}),i.jsx(Jn,{})]})}));var n=function(e){return ee(ne.ready(),e)};function wn(e){var n=e.fields,t=e.noLabel,r=e.minW;return i.jsx(s,{wrap:"wrap",children:n.map((function(e,n){if(e.hidden)return i.jsx(un.Fragment,{},n);var s=e.minW||r,o="full"===s;return i.jsx(ie,{className:o?"mw-full":"",label:e.label,flex:o?void 0:1,minW:o?void 0:s,noLabel:t,oneLine:e.oneLine,helper:e.helper,errorMessage:e.errorMessage,children:function(e){switch(e.type){case"input":return i.jsx(re,{placeholder:e.placeholder,defaultValue:e.value,type:e.variant,validator:e.validator,onDebouncedChange:e.onChange,delay:e.debouncedDelay,optionList:e.optionList,isDisabled:e.isDisabled});case"output":return i.jsx(fn,{noWrap:e.noWrap,children:e.value});case"textarea":return i.jsx(te,{placeholder:e.placeholder,defaultValue:e.value,onDebouncedChange:e.onChange,isDisabled:e.isDisabled});case"slider":return i.jsx(ae,{defaultValue:e.value,min:e.min,max:e.max,step:e.step,onThrottledChange:e.onChange,leftIcon:e.leftIcon,rightIcon:e.rightIcon,isDisabled:e.isDisabled});case"select":return i.jsx(se,{defaultValue:e.value,onChange:function(n){var i,s=n.target.value;return null===(i=e.onChange)||void 0===i?void 0:i.call(e,"number"==typeof e.value?Number(s):s.toString())},options:e.options,disabledOptions:e.disabledOptions,isInvalid:e.isInvalid,isDisabled:e.isDisabled});case"switch":return i.jsx(a,{isChecked:e.isChecked,isDisabled:e.isDisabled,onChange:function(n){var i,s=n.target.checked;return null===(i=e.onChange)||void 0===i?void 0:i.call(e,s)}});case"custom":return e.component;default:return i.jsx("div",{})}}(e)},n)}))})}var zn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const bn=(()=>{const e=navigator.platform.toLowerCase();return e.includes("win")?"win":e.includes("android")?"android":e.includes("mac")?"mac":e.includes("iphone")||e.includes("ipad")?"ios":e.includes("linux")?"linux":"unknown"})();function kn(){const{reconciledPhrases:e,currentStyle:n,currentStationID:s,currentStage:a,currentVoice:r}=oe((e=>e.runtime)),{preference:{previewAudio:o}}=oe((e=>e.app)),l=le(),{t:d}=xn(),[h,c]=jn.useState(!1),[m,p]=jn.useState(!1),u=de();return jn.useEffect((()=>{const e=he[n]?.defaultLang?.[r],i=u.find((n=>n.lang===e));p(!!i)}),[r,u]),i.jsx(t,{size:"sm",variant:"ghost","aria-label":"Settings",icon:m?h?i.jsx(ce,{}):i.jsx(me,{}):i.jsx(pe,{}),isDisabled:!m,onClick:h?()=>{window.speechSynthesis.pause(),c(!1)}:()=>{l(ue({status:"info",message:d("header.paly.previewWarning")}));const i=window.speechSynthesis;if(i.paused&&i.speaking)return c(!0),void i.resume();const t=e[s]?.[a]?.[r],h=xe(t??[]),m=""===h?" ":h,p=new SpeechSynthesisUtterance(m),u=o[r]??he[n]?.preferredPreviewVoiceName?.[r]?.[bn],x=i.getVoices().find((e=>e.name===u)),j=he[n]?.defaultLang?.[r];if(x)p.voice=x;else{if(!j)return void je.error("Preview language not found for",r);p.lang=j}p.onend=()=>{c(!1)},c(!0),je.debug(`Previewing audio "${m}" with ${p.voice?.name}`),i.speak(p)}})}const vn=e=>{const{isOpen:n,onClose:a}=e,{t:t}=xn(),z=ne.getAppVersion();return i.jsxs(r,{isOpen:n,onClose:a,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:t("header.about.title")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsxs(s,{direction:"row",children:[i.jsx(m,{boxSize:"128px",src:"/rma//logo192.png"}),i.jsxs(s,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[i.jsx(p,{fontSize:"xl",as:"b",children:t("header.about.rma")}),i.jsx(p,{children:z}),i.jsx(p,{}),i.jsx(p,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),i.jsx(u,{margin:5,children:i.jsx(p,{fontSize:"xl",children:t("header.about.desc")})}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),i.jsx(j,{children:i.jsxs(g,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),i.jsx(p,{fontSize:"sm",children:t("header.about.content1")}),i.jsx(p,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]})}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),i.jsxs(j,{children:[i.jsxs(g,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),i.jsx(p,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),i.jsxs(g,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),i.jsx(p,{fontSize:"sm",children:t("header.about.slackContent")}),i.jsx(p,{fontSize:"sm",as:"i",children:"#rma, #rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),i.jsxs(j,{children:[i.jsxs(g,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",pb:1,children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),i.jsx(p,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),i.jsxs(g,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",pb:1,children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),i.jsx(p,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */function yn(e){const n=e.sizes.shift(),i=Math.max(Math.ceil(n[0]),1),s=Math.max(Math.ceil(n[1]),1),a=[i-1,s-1,1,1],t=performance.now(),r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let o,l;r?(o=new OffscreenCanvas(1,1),l=new OffscreenCanvas(i,s)):(o=document.createElement("canvas"),o.width=1,o.height=1,l=document.createElement("canvas"),l.width=i,l.height=s);const d=o.getContext("2d"),h=l.getContext("2d");h&&(h.fillRect.apply(h,a),d.drawImage(l,i-1,s-1,1,1,0,0,1,1));const c=d&&0!==d.getImageData(0,0,1,1).data[3],m=parseInt(performance.now()-t);return[o,l].forEach((e=>{e.height=0,e.width=0})),r?(postMessage({width:i,height:s,testTime:m,isTestPass:c}),!c&&e.sizes.length&&setTimeout((()=>{yn(e)}),0)):c?e.onSuccess({width:i,height:s,testTime:m}):(e.onError({width:i,height:s,testTime:m}),e.sizes.length&&setTimeout((()=>{yn(e)}),0)),c}const Sn={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Cn={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Tn={};function Hn(e){const n=e.width===e.height,i=1===e.height,s=1===e.width,a=[];if(e.width&&e.height){const t=e.min||Cn.min,r=e.step||Cn.step;let o=Math.max(e.width,e.height);for(;o>=t;){const e=n||i?o:1,t=n||s?o:1;a.push([e,t]),o-=r}}else e.sizes.forEach((e=>{const t=n||i?e:1,r=n||s?e:1;a.push([t,r])}));return a}function On(e){const n="undefined"!=typeof window,i=n&&"Promise"in window,s=n&&"HTMLCanvasElement"in window,a=n&&"OffscreenCanvas"in window,t=URL.createObjectURL(new Blob([])).slice(-36),r=performance.now(),{onError:o,onSuccess:l,...d}=e,h=()=>parseInt(performance.now()-r);let c=null;if(!s)return!1;if(e.useWorker&&a){const e=`\n            var canvasTest = ${yn.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,n=new Blob([e],{type:"application/javascript"}),i=URL.createObjectURL(n);c=new Worker(i),URL.revokeObjectURL(i),c.onmessage=function(e){const{width:n,height:i,testTime:s,isTestPass:a}=e.data,r={width:n,height:i,testTime:s,totalTime:h()};a?(Tn[t].onSuccess(r),delete Tn[t]):Tn[t].onError(r)}}return i?new Promise((n=>{const i={...e,onError(i){let{width:s,height:a,testTime:t}=i;const r={width:s,height:a,testTime:t,totalTime:h()};let l;if(0===e.sizes.length)l=!0;else{const[[n,i]]=e.sizes.slice(-1);l=s===n&&a===i}o(r),l&&n({...r,success:!1})},onSuccess(e){let{width:i,height:s,testTime:a}=e;const t={width:i,height:s,testTime:a,totalTime:h()};l(t),n({...t,success:!0})}};if(c){const{onError:e,onSuccess:n}=i;Tn[t]={onError:e,onSuccess:n},c.postMessage(d)}else yn(i)})):c?(Tn[t]={onError:o,onSuccess:l},void c.postMessage(d)):yn(e)}const An={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=Hn({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...Sn.area]});return On({...Cn,...e,sizes:n})},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=Hn({width:1,height:e.max,min:e.min,step:e.step,sizes:[...Sn.height]});return On({...Cn,...e,sizes:n})},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=Hn({width:e.max,height:1,min:e.min,step:e.step,sizes:[...Sn.width]});return On({...Cn,...e,sizes:n})},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n={...Cn,...e};return n.sizes=[...n.sizes],n.width&&n.height&&(n.sizes=[[n.width,n.height]]),On(n)}},Dn=(e,n,i)=>{const s=new Blob([i],{type:n});Mn(e,s)},Mn=(e,n)=>{const i=window.URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(i)},En=e=>{const{isOpen:n,onClose:s}=e,{t:a}=xn(),t=le(),{reconciledPhrases:m}=oe((e=>e.runtime)),{points:u}=oe((e=>e.audio)),x=100*Object.keys(m).length;return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:a("header.audioTask.new.title")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsx(p,{children:a("header.audioTask.new.content1")}),i.jsxs(p,{children:[a("header.audioTask.new.content2"),x]}),i.jsx(p,{children:a("header.audioTask.new.content3")}),i.jsx(p,{children:a("header.audioTask.new.content4")})]}),i.jsx(z,{children:i.jsx(b,{style:{alignSelf:"center"},onClick:()=>t(ge()),isDisabled:u<x,children:a("header.audioTask.new.create")})})]})]})},Wn=e=>{k();const{t:n}=xn(),{isOpen:s,onClose:a}=e,t=le(),m=v("primary.500","primary.300"),[u,x]=jn.useState("");return i.jsxs(r,{isOpen:s,onClose:a,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:n("header.audioTask.redeem.title")}),i.jsx(h,{}),i.jsxs(c,{children:[i.jsx(p,{mb:"4",children:n("header.audioTask.redeem.desc")}),i.jsx(y,{children:i.jsx(S,{children:i.jsxs(C,{color:m,href:"https://afdian.com/item/851c2bb4110d11f0935a5254001e7c00",isExternal:!0,children:["爱发电 ",i.jsx(T,{as:fe})]})})}),i.jsxs(H,{mt:"5",direction:{base:"column",sm:"row"},children:[i.jsx(p,{mr:"auto",children:n("header.audioTask.redeem.input")}),i.jsx(O,{w:"200px",value:u,onChange:e=>x(e.target.value)}),i.jsx(b,{colorScheme:"teal",onClick:()=>t(we(u.trim())),children:n("header.audioTask.redeem.redeem")})]})]}),i.jsx(z,{})]})]})},Pn=e=>{const{isOpen:n,onClose:a}=e,{t:m}=xn(),u=le(),{telemetry:{project:x}}=oe((e=>e.app)),{tasks:g,points:f}=oe((e=>e.audio)),{rmtToken:w,reconciledPhrases:z}=oe((e=>e.runtime)),{project:k}=oe((e=>e.param)),{style:y,metadata:S}=k,T=ne.isAllowAnalytics(),H=v("primary.500","primary.300"),[O,L]=jn.useState(!1),[U,_]=jn.useState(!1);return jn.useEffect((()=>{n&&u(ze())}),[n]),i.jsxs(r,{isOpen:n,onClose:a,size:"4xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:m("header.download.audio")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsx(p,{fontSize:"lg",mb:"4",children:m("header.audioTask.desc")}),i.jsx(p,{fontSize:"md",mt:"4",color:"gray.600",children:m("header.audioTask.exampleZH")}),i.jsxs("audio",{controls:!0,children:[i.jsx("source",{src:"audio/shmetro-zh.mp3",type:"audio/mpeg"}),m("header.audioTask.audioNotSupported")]}),i.jsx(p,{fontSize:"md",mt:"4",color:"gray.600",children:m("header.audioTask.exampleEN")}),i.jsxs("audio",{controls:!0,children:[i.jsx("source",{src:"audio/shmetro-en.mp3",type:"audio/mpeg"}),m("header.audioTask.audioNotSupported")]}),i.jsxs(A,{status:"info",mt:"4",children:[i.jsx(D,{}),i.jsx(p,{fontSize:"md",color:"gray.600",children:m("header.audioTask.note1")})]}),i.jsxs(A,{status:"info",mt:"4",children:[i.jsx(D,{}),i.jsx(p,{fontSize:"md",color:"gray.600",children:m("header.audioTask.note2")})]}),i.jsxs(A,{status:"info",mt:"4",children:[i.jsx(D,{}),i.jsx(p,{fontSize:"md",color:"gray.600",children:m("header.audioTask.note3")})]}),i.jsxs(A,{status:"warning",mt:"4",children:[i.jsx(D,{}),i.jsx(p,{fontSize:"md",color:"gray.600",children:m("header.audioTask.note4")})]}),w?i.jsxs(i.Fragment,{children:[i.jsxs(s,{pl:"4",pr:"4",mt:"10",mb:"4",children:[i.jsx(p,{as:"b",fontSize:"4xl",children:f}),i.jsx(p,{style:{alignSelf:"self-end",marginLeft:"10px"},children:"pts"}),i.jsx(s,{style:{flex:1}}),i.jsx(p,{as:"b",style:{alignSelf:"self-end"},children:m("header.audioTask.title")}),i.jsx(s,{style:{flex:1}}),i.jsx(b,{leftIcon:i.jsx(be,{}),style:{alignSelf:"center"},onClick:()=>_(!0),mr:"2",children:m("header.audioTask.topUp")}),i.jsx(Wn,{isOpen:U,onClose:()=>_(!1)}),i.jsx(b,{leftIcon:i.jsx(ke,{}),style:{alignSelf:"center"},onClick:()=>L(!0),children:m("header.audioTask.new.title")}),i.jsx(En,{isOpen:O,onClose:()=>L(!1)})]}),i.jsx(M,{height:"100%",overflowY:"auto",children:i.jsxs(E,{variant:"simple",height:"100%",children:[i.jsx(W,{children:i.jsxs(P,{children:[i.jsx(R,{children:m("header.audioTask.table.id")}),i.jsx(R,{children:m("header.audioTask.table.status")}),i.jsx(R,{children:m("header.audioTask.table.createdAt")}),i.jsx(R,{children:m("header.audioTask.table.updatedAt")}),i.jsx(R,{children:m("header.audioTask.table.points")}),i.jsx(R,{children:m("header.audioTask.table.actions")})]})}),i.jsx(N,{children:g.map((({id:e,status:n,createdAt:s,updatedAt:a,points:r})=>i.jsxs(P,{children:[i.jsx(I,{children:e}),i.jsx(I,{children:n}),i.jsx(I,{children:new Date(s).toLocaleString()}),i.jsx(I,{children:new Date(a).toLocaleString()}),i.jsx(I,{children:r}),i.jsxs(I,{children:[n===ve.CREATED&&i.jsx(t,{icon:i.jsx(Se,{}),"aria-label":m("Cancel Task"),onClick:()=>u(ye(e))}),n===ve.COMPLETED&&i.jsx(t,{icon:i.jsx(Ce,{}),"aria-label":m("Download Audio"),onClick:()=>(async e=>{const n=await Te(`${He.AUDIOTASKS}/${e}/download`,{},w);if(!n||!n.ok)throw new Error("Download error");Mn(`${e}.zip`,await n.blob())})(e)})]})]},e)))})]})}),i.jsx(j,{mt:10,children:i.jsxs(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[m("header.audioTask.report1"),i.jsx(C,{color:H,fontSize:"sm",lineHeight:"100%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues/new?template=task-report.yml","_blank"),children:m("header.audioTask.report2")}),m("header.audioTask.report3")]})})]}):i.jsx(p,{mt:"10",textAlign:"center",children:m("header.audioTask.loginFirst")}),i.jsx(j,{mt:10,children:i.jsxs(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[m("header.audioTask.freeInternet1"),i.jsx(C,{color:H,fontSize:"sm",lineHeight:"100%",onClick:()=>{T&&ne.event(Oe.DOWNLOAD_TEXT,x?{style:y,"#stations":Object.keys(S).length}:{});const e=Ae(z);Dn(`RMA_${(new Date).valueOf()}.txt`,"text/plain",e.join("\n"))},children:m("header.audioTask.freeInternet2")}),m("header.audioTask.freeInternet3")]})})]})]})]})},Rn=e=>{const{isOpen:n,onClose:s}=e,{t:a}=xn();return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:a("header.download.termsAndConditions")}),i.jsx(h,{}),i.jsx(c,{children:i.jsxs(L,{children:[i.jsxs(S,{children:["The layout of the elements on the signage or rail map, is designed by"," ",i.jsxs(C,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",i.jsx(T,{as:fe})]}),", ",i.jsxs(C,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",i.jsx(T,{as:fe})]})," or ",i.jsxs(C,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",i.jsx(T,{as:fe})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",i.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",i.jsxs(C,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",i.jsx(T,{as:fe})]}),"，",i.jsxs(C,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",i.jsx(T,{as:fe})]}),"或",i.jsxs(C,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",i.jsx(T,{as:fe})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),i.jsxs(S,{children:["The elements including shapes and lines on the image are drawn by"," ",i.jsxs(C,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",i.jsx(T,{as:fe})]})," and ",i.jsxs(C,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",i.jsx(T,{as:fe})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",i.jsx("br",{}),"图像的元素，包括图形及线条，均由",i.jsxs(C,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",i.jsx(T,{as:fe})]}),"及",i.jsxs(C,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",i.jsx(T,{as:fe})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),i.jsxs(S,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",i.jsxs(C,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",i.jsx(T,{as:fe})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",i.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",i.jsxs(C,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",i.jsx(T,{as:fe})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),i.jsxs(S,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",i.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),i.jsxs(S,{children:["All flag emojis shown on Windows platforms are designed by"," ",i.jsxs(C,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",i.jsx(T,{as:fe})]})," ","– the open-source emoji and icon project. License:",i.jsxs(C,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",i.jsx(T,{as:fe})]}),i.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",i.jsxs(C,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",i.jsx(T,{as:fe})]}),"所设计。许可证：",i.jsxs(C,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",i.jsx(T,{as:fe})]})]}),i.jsxs(S,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",i.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Nn(){const{telemetry:{project:e}}=oe((e=>e.app)),n=le(),{content:s,realColumns:a}=oe((e=>e.crawl)),{project:m}=oe((e=>e.param)),{isModalOpen:u}=oe((e=>e.audio)),{style:x,metadata:j}=m,g=ne.isAllowAnalytics(),{t:f}=xn(),[w,k]=jn.useState("png"),v={png:f("header.download.png"),svg:f("header.download.svg")},[y,S]=jn.useState({width:1,height:1,benchmark:.001}),[H,O]=jn.useState(200),A=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],D=Object.fromEntries(A.map((e=>[e,`${e}%`]))),[M,E]=jn.useState([]),W=[{type:"select",label:f("header.download.format"),value:w,options:v,onChange:e=>k("png"===e?"png":"svg")}],P=[{type:"select",label:f("header.download.scale"),value:H,options:D,disabledOptions:M,onChange:e=>O(e)}],[R,N]=jn.useState(!1),[I,L]=jn.useState(!1),[V,X]=jn.useState(!1);return jn.useEffect((()=>{(async()=>{const e=await An.maxArea({usePromise:!0,useWorker:!0});S(e)})()}),[]),jn.useEffect((()=>{if(R){const[e,n]=[a*Ne*H/100,Ie*Ne*H/100],i=A.filter((i=>e*i/100>y.width||n*i/100>y.height));E(i)}}),[R]),i.jsxs(U,{id:"download",children:[i.jsx(_,{as:t,size:"sm",variant:"ghost",icon:i.jsx(De,{})}),i.jsxs(B,{children:[i.jsx(G,{icon:i.jsx(Me,{}),onClick:()=>{g&&ne.event(Oe.DOWNLOAD_PARAM,e?{style:x,"#stations":Object.keys(j).length}:{}),Dn(`RMA_${(new Date).valueOf()}.json`,"application/json",JSON.stringify(m,null,2))},children:f("header.download.config")}),i.jsx(G,{icon:i.jsx(Ee,{}),onClick:()=>N(!0),children:f("header.download.image")}),i.jsx(G,{icon:i.jsx(Pe,{}),onClick:()=>n(We()),children:f("header.download.audio")})]}),i.jsxs(r,{size:"xl",isOpen:R,onClose:()=>N(!1),children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:f("header.download.image")}),i.jsx(h,{}),i.jsxs(c,{children:[i.jsx(wn,{fields:W}),"svg"===w&&i.jsx(wn,{fields:[]}),"png"===w&&i.jsx(wn,{fields:P}),"png"===w&&M.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(p,{as:"i",fontSize:"sm",children:f("header.download.disabledScaleOptions")}),i.jsx("br",{}),i.jsx(p,{as:"i",fontSize:"sm",children:f("header.download.disabledScaleOptionsWorkarounds")}),i.jsxs(C,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",i.jsx(T,{as:fe})]}),i.jsx("br",{})]}),i.jsx("br",{}),i.jsx(Y,{isChecked:V,onChange:e=>X(e.target.checked),children:i.jsxs(p,{children:[f("header.download.termsAndConditionsInfo"),i.jsxs(C,{color:"teal.500",onClick:()=>L(!0),children:[f("header.download.termsAndConditions")," ",i.jsx(T,{as:fe})]}),f("header.download.period")]})})]}),i.jsx(z,{children:i.jsx(F,{children:i.jsx(b,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!V||"png"===w&&M.includes(H),onClick:()=>{const e=document.getElementById("crawl").cloneNode(!0),n=e.outerHTML;if("svg"===w)return void Dn(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",n);document.body.appendChild(e);const i="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)));document.body.removeChild(e),e.remove();const t=document.createElement("canvas"),[r,o]=[a*Ne*H/100,Ie*Ne*H/100];t.width=r,t.height=o;const l=t.getContext("2d");l.fillStyle="black",l.fillRect(0,0,r,o);const d=new Image;d.onload=()=>{setTimeout((()=>{l.drawImage(d,0,0,r,o),t.toBlob((e=>{Mn(`RMA_${s}.png`,e)}),"image/png")}),0)},d.src=i},children:f("header.download.confirm")})})}),i.jsx(Rn,{isOpen:I,onClose:()=>L(!1)})]})]}),i.jsx(Pn,{isOpen:u,onClose:()=>n(Re())})]})}const In=e=>{const n=["linestart"],i=[["linestart"]];let s=0;for(;n.length;){let a=n.shift(),t=i[s].slice(-1)[0]||null;for(t&&"linestart"!==a?i[s].push(a):i[s]=[a];"lineend"!==a;){t=a;const r=e[t].children;switch(r.length){case 1:a=r[0];break;case 2:{const o=e[t].branch.right,l=o[1];"through"===o[0]?(i.push(i[s].slice()),n.push(l)):0===s&&(i.push([t]),n.push(l)),a=r.filter((e=>e!==l))[0];break}}if(i[s].push(a),t===e[a].branch?.left?.[1]&&"nonthrough"===e[a].branch?.left?.[0])break}s++}return i},Ln=e=>{for(const n in e)e[n]=e[n].replaceAll("\\"," ").replaceAll("\n"," ");return e},Un=(e,n,i=Le.local)=>{const s=structuredClone(Ue),{line_name:a,stn_list:t,loop:r,direction:o}=e,l="left",d=In(t).map((e=>e.slice(1,-1)));o===_e.left&&d.forEach((e=>e.reverse()));let h=d.at(n)??d.at(-1);i!==Le.local&&(h=h.filter((e=>t[e].services.includes(i))));const c=h,m=new Set(c.map((e=>t[e].services)).flat()),p=c.at(-1),u=d.map((e=>e[e.length-1])).find((e=>e!==p)),{localisedName:x}=t[p];Ln(x),s.baseVariants=((e,n,i="left",s="left",a,t=!0,r=!1,o="none",l=!1,d=Le.local)=>({[Be.Arrival]:{[Ge.ChineseWuSimplifiedXiaotong]:{terminal:e.zh,terminalPinyin:e.zh,doorDirection:i,thanksForTaking:a?.at(0),thanksForTakingPinyin:a?.at(0)},[Ge.ChineseMandarinSimplified]:{terminal:e.zh,terminalPinyin:e.zh,doorDirection:i,thanksForTaking:a?.at(0),thanksForTakingPinyin:a?.at(0)},[Ge.ChineseWuSimplifiedYunzhe]:{terminal:e.en,terminalPinyin:e.en,doorDirection:i,thanksForTaking:a?.at(1),thanksForTakingPinyin:a?.at(1)}},[Be.Departure]:{[Ge.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:a?.at(0),welcomeAbroadPinyin:a?.at(0),terminal:e.zh,terminalPinyin:e.zh,nextDoorDirection:s,lineName:n[0],lineNamePinyin:n[0],noteLastTrain:t,loop:o,loopTerminal:l,service:d},[Ge.ChineseMandarinSimplified]:{welcomeAbroad:a?.at(0),welcomeAbroadPinyin:a?.at(0),terminal:e.zh,terminalPinyin:e.zh,nextDoorDirection:s,lineName:n[0],lineNamePinyin:n[0],noteLastTrain:t,loop:o,loopTerminal:l,service:d},[Ge.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:a?.at(1),welcomeAbroadPinyin:a?.at(0),terminal:e.en,terminalPinyin:e.en,nextDoorDirection:s,lineName:n[1],lineNamePinyin:n[1],service:d}},[Be.Midway]:{[Ge.ChineseWuSimplifiedXiaotong]:{caution:r},[Ge.ChineseMandarinSimplified]:{caution:r},[Ge.ChineseWuSimplifiedYunzhe]:{}}}))(x,a,l,"left",void 0,void 0,void 0,r?"inner":"none",!1,m.has(i)?i:Le.local);for(const[j,g]of c.entries()){const{localisedName:e}=t[g];if(Ln(e),s.metadata[g]={name:Object.values(e).at(0)??""},s.stations[g]={},s.stations[g][Be.Midway]={[Ge.ChineseWuSimplifiedXiaotong]:{},[Ge.ChineseMandarinSimplified]:{},[Ge.ChineseWuSimplifiedYunzhe]:{}},0!==j&&(s.stations[g][Be.Arrival]={[Ge.ChineseWuSimplifiedXiaotong]:{name:e.zh,namePinyin:e.zh},[Ge.ChineseMandarinSimplified]:{name:e.zh,namePinyin:e.zh},[Ge.ChineseWuSimplifiedYunzhe]:{name:e.en,namePinyin:e.en}}),j!==c.length-1||r){const e=r&&j===c.length-1?c[0]:c[j+1],{localisedName:n}=t[e];Ln(n);const a=t[e].transfer.groups.map((e=>e.lines?.map((e=>e.name)))).filter((e=>void 0!==e));if(s.stations[g][Be.Departure]={[Ge.ChineseWuSimplifiedXiaotong]:{next:n.zh,nextPinyin:n.zh,int:a?.map((e=>e?.map((e=>e[0]))))},[Ge.ChineseMandarinSimplified]:{next:n.zh,nextPinyin:n.zh,int:a?.map((e=>e?.map((e=>e[0]))))},[Ge.ChineseWuSimplifiedYunzhe]:{next:n.en,nextPinyin:n.en,int:a?.map((e=>e?.map((e=>e[1])))),noteLastTrain:!1}},u&&j+1<c.length&&t[c[j+1]].branch?.["l"===o?Ye.left:Ye.right]){const{localisedName:e}=t[u];Ln(e),s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedXiaotong]={...s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedXiaotong],branchTerminalName:e.zh,branchTerminalNamePinyin:e.zh},s.stations[g][Be.Departure][Ge.ChineseMandarinSimplified]={...s.stations[g][Be.Departure][Ge.ChineseMandarinSimplified],branchTerminalName:e.zh,branchTerminalNamePinyin:e.zh},s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedYunzhe]={...s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedYunzhe],branchTerminalName:e.en,branchTerminalNamePinyin:e.en}}if(i!==Le.local){const e=c.slice(j+1,-1).map((e=>{const{localisedName:n}=t[e];return Ln(n),n}));s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedXiaotong]={...s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedXiaotong],stopovers:e.map((e=>e.zh))},s.stations[g][Be.Departure][Ge.ChineseMandarinSimplified]={...s.stations[g][Be.Departure][Ge.ChineseMandarinSimplified],stopovers:e.map((e=>e.zh))},s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedYunzhe]={...s.stations[g][Be.Departure][Ge.ChineseWuSimplifiedYunzhe],stopovers:e.map((e=>e.en))}}}}if(r){const e=c[0],{localisedName:n}=t[e];Ln(n),s.stations[e][Be.Arrival]={[Ge.ChineseWuSimplifiedXiaotong]:{name:n.zh,namePinyin:n.zh,doorDirection:l},[Ge.ChineseMandarinSimplified]:{name:n.zh,namePinyin:n.zh,doorDirection:l},[Ge.ChineseWuSimplifiedYunzhe]:{name:n.en,namePinyin:n.en,doorDirection:l}}}return s},_n=()=>{const{t:e}=xn(),n=le(),s=ne.isAllowAnalytics(),{rmgParam:a,route:t,service:m}=oe((e=>e.import)),g=a?In(a.stn_list).map((e=>[e.at(1),e.at(-2)])):[],f=a?g.map((e=>e.map((e=>Object.values(a.stn_list[e].localisedName).join(" "))))):[],w=new Set(Object.values(a?.stn_list??{}).map((e=>e.services)).flat());return i.jsxs(r,{isOpen:void 0!==a,onClose:()=>n(Xe()),size:"lg",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:e("import.title")}),i.jsx(h,{color:"white"}),i.jsxs(c,{py:3,children:[1===g.length&&1===w.size&&i.jsx(p,{children:e("import.goodToGo")}),g.length>1&&i.jsxs(i.Fragment,{children:[i.jsx(x,{fontSize:"md",mb:4,children:e("import.routes")}),i.jsx(V,{onChange:e=>n(Fe(Number(e))),value:t.toString(),children:i.jsx(F,{spacing:4,align:"stretch",children:f.map(((e,n)=>i.jsx(u,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:t===n?"blue.500":"gray.200",children:i.jsx(X,{value:n.toString(),colorScheme:"blue",children:i.jsx(j,{align:"start",spacing:1,ml:2,children:i.jsx(p,{fontSize:"sm",children:e.join(" <=> ")})})})},n)))})})]}),w.size>1&&i.jsxs(i.Fragment,{children:[i.jsx(x,{fontSize:"md",mb:4,children:e("import.services")}),i.jsx(V,{onChange:e=>n(Ve(e)),value:m,children:i.jsx(F,{spacing:4,align:"stretch",children:[...w].map((n=>i.jsx(u,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:m===n?"blue.500":"gray.200",children:i.jsx(X,{value:n,colorScheme:"blue",children:i.jsx(j,{align:"start",spacing:1,ml:2,children:i.jsx(p,{fontSize:"sm",children:e(`import.service.${n}`)})})})},n)))})})]})]}),i.jsx(z,{children:i.jsx(b,{colorScheme:"teal",variant:"outline",onClick:()=>{if(a){s&&ne.event(Oe.IMPORT_RMG_PARAM);try{const e=Un(structuredClone(a),t,m);n($e(e)),n(Je(Object.keys(e.metadata)[0])),n(Ke(Be.Departure))}catch(i){n(ue({status:"error",message:e("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",i)}finally{n(Xe()),n(Fe(0)),n(Ve(Le.local))}}},children:e("import.import")})})]})]})},Bn="rmg-bridge--",Gn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Yn(e){const{isOpen:n,onClose:s}=e,{t:a}=xn(),t=le(),[r]=un.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:ne.getAppName(),parentId:r});return un.useEffect((()=>{const e=new BroadcastChannel(Bn+r);return e.onmessage=e=>{const{event:n,data:i}=e.data;je.info("Received event from RMG app clip:",n),"CLOSE"===n?s():"IMPORT"===n&&(e=>{try{t(Ze(e))}catch(n){t(ue({status:"error",message:a("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",n)}finally{s()}})(i)},()=>e.close()}),[]),i.jsx(qe,{isOpen:n,onClose:s,sx:Gn,children:i.jsx("iframe",{src:o,loading:"lazy"})})}function Fn(){const e=le(),{t:s}=xn(),{preference:{import:{route:a,service:r}}}=oe((e=>e.app)),o=n(ne.getEnv),l=jn.useRef(null),d=jn.useRef(null),[h,c]=jn.useState(!1);return i.jsxs(U,{children:[i.jsx(_,{as:t,size:"sm",variant:"ghost",icon:i.jsx(Qe,{})}),i.jsxs(B,{children:[i.jsx("input",{id:"upload_project",ref:l,type:"file",accept:".json",hidden:!0,onChange:async n=>{const i=n.target.files?.[0];if(je.info("OpenActions.handleUpload():: received file",i),"application/json"!==i?.type)e(ue({status:"error",message:s("header.open.invalidType")})),je.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const a=await Vn(i),t=JSON.parse(a);if(!("baseVariants"in t))return e(ue({status:"error",message:s("header.open.invalidType")})),je.error("OpenActions.handleUpload():: Not a valid RMA project."),void(n.target.value="");e($e(t)),e(Je(Object.keys(t.metadata)[0])),e(Ke(Be.Departure))}catch(a){e(ue({status:"error",message:s("header.open.unknownError")})),je.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",a)}n.target.value=""},"data-testid":"file-upload"}),i.jsx(G,{icon:i.jsx(Qe,{}),onClick:()=>l?.current?.click(),children:s("header.open.config")}),i.jsx("input",{id:"upload_RMG",ref:d,type:"file",accept:".json",hidden:!0,onChange:async n=>{const i=n.target.files?.[0];if(je.info("OpenActions.handleUpload():: received file",i),"application/json"!==i?.type)e(ue({status:"error",message:s("header.open.invalidType")})),je.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const n=await Vn(i);e(Ze(JSON.parse(n)))}catch(a){e(ue({status:"error",message:s("header.open.unknownError")})),je.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",a)}n.target.value=""},"data-testid":"file-upload"}),o===en.DEV&&i.jsx(G,{icon:i.jsx(Qe,{}),onClick:()=>d?.current?.click(),children:s("header.open.RMG")}),i.jsx(G,{icon:i.jsx(nn,{}),onClick:()=>c(!0),children:s("header.open.projectRMG")})]}),i.jsx(Yn,{isOpen:h,onClose:()=>c(!1)})]})}const Vn=e=>new Promise((n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.readAsText(e)})),Xn=e=>{const{isOpen:n,onClose:s}=e,{telemetry:{project:t},preference:{import:{route:m,service:g},previewAudio:f}}=oe((e=>e.app)),w=le(),{t:z}=xn(),b=v("primary.500","primary.300"),{scale:k}=oe((e=>e.crawl)),y=de(),[S,H]=jn.useState({[Ge.ChineseMandarinSimplified]:[],[Ge.ChineseWuSimplifiedXiaotong]:[],[Ge.ChineseWuSimplifiedYunzhe]:[]});jn.useEffect((()=>{H({[Ge.ChineseMandarinSimplified]:y.filter((e=>e.lang===he[sn.ShanghaiMetro]?.defaultLang?.[Ge.ChineseMandarinSimplified])).map((e=>e.name)),[Ge.ChineseWuSimplifiedXiaotong]:[],[Ge.ChineseWuSimplifiedYunzhe]:y.filter((e=>e.lang===he[sn.ShanghaiMetro]?.defaultLang?.[Ge.ChineseWuSimplifiedYunzhe])).map((e=>e.name))})}),[y]);const O=(e,n)=>{w("undefined"===n?tn(e):rn([e,n]))},A=ne.isAllowAnalytics();return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:z("header.settings.title")}),i.jsx(h,{}),i.jsx(c,{children:i.jsxs(j,{divider:i.jsx(K,{borderColor:"gray.200"}),children:[i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:z("header.settings.crawl.title")}),i.jsx(u,{mt:"3",children:i.jsx(ie,{label:z("header.settings.crawl.scale"),children:i.jsx(ae,{defaultValue:k,value:k,min:.1,max:1,step:.1,onThrottledChange:e=>w(an(e))})})})]}),i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:z("header.settings.previewAudio.title")}),i.jsxs(u,{mt:"3",children:[i.jsxs(u,{mb:"1",display:"flex",children:[i.jsx(p,{flex:"1",children:z("header.settings.previewAudio.shmetro-zh")}),i.jsxs($,{size:"xs",width:"300px",ml:"1",defaultValue:f[Ge.ChineseMandarinSimplified]??"undefined",onChange:({target:{value:e}})=>O(Ge.ChineseMandarinSimplified,e),children:[i.jsx("option",{value:"undefined",children:z("header.settings.previewAudio.notModified")}),S[Ge.ChineseMandarinSimplified].map((e=>i.jsx("option",{value:e,children:e},e)))]})]}),i.jsxs(u,{mb:"1",display:"flex",children:[i.jsx(p,{flex:"1",children:z("header.settings.previewAudio.shmetro-en")}),i.jsxs($,{size:"xs",width:"300px",ml:"1",defaultValue:f[Ge.ChineseWuSimplifiedYunzhe]??"undefined",onChange:({target:{value:e}})=>O(Ge.ChineseWuSimplifiedYunzhe,e),children:[i.jsx("option",{value:"undefined",children:z("header.settings.previewAudio.notModified")}),S[Ge.ChineseWuSimplifiedYunzhe].map((e=>i.jsx("option",{value:e,children:e},e)))]})]})]})]}),i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:z("header.settings.telemetry.title")}),i.jsxs(u,{mt:"3",children:[i.jsx(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:z("header.settings.telemetry.info")}),i.jsxs(u,{mt:"3",mb:"1",children:[i.jsxs(u,{display:"flex",mb:"1",children:[i.jsx(p,{flex:"1",children:z("header.settings.telemetry.essential")}),i.jsx(J,{label:z("header.settings.telemetry.essentialTooltip"),children:i.jsx(a,{isChecked:A,isDisabled:!0})})]}),i.jsx(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:z("header.settings.telemetry.essentialInfo")}),i.jsxs(C,{color:b,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[z("header.settings.telemetry.essentialLink")," ",i.jsx(T,{as:fe})]})]}),i.jsxs(u,{mt:"1",mb:"1",children:[i.jsxs(u,{display:"flex",children:[i.jsx(p,{flex:"1",children:z("header.settings.telemetry.additional")}),i.jsx(a,{isChecked:t,onChange:({target:{checked:e}})=>{w(on(e))}})]}),i.jsx(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:z("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})};function $n(){const{t:e}=xn();le();const s=ne.isAllowAnalytics(),[a,r]=jn.useState(!1),[o,l]=jn.useState(!1),d=n(ne.getEnv),h=n(ne.getAppVersion);return jn.useEffect((()=>{s&&d!==en.DEV&&ne.event(Oe.APP_LOAD,{isStandaloneWindow:ne.isStandaloneWindow()})}),[d]),i.jsxs(ln,{children:[i.jsx(x,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rma")}),i.jsx(dn,{environment:d,version:h,popoverHeader:d===en.PRD?void 0:i.jsxs(gn,{i18nKey:"header.popoverHeader",environment:d,children:["You're on ",{environment:d}," environment!"]}),popoverBody:d===en.PRD?void 0:i.jsx(gn,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),i.jsxs(q,{ml:"auto",children:[i.jsx(Z,{children:i.jsx(kn,{})}),i.jsx(Z,{children:i.jsx(Fn,{})}),i.jsx(Z,{children:i.jsx(Nn,{})}),i.jsx(Z,{children:i.jsx(t,{size:"sm",variant:"ghost","aria-label":"Settings",icon:i.jsx(hn,{}),onClick:()=>r(!0)})}),ne.isStandaloneWindow()&&i.jsx(Z,{children:i.jsxs(U,{children:[i.jsx(_,{as:t,icon:i.jsx(cn,{}),variant:"ghost",size:"sm"}),i.jsx(B,{children:["en","zh-Hans","zh-Hant","ja","ko"].map((e=>i.jsx(G,{onClick:()=>{return n=e,void ne.getI18nInstance().changeLanguage(n);var n},children:zn[e][e]},e)))})]})}),i.jsx(Z,{children:i.jsx(t,{size:"sm",variant:"ghost","aria-label":"Help",icon:i.jsx(mn,{}),onClick:()=>l(!0)})})]}),i.jsx(Xn,{isOpen:a,onClose:()=>r(!1)}),i.jsx(vn,{isOpen:o,onClose:()=>l(!1)}),i.jsx(_n,{})]})}function Jn(){const e=le(),n=oe((e=>e.runtime.globalAlerts));return i.jsx(i.Fragment,{children:Object.entries(n).map((([n,{message:s,url:a,linkedApp:t}])=>i.jsxs(A,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[i.jsx(D,{}),t?i.jsx(C,{onClick:()=>(e=>{ne.isStandaloneWindow()?window.open(`/${e}`,"_blank"):ne.openApp({appId:e})})(t),children:s}):a?i.jsx(C,{href:a,target:"_blank",children:s}):s,i.jsx(Q,{ml:"auto",onClick:()=>e(pn(n))})]},n)))})}}}}));
