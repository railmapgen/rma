import{j as e,h as he,aq as Le,a1 as X,ak as J,M as K,al as q,G as Z,H as Q,J as N,ar as Tn,K as x,B as L,an as V,am as $,T as me,as as xe,b as ge,L as Te,N as ue,at as yn,O as Fe,au as An,ap as se,Q as T,av as H,aw as Mn,q as On,R as fe,U as be,ad as Hn,ae as Pn,af as Dn,ag as Ne,ah as ae,ai as Rn,aj as oe,ao as En,ax as Ve,ay as Ye,az as Xe,aA as te,aB as In,aC as Ue,aD as en,aE as nn,a0 as sn,aF as Wn,aG as Ln,k as Un,W as re,aH as Bn}from"./chakra-BiadmNKO.js";import{u as Gn,r as D,R as pn,a as _n,b as mn,c as Fn,d as Vn,e as E,f as G,g as xn,v as we,M as Yn,h as Xn,i as $n,s as Y,p as Jn,l as _,n as Kn,j as P,k as qn,m as Zn,o as Qn,q as Nn,A as tn,t as es,w as ns,x as ss,y as ts,z as is,E as ye,B as as,C as os,D as rs,F as ls,G as cs,H as ds,I as hs,J as Se,K as an,L as us,S as ce,N as ps,O as ms,P as O,V as g,Q as on,T as rn,U as ln,W as cn,X as gn,Y as jn,Z as fn,_ as xs,$ as bn,a0 as Re,a1 as Ce,a2 as gs,a3 as dn,a4 as js,a5 as fs,a6 as bs,a7 as ws,a8 as zs,a9 as ks,aa as Ss,ab as vs,ac as Cs,ad as Ts}from"./index-Cdt__kbg.js";import{a as Be,m as B,d as C,T as hn}from"./react-DFJlY5Ze.js";import{R as ys}from"./rmg-output-B97GirQX.js";var Ge=function(s){return Gn(D.ready(),s)};function Ee(s){var i=s.fields,o=s.noLabel,n=s.minW;return e.jsx(he,{wrap:"wrap",children:i.map(function(a,c){if(a.hidden)return e.jsx(Be.Fragment,{},c);var d=a.minW||n,u=d==="full";return e.jsx(pn,{className:u?"mw-full":"",label:a.label,flex:u?void 0:1,minW:u?void 0:d,noLabel:o,oneLine:a.oneLine,helper:a.helper,errorMessage:a.errorMessage,children:function(t){switch(t.type){case"input":return e.jsx(Vn,{placeholder:t.placeholder,defaultValue:t.value,type:t.variant,validator:t.validator,onDebouncedChange:t.onChange,delay:t.debouncedDelay,optionList:t.optionList,isDisabled:t.isDisabled});case"output":return e.jsx(ys,{noWrap:t.noWrap,children:t.value});case"textarea":return e.jsx(Fn,{placeholder:t.placeholder,defaultValue:t.value,onDebouncedChange:t.onChange,isDisabled:t.isDisabled});case"slider":return e.jsx(mn,{defaultValue:t.value,min:t.min,max:t.max,step:t.step,onThrottledChange:t.onChange,leftIcon:t.leftIcon,rightIcon:t.rightIcon,isDisabled:t.isDisabled});case"select":return e.jsx(_n,{defaultValue:t.value,onChange:function(m){var f,r=m.target.value;return(f=t.onChange)===null||f===void 0?void 0:f.call(t,typeof t.value=="number"?Number(r):r.toString())},options:t.options,disabledOptions:t.disabledOptions,isInvalid:t.isInvalid,isDisabled:t.isDisabled});case"switch":return e.jsx(Le,{isChecked:t.isChecked,isDisabled:t.isDisabled,onChange:function(m){var f,r=m.target.checked;return(f=t.onChange)===null||f===void 0?void 0:f.call(t,r)}});case"custom":return t.component;default:return e.jsx("div",{})}}(a)},c)})})}var As={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Ms=()=>{const s=navigator.platform.toLowerCase();return s.includes("win")?"win":s.includes("android")?"android":s.includes("mac")?"mac":s.includes("iphone")||s.includes("ipad")?"ios":s.includes("linux")?"linux":"unknown"},Os=Ms();function Hs(){const{reconciledPhrases:s,currentStyle:i,currentStationID:o,currentStage:n,currentVoice:a}=E(b=>b.runtime),{preference:{previewAudio:c}}=E(b=>b.app),d=G(),{t:u}=B(),[t,m]=C.useState(!1),[f,r]=C.useState(!1),l=xn();C.useEffect(()=>{var M,k;const b=(k=(M=we[i])==null?void 0:M.defaultLang)==null?void 0:k[a],y=l.find(p=>p.lang===b);r(!!y)},[a,l]);const w=()=>{var F,U,I,S,R,W,ee,pe,Ae;d(Y({status:"info",message:u("header.paly.previewWarning")}));const b=window.speechSynthesis;if(b.paused&&b.speaking){m(!0),b.resume();return}const y=(U=(F=s[o])==null?void 0:F[n])==null?void 0:U[a],M=Jn(y!=null?y:[]),k=M===""?" ":M,p=new SpeechSynthesisUtterance(k),j=(W=c[a])!=null?W:(R=(S=(I=we[i])==null?void 0:I.preferredPreviewVoiceName)==null?void 0:S[a])==null?void 0:R[Os],h=b.getVoices().find(Je=>Je.name===j),A=(pe=(ee=we[i])==null?void 0:ee.defaultLang)==null?void 0:pe[a];if(h)p.voice=h;else if(A)p.lang=A;else{_.error("Preview language not found for",a);return}p.onend=()=>{m(!1)},m(!0),_.debug('Previewing audio "'.concat(k,'" with ').concat((Ae=p.voice)==null?void 0:Ae.name)),b.speak(p)},z=()=>{window.speechSynthesis.pause(),m(!1)};return e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Settings",icon:f?t?e.jsx(Yn,{}):e.jsx(Xn,{}):e.jsx($n,{}),isDisabled:!f,onClick:t?z:w})}const Ps=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B(),a=D.getAppVersion();return e.jsxs(J,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.about.title")}),e.jsx(Q,{}),e.jsxs(N,{paddingBottom:10,children:[e.jsxs(he,{direction:"row",children:[e.jsx(Tn,{boxSize:"128px",src:"/rma//logo192.png"}),e.jsxs(he,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(x,{fontSize:"xl",as:"b",children:n("header.about.rma")}),e.jsx(x,{children:a}),e.jsx(x,{}),e.jsx(x,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(L,{margin:5,children:e.jsx(x,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(V,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx($,{children:e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(x,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(x,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]})}),e.jsx(V,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs($,{children:[e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(x,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(x,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(x,{fontSize:"sm",as:"i",children:"#rma, #rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(V,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),e.jsxs($,{children:[e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",pb:1,children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),e.jsx(x,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",pb:1,children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),e.jsx(x,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function ze(s){const i=s.sizes.shift(),o=Math.max(Math.ceil(i[0]),1),n=Math.max(Math.ceil(i[1]),1),a=[o-1,n-1,1,1],c=performance.now(),d=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let u,t;d?(u=new OffscreenCanvas(1,1),t=new OffscreenCanvas(o,n)):(u=document.createElement("canvas"),u.width=1,u.height=1,t=document.createElement("canvas"),t.width=o,t.height=n);const m=u.getContext("2d"),f=t.getContext("2d");f&&(f.fillRect.apply(f,a),m.drawImage(t,o-1,n-1,1,1,0,0,1,1));const r=m&&m.getImageData(0,0,1,1).data[3]!==0,l=parseInt(performance.now()-c);return[u,t].forEach(w=>{w.height=0,w.width=0}),d?(postMessage({width:o,height:n,testTime:l,isTestPass:r}),!r&&s.sizes.length&&setTimeout(()=>{ze(s)},0)):r?s.onSuccess({width:o,height:n,testTime:l}):(s.onError({width:o,height:n,testTime:l}),s.sizes.length&&setTimeout(()=>{ze(s)},0)),r}const Ie={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},de={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},je={};function We(s){const i=s.width===s.height,o=s.height===1,n=s.width===1,a=[];if(!s.width||!s.height)s.sizes.forEach(c=>{const d=i||o?c:1,u=i||n?c:1;a.push([d,u])});else{const c=s.min||de.min,d=s.step||de.step;let u=Math.max(s.width,s.height);for(;u>=c;){const t=i||o?u:1,m=i||n?u:1;a.push([t,m]),u-=d}}return a}function ve(s){const i=typeof window<"u",o=i&&"Promise"in window,n=i&&"HTMLCanvasElement"in window,a=i&&"OffscreenCanvas"in window,c=URL.createObjectURL(new Blob([])).slice(-36),d=performance.now(),{onError:u,onSuccess:t,...m}=s,f=()=>parseInt(performance.now()-d);let r=null;if(!n)return!1;if(s.useWorker&&a){const l="\n            var canvasTest = ".concat(ze.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),w=new Blob([l],{type:"application/javascript"}),z=URL.createObjectURL(w);r=new Worker(z),URL.revokeObjectURL(z),r.onmessage=function(b){const{width:y,height:M,testTime:k,isTestPass:p}=b.data,j={width:y,height:M,testTime:k,totalTime:f()};p?(je[c].onSuccess(j),delete je[c]):je[c].onError(j)}}if(o)return new Promise(l=>{const w={...s,onError(z){let{width:b,height:y,testTime:M}=z;const k={width:b,height:y,testTime:M,totalTime:f()};let p;if(s.sizes.length===0)p=!0;else{const[[j,h]]=s.sizes.slice(-1);p=b===j&&y===h}u(k),p&&l({...k,success:!1})},onSuccess(z){let{width:b,height:y,testTime:M}=z;const k={width:b,height:y,testTime:M,totalTime:f()};t(k),l({...k,success:!0})}};if(r){const{onError:z,onSuccess:b}=w;je[c]={onError:z,onSuccess:b},r.postMessage(m)}else ze(w)});if(r)je[c]={onError:u,onSuccess:t},r.postMessage(m);else return ze(s)}const Ds={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=We({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...Ie.area]}),o={...de,...s,sizes:i};return ve(o)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=We({width:1,height:s.max,min:s.min,step:s.step,sizes:[...Ie.height]}),o={...de,...s,sizes:i};return ve(o)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=We({width:s.max,height:1,min:s.min,step:s.step,sizes:[...Ie.width]}),o={...de,...s,sizes:i};return ve(o)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={...de,...s};return i.sizes=[...i.sizes],i.width&&i.height&&(i.sizes=[[i.width,i.height]]),ve(i)}},_e=(s,i,o)=>{const n=new Blob([o],{type:i});$e(s,n)},$e=(s,i)=>{const o=window.URL.createObjectURL(i),n=document.createElement("a");n.href=o,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)},Rs=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B(),a=G(),{reconciledPhrases:c}=E(t=>t.runtime),{points:d}=E(t=>t.audio),u=Object.keys(c).length*100;return e.jsxs(J,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.audioTask.new.title")}),e.jsx(Q,{}),e.jsxs(N,{paddingBottom:10,children:[e.jsx(x,{children:n("header.audioTask.new.content1")}),e.jsxs(x,{children:[n("header.audioTask.new.content2"),u]}),e.jsx(x,{children:n("header.audioTask.new.content3")}),e.jsx(x,{children:n("header.audioTask.new.content4")})]}),e.jsx(Te,{children:e.jsx(ue,{style:{alignSelf:"center"},onClick:()=>a(Kn()),isDisabled:d<u,children:n("header.audioTask.new.create")})})]})]})},Es=s=>{yn();const{t:i}=B(),{isOpen:o,onClose:n}=s,a=G(),c=Fe("primary.500","primary.300"),[d,u]=C.useState("");return e.jsxs(J,{isOpen:o,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:i("header.audioTask.redeem.title")}),e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(x,{mb:"4",children:i("header.audioTask.redeem.desc")}),e.jsx(An,{children:e.jsx(se,{children:e.jsxs(T,{color:c,href:"https://afdian.com/item/851c2bb4110d11f0935a5254001e7c00",isExternal:!0,children:["爱发电 ",e.jsx(H,{as:P})]})})}),e.jsxs(Mn,{mt:"5",direction:{base:"column",sm:"row"},children:[e.jsx(x,{mr:"auto",children:i("header.audioTask.redeem.input")}),e.jsx(On,{w:"200px",value:d,onChange:t=>u(t.target.value)}),e.jsx(ue,{colorScheme:"teal",onClick:()=>a(qn(d.trim())),children:i("header.audioTask.redeem.redeem")})]})]}),e.jsx(Te,{})]})]})},Is="https://github.com/railmapgen/rma/issues/new?template=task-report.yml",Ws=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B(),a=G(),{telemetry:{project:c}}=E(h=>h.app),{tasks:d,points:u}=E(h=>h.audio),{rmtToken:t,reconciledPhrases:m}=E(h=>h.runtime),{project:f}=E(h=>h.param),{style:r,metadata:l}=f,w=D.isAllowAnalytics(),z=Fe("primary.500","primary.300"),[b,y]=C.useState(!1),[M,k]=C.useState(!1);C.useEffect(()=>{i&&a(Zn())},[i]);const p=async h=>{const A=await ts("".concat(is.AUDIOTASKS,"/").concat(h,"/download"),{},t);if(!A||!A.ok)throw new Error("Download error");$e("".concat(h,".zip"),await A.blob())},j=()=>{w&&D.event(ye.DOWNLOAD_TEXT,c?{style:r,"#stations":Object.keys(l).length}:{});const h=as(m);_e("RMA_".concat(new Date().valueOf(),".txt"),"text/plain",h.join("\n"))};return e.jsxs(J,{isOpen:i,onClose:o,size:"4xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.download.audio")}),e.jsx(Q,{}),e.jsxs(N,{paddingBottom:10,children:[e.jsx(x,{fontSize:"lg",mb:"4",children:n("header.audioTask.desc")}),e.jsx(x,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleZH")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-zh.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),e.jsx(x,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleEN")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-en.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),e.jsxs(fe,{status:"info",mt:"4",children:[e.jsx(be,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note1")})]}),e.jsxs(fe,{status:"info",mt:"4",children:[e.jsx(be,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note2")})]}),e.jsxs(fe,{status:"info",mt:"4",children:[e.jsx(be,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note3")})]}),e.jsxs(fe,{status:"warning",mt:"4",children:[e.jsx(be,{}),e.jsx(x,{fontSize:"md",color:"gray.600",children:n("header.audioTask.note4")})]}),t?e.jsxs(e.Fragment,{children:[e.jsxs(he,{pl:"4",pr:"4",mt:"10",mb:"4",children:[e.jsx(x,{as:"b",fontSize:"4xl",children:u}),e.jsx(x,{style:{alignSelf:"self-end",marginLeft:"10px"},children:"pts"}),e.jsx(he,{style:{flex:1}}),e.jsx(x,{as:"b",style:{alignSelf:"self-end"},children:n("header.audioTask.title")}),e.jsx(he,{style:{flex:1}}),e.jsx(ue,{leftIcon:e.jsx(Qn,{}),style:{alignSelf:"center"},onClick:()=>k(!0),mr:"2",children:n("header.audioTask.topUp")}),e.jsx(Es,{isOpen:M,onClose:()=>k(!1)}),e.jsx(ue,{leftIcon:e.jsx(Nn,{}),style:{alignSelf:"center"},onClick:()=>y(!0),children:n("header.audioTask.new.title")}),e.jsx(Rs,{isOpen:b,onClose:()=>y(!1)})]}),e.jsx(Hn,{height:"100%",overflowY:"auto",children:e.jsxs(Pn,{variant:"simple",height:"100%",children:[e.jsx(Dn,{children:e.jsxs(Ne,{children:[e.jsx(ae,{children:n("header.audioTask.table.id")}),e.jsx(ae,{children:n("header.audioTask.table.status")}),e.jsx(ae,{children:n("header.audioTask.table.createdAt")}),e.jsx(ae,{children:n("header.audioTask.table.updatedAt")}),e.jsx(ae,{children:n("header.audioTask.table.points")}),e.jsx(ae,{children:n("header.audioTask.table.actions")})]})}),e.jsx(Rn,{children:d.map(({id:h,status:A,createdAt:F,updatedAt:U,points:I})=>e.jsxs(Ne,{children:[e.jsx(oe,{children:h}),e.jsx(oe,{children:A}),e.jsx(oe,{children:new Date(F).toLocaleString()}),e.jsx(oe,{children:new Date(U).toLocaleString()}),e.jsx(oe,{children:I}),e.jsxs(oe,{children:[A===tn.CREATED&&e.jsx(X,{icon:e.jsx(ns,{}),"aria-label":n("Cancel Task"),onClick:()=>a(es(h))}),A===tn.COMPLETED&&e.jsx(X,{icon:e.jsx(ss,{}),"aria-label":n("Download Audio"),onClick:()=>p(h)})]})]},h))})]})}),e.jsx($,{mt:10,children:e.jsxs(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[n("header.audioTask.report1"),e.jsx(T,{color:z,fontSize:"sm",lineHeight:"100%",onClick:()=>window.open(Is,"_blank"),children:n("header.audioTask.report2")}),n("header.audioTask.report3")]})})]}):e.jsx(x,{mt:"10",textAlign:"center",children:n("header.audioTask.loginFirst")}),e.jsx($,{mt:10,children:e.jsxs(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[n("header.audioTask.freeInternet1"),e.jsx(T,{color:z,fontSize:"sm",lineHeight:"100%",onClick:j,children:n("header.audioTask.freeInternet2")}),n("header.audioTask.freeInternet3")]})})]})]})]})},Ls=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B();return e.jsxs(J,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:n("header.download.termsAndConditions")}),e.jsx(Q,{}),e.jsx(N,{children:e.jsxs(En,{children:[e.jsxs(se,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(T,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(H,{as:P})]}),", ",e.jsxs(T,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(H,{as:P})]})," or ",e.jsxs(T,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(H,{as:P})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(T,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(H,{as:P})]}),"，",e.jsxs(T,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(H,{as:P})]}),"或",e.jsxs(T,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(H,{as:P})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(se,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:P})]})," and ",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:P})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:P})]}),"及",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:P})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(se,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(T,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(H,{as:P})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(T,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(H,{as:P})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(se,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(se,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(T,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:P})]})," ","– the open-source emoji and icon project. License:",e.jsxs(T,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:P})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(T,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:P})]}),"所设计。许可证：",e.jsxs(T,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:P})]})]}),e.jsxs(se,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Us(){const{telemetry:{project:s}}=E(v=>v.app),i=G(),{realColumns:o}=E(v=>v.crawl),{project:n}=E(v=>v.param),{reconciledPhrases:a,currentStationID:c,currentStage:d,currentVoice:u}=E(v=>v.runtime),{isModalOpen:t}=E(v=>v.audio),{style:m,metadata:f}=n,r=D.isAllowAnalytics(),{t:l}=B(),[w,z]=C.useState("png"),b={png:l("header.download.png"),svg:l("header.download.svg")},[y,M]=C.useState({width:1,height:1,benchmark:.001}),[k,p]=C.useState(200),j=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],h=Object.fromEntries(j.map(v=>[v,"".concat(v,"%")])),[A,F]=C.useState([]),U=[{type:"select",label:l("header.download.format"),value:w,options:b,onChange:v=>z(v==="png"?"png":"svg")}],I=[],S=[{type:"select",label:l("header.download.scale"),value:k,options:h,disabledOptions:A,onChange:v=>p(v)}],[R,W]=C.useState(!1),[ee,pe]=C.useState(!1),[Ae,Je]=C.useState(!1),[Ke,zn]=C.useState(!1);C.useEffect(()=>{(async()=>{const ie=await Ds.maxArea({usePromise:!0,useWorker:!0});M(ie)})()},[]),C.useEffect(()=>{if(R){const[v,ie]=[o*Se*k/100,an*Se*k/100],Me=j.filter(ne=>v*ne/100>y.width||ie*ne/100>y.height);F(Me)}},[R]);const kn=()=>{r&&D.event(ye.DOWNLOAD_PARAM,s?{style:m,"#stations":Object.keys(f).length}:{}),_e("RMA_".concat(new Date().valueOf(),".json"),"application/json",JSON.stringify(n,null,2))},Sn=()=>{var Ze,Qe;const v=(Qe=(Ze=a[c])==null?void 0:Ze[d])==null?void 0:Qe[u],ie=us(v!=null?v:[]),Me=ie===""?" ":ie,ne=document.getElementById("crawl").cloneNode(!0),qe=ne.outerHTML;if(w==="svg"){_e("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",qe);return}document.body.appendChild(ne);const vn="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(qe)));document.body.removeChild(ne),ne.remove();const ke=document.createElement("canvas"),[Oe,He]=[o*Se*k/100,an*Se*k/100];ke.width=Oe,ke.height=He;const Pe=ke.getContext("2d");Pe.fillStyle="black",Pe.fillRect(0,0,Oe,He);const De=new Image;De.onload=()=>{setTimeout(()=>{Pe.drawImage(De,0,0,Oe,He),ke.toBlob(Cn=>{$e("RMA_".concat(Me,".png"),Cn)},"image/png")},0)},De.src=vn};return e.jsxs(Ve,{id:"download",children:[e.jsx(Ye,{as:X,size:"sm",variant:"ghost",icon:e.jsx(os,{})}),e.jsxs(Xe,{children:[e.jsx(te,{icon:e.jsx(rs,{}),onClick:kn,children:l("header.download.config")}),e.jsx(te,{icon:e.jsx(ls,{}),onClick:()=>W(!0),children:l("header.download.image")}),e.jsx(te,{icon:e.jsx(ds,{}),onClick:()=>i(cs()),children:l("header.download.audio")})]}),e.jsxs(J,{size:"xl",isOpen:R,onClose:()=>W(!1),children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:l("header.download.image")}),e.jsx(Q,{}),e.jsxs(N,{children:[e.jsx(Ee,{fields:U}),w==="svg"&&e.jsx(Ee,{fields:I}),w==="png"&&e.jsx(Ee,{fields:S}),w==="png"&&A.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(x,{as:"i",fontSize:"sm",children:l("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(x,{as:"i",fontSize:"sm",children:l("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(T,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(H,{as:P})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(In,{isChecked:Ke,onChange:v=>zn(v.target.checked),children:e.jsxs(x,{children:[l("header.download.termsAndConditionsInfo"),e.jsxs(T,{color:"teal.500",onClick:()=>pe(!0),children:[l("header.download.termsAndConditions")," ",e.jsx(H,{as:P})]}),l("header.download.period")]})})]}),e.jsx(Te,{children:e.jsx(Ue,{children:e.jsx(ue,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Ke||w==="png"&&A.includes(k),onClick:Sn,children:l("header.download.confirm")})})}),e.jsx(Ls,{isOpen:ee,onClose:()=>pe(!1)})]})]}),e.jsx(Ws,{isOpen:t,onClose:()=>i(hs())})]})}const wn=s=>{var a,c,d,u;const i=["linestart"],o=[["linestart"]];let n=0;for(;i.length;){let t=i.shift(),m=o[n].slice(-1)[0]||null;for(m&&t!=="linestart"?o[n].push(t):o[n]=[t];t!=="lineend";){m=t;const f=s[m].children;switch(f.length){case 1:t=f[0];break;case 2:{const r=s[m].branch.right,l=r[1];r[0]==="through"?(o.push(o[n].slice()),i.push(l)):n===0&&(o.push([m]),i.push(l)),t=f.filter(w=>w!==l)[0];break}}if(o[n].push(t),m===((c=(a=s[t].branch)==null?void 0:a.left)==null?void 0:c[1])&&((u=(d=s[t].branch)==null?void 0:d.left)==null?void 0:u[0])==="nonthrough")break}n++}return o},Bs=(s,i,o="left",n="left",a,c=!0,d=!1,u="none",t=!1,m=ce.local)=>({[O.Arrival]:{[g.ChineseWuSimplifiedXiaotong]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:o,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[g.ChineseMandarinSimplified]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:o,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[g.ChineseWuSimplifiedYunzhe]:{terminal:s.en,terminalPinyin:s.en,doorDirection:o,thanksForTaking:a==null?void 0:a.at(1),thanksForTakingPinyin:a==null?void 0:a.at(1)}},[O.Departure]:{[g.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:c,loop:u,loopTerminal:t,service:m},[g.ChineseMandarinSimplified]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:c,loop:u,loopTerminal:t,service:m},[g.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:a==null?void 0:a.at(1),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.en,terminalPinyin:s.en,nextDoorDirection:n,lineName:i[1],lineNamePinyin:i[1],service:m}},[O.Midway]:{[g.ChineseWuSimplifiedXiaotong]:{caution:d},[g.ChineseMandarinSimplified]:{caution:d},[g.ChineseWuSimplifiedYunzhe]:{}}}),le=s=>{for(const i in s)s[i]=s[i].replaceAll("\\"," ").replaceAll("\n"," ");return s},Gs=(s,i,o=ce.local)=>{var M,k,p;const n=structuredClone(ps),{line_name:a,stn_list:c,loop:d,direction:u}=s,t="left",m="left",f=wn(c).map(j=>j.slice(1,-1));u===ms.left&&f.forEach(j=>j.reverse());let r=(M=f.at(i))!=null?M:f.at(-1);o!==ce.local&&(r=r.filter(j=>c[j].services.includes(o)));const l=r,w=new Set(l.map(j=>c[j].services).flat()),z=l.at(-1),b=f.map(j=>j[j.length-1]).find(j=>j!==z),{localisedName:y}=c[z];le(y),n.baseVariants=Bs(y,a,t,m,void 0,void 0,void 0,d?"inner":"none",!1,w.has(o)?o:ce.local);for(const[j,h]of l.entries()){const{localisedName:A}=c[h];if(le(A),n.metadata[h]={name:(k=Object.values(A).at(0))!=null?k:""},n.stations[h]={},n.stations[h][O.Midway]={[g.ChineseWuSimplifiedXiaotong]:{},[g.ChineseMandarinSimplified]:{},[g.ChineseWuSimplifiedYunzhe]:{}},j!==0&&(n.stations[h][O.Arrival]={[g.ChineseWuSimplifiedXiaotong]:{name:A.zh,namePinyin:A.zh},[g.ChineseMandarinSimplified]:{name:A.zh,namePinyin:A.zh},[g.ChineseWuSimplifiedYunzhe]:{name:A.en,namePinyin:A.en}}),j!==l.length-1||d){const F=d&&j===l.length-1?l[0]:l[j+1],{localisedName:U}=c[F];le(U);const I=c[F].transfer.groups.map(S=>{var R;return(R=S.lines)==null?void 0:R.map(W=>W.name)}).filter(S=>S!==void 0);if(n.stations[h][O.Departure]={[g.ChineseWuSimplifiedXiaotong]:{next:U.zh,nextPinyin:U.zh,int:I==null?void 0:I.map(S=>S==null?void 0:S.map(R=>R[0]))},[g.ChineseMandarinSimplified]:{next:U.zh,nextPinyin:U.zh,int:I==null?void 0:I.map(S=>S==null?void 0:S.map(R=>R[0]))},[g.ChineseWuSimplifiedYunzhe]:{next:U.en,nextPinyin:U.en,int:I==null?void 0:I.map(S=>S==null?void 0:S.map(R=>R[1])),noteLastTrain:!1}},b&&j+1<l.length&&((p=c[l[j+1]].branch)!=null&&p[u==="l"?on.left:on.right])){const{localisedName:S}=c[b];le(S),n.stations[h][O.Departure][g.ChineseWuSimplifiedXiaotong]={...n.stations[h][O.Departure][g.ChineseWuSimplifiedXiaotong],branchTerminalName:S.zh,branchTerminalNamePinyin:S.zh},n.stations[h][O.Departure][g.ChineseMandarinSimplified]={...n.stations[h][O.Departure][g.ChineseMandarinSimplified],branchTerminalName:S.zh,branchTerminalNamePinyin:S.zh},n.stations[h][O.Departure][g.ChineseWuSimplifiedYunzhe]={...n.stations[h][O.Departure][g.ChineseWuSimplifiedYunzhe],branchTerminalName:S.en,branchTerminalNamePinyin:S.en}}if(o!==ce.local){const R=l.slice(j+1,-1).map(W=>{const{localisedName:ee}=c[W];return le(ee),ee});n.stations[h][O.Departure][g.ChineseWuSimplifiedXiaotong]={...n.stations[h][O.Departure][g.ChineseWuSimplifiedXiaotong],stopovers:R.map(W=>W.zh)},n.stations[h][O.Departure][g.ChineseMandarinSimplified]={...n.stations[h][O.Departure][g.ChineseMandarinSimplified],stopovers:R.map(W=>W.zh)},n.stations[h][O.Departure][g.ChineseWuSimplifiedYunzhe]={...n.stations[h][O.Departure][g.ChineseWuSimplifiedYunzhe],stopovers:R.map(W=>W.en)}}}}if(d){const j=l[0],{localisedName:h}=c[j];le(h),n.stations[j][O.Arrival]={[g.ChineseWuSimplifiedXiaotong]:{name:h.zh,namePinyin:h.zh,doorDirection:t},[g.ChineseMandarinSimplified]:{name:h.zh,namePinyin:h.zh,doorDirection:t},[g.ChineseWuSimplifiedYunzhe]:{name:h.en,namePinyin:h.en,doorDirection:t}}}return n},_s=()=>{var f;const{t:s}=B(),i=G(),o=D.isAllowAnalytics(),{rmgParam:n,route:a,service:c}=E(r=>r.import),d=n?wn(n.stn_list).map(r=>[r.at(1),r.at(-2)]):[],u=n?d.map(r=>r.map(l=>Object.values(n.stn_list[l].localisedName).join(" "))):[],t=new Set(Object.values((f=n==null?void 0:n.stn_list)!=null?f:{}).map(r=>r.services).flat()),m=()=>{if(n){o&&D.event(ye.IMPORT_RMG_PARAM);try{const r=Gs(structuredClone(n),a,c);i(gn(r)),i(jn(Object.keys(r.metadata)[0])),i(fn(O.Departure))}catch(r){i(Y({status:"error",message:s("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",r)}finally{i(cn()),i(rn(0)),i(ln(ce.local))}}};return e.jsxs(J,{isOpen:n!==void 0,onClose:()=>i(cn()),size:"lg",children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:s("import.title")}),e.jsx(Q,{color:"white"}),e.jsxs(N,{py:3,children:[d.length===1&&t.size===1&&e.jsx(x,{children:s("import.goodToGo")}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(V,{fontSize:"md",mb:4,children:s("import.routes")}),e.jsx(en,{onChange:r=>i(rn(Number(r))),value:a.toString(),children:e.jsx(Ue,{spacing:4,align:"stretch",children:u.map((r,l)=>e.jsx(L,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:a===l?"blue.500":"gray.200",children:e.jsx(nn,{value:l.toString(),colorScheme:"blue",children:e.jsx($,{align:"start",spacing:1,ml:2,children:e.jsx(x,{fontSize:"sm",children:r.join(" <=> ")})})})},l))})})]}),t.size>1&&e.jsxs(e.Fragment,{children:[e.jsx(V,{fontSize:"md",mb:4,children:s("import.services")}),e.jsx(en,{onChange:r=>i(ln(r)),value:c,children:e.jsx(Ue,{spacing:4,align:"stretch",children:[...t].map(r=>e.jsx(L,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:c===r?"blue.500":"gray.200",children:e.jsx(nn,{value:r,colorScheme:"blue",children:e.jsx($,{align:"start",spacing:1,ml:2,children:e.jsx(x,{fontSize:"sm",children:s("import.service.".concat(r))})})})},r))})})]})]}),e.jsx(Te,{children:e.jsx(ue,{colorScheme:"teal",variant:"outline",onClick:m,children:s("import.import")})})]})]})},Fs="rmg-bridge--",Vs={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Ys(s){const{isOpen:i,onClose:o}=s,{t:n}=B(),a=G(),[c]=Be.useState(crypto.randomUUID()),d="/rmg/#/import?"+new URLSearchParams({parentComponent:D.getAppName(),parentId:c}),u=t=>{try{a(bn(t))}catch(m){a(Y({status:"error",message:n("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",m)}finally{o()}};return Be.useEffect(()=>{const t=new BroadcastChannel(Fs+c);return t.onmessage=m=>{const{event:f,data:r}=m.data;_.info("Received event from RMG app clip:",f),f==="CLOSE"?o():f==="IMPORT"&&u(r)},()=>t.close()},[]),e.jsx(xs,{isOpen:i,onClose:o,sx:Vs,children:e.jsx("iframe",{src:d,loading:"lazy"})})}function Xs(){const s=G(),{t:i}=B(),{preference:{import:{route:o,service:n}}}=E(r=>r.app),a=Ge(D.getEnv),c=C.useRef(null),d=C.useRef(null),[u,t]=C.useState(!1),m=async r=>{var w;const l=(w=r.target.files)==null?void 0:w[0];if(_.info("OpenActions.handleUpload():: received file",l),(l==null?void 0:l.type)!=="application/json")s(Y({status:"error",message:i("header.open.invalidType")})),_.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const z=await un(l),b=JSON.parse(z);if(!("baseVariants"in b)){s(Y({status:"error",message:i("header.open.invalidType")})),_.error("OpenActions.handleUpload():: Not a valid RMA project."),r.target.value="";return}s(gn(b)),s(jn(Object.keys(b.metadata)[0])),s(fn(O.Departure))}catch(z){s(Y({status:"error",message:i("header.open.unknownError")})),_.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",z)}r.target.value=""},f=async r=>{var w;const l=(w=r.target.files)==null?void 0:w[0];if(_.info("OpenActions.handleUpload():: received file",l),(l==null?void 0:l.type)!=="application/json")s(Y({status:"error",message:i("header.open.invalidType")})),_.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const z=await un(l);s(bn(JSON.parse(z)))}catch(z){s(Y({status:"error",message:i("header.open.unknownError")})),_.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",z)}r.target.value=""};return e.jsxs(Ve,{children:[e.jsx(Ye,{as:X,size:"sm",variant:"ghost",icon:e.jsx(Re,{})}),e.jsxs(Xe,{children:[e.jsx("input",{id:"upload_project",ref:c,type:"file",accept:".json",hidden:!0,onChange:m,"data-testid":"file-upload"}),e.jsx(te,{icon:e.jsx(Re,{}),onClick:()=>{var r;return(r=c==null?void 0:c.current)==null?void 0:r.click()},children:i("header.open.config")}),e.jsx("input",{id:"upload_RMG",ref:d,type:"file",accept:".json",hidden:!0,onChange:f,"data-testid":"file-upload"}),a===Ce.DEV&&e.jsx(te,{icon:e.jsx(Re,{}),onClick:()=>{var r;return(r=d==null?void 0:d.current)==null?void 0:r.click()},children:i("header.open.RMG")}),e.jsx(te,{icon:e.jsx(gs,{}),onClick:()=>t(!0),children:i("header.open.projectRMG")})]}),e.jsx(Ys,{isOpen:u,onClose:()=>t(!1)})]})}const un=s=>new Promise(i=>{const o=new FileReader;o.onloadend=()=>i(o.result),o.readAsText(s)}),$s=s=>{var M,k;const{isOpen:i,onClose:o}=s,{telemetry:{project:n},preference:{import:{route:a,service:c},previewAudio:d}}=E(p=>p.app),u=G(),{t}=B(),m=Fe("primary.500","primary.300"),{scale:f}=E(p=>p.crawl),r=xn(),[l,w]=C.useState({[g.ChineseMandarinSimplified]:[],[g.ChineseWuSimplifiedXiaotong]:[],[g.ChineseWuSimplifiedYunzhe]:[]});C.useEffect(()=>{w({[g.ChineseMandarinSimplified]:r.filter(p=>{var j,h;return p.lang===((h=(j=we[dn.ShanghaiMetro])==null?void 0:j.defaultLang)==null?void 0:h[g.ChineseMandarinSimplified])}).map(p=>p.name),[g.ChineseWuSimplifiedXiaotong]:[],[g.ChineseWuSimplifiedYunzhe]:r.filter(p=>{var j,h;return p.lang===((h=(j=we[dn.ShanghaiMetro])==null?void 0:j.defaultLang)==null?void 0:h[g.ChineseWuSimplifiedYunzhe])}).map(p=>p.name)})},[r]);const z=(p,j)=>{u(j==="undefined"?fs(p):bs([p,j]))},b=D.isAllowAnalytics(),y=p=>{u(ws(p))};return e.jsxs(J,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(K,{}),e.jsxs(q,{children:[e.jsx(Z,{children:t("header.settings.title")}),e.jsx(Q,{}),e.jsx(N,{children:e.jsxs($,{divider:e.jsx(Ln,{borderColor:"gray.200"}),children:[e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(V,{fontSize:"md",children:t("header.settings.crawl.title")}),e.jsx(L,{mt:"3",children:e.jsx(pn,{label:t("header.settings.crawl.scale"),children:e.jsx(mn,{defaultValue:f,value:f,min:.1,max:1,step:.1,onThrottledChange:p=>u(js(p))})})})]}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(V,{fontSize:"md",children:t("header.settings.previewAudio.title")}),e.jsxs(L,{mt:"3",children:[e.jsxs(L,{mb:"1",display:"flex",children:[e.jsx(x,{flex:"1",children:t("header.settings.previewAudio.shmetro-zh")}),e.jsxs(sn,{size:"xs",width:"300px",ml:"1",defaultValue:(M=d[g.ChineseMandarinSimplified])!=null?M:"undefined",onChange:({target:{value:p}})=>z(g.ChineseMandarinSimplified,p),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),l[g.ChineseMandarinSimplified].map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs(L,{mb:"1",display:"flex",children:[e.jsx(x,{flex:"1",children:t("header.settings.previewAudio.shmetro-en")}),e.jsxs(sn,{size:"xs",width:"300px",ml:"1",defaultValue:(k=d[g.ChineseWuSimplifiedYunzhe])!=null?k:"undefined",onChange:({target:{value:p}})=>z(g.ChineseWuSimplifiedYunzhe,p),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),l[g.ChineseWuSimplifiedYunzhe].map(p=>e.jsx("option",{value:p,children:p},p))]})]})]})]}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(V,{fontSize:"md",children:t("header.settings.telemetry.title")}),e.jsxs(L,{mt:"3",children:[e.jsx(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.info")}),e.jsxs(L,{mt:"3",mb:"1",children:[e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(x,{flex:"1",children:t("header.settings.telemetry.essential")}),e.jsx(Wn,{label:t("header.settings.telemetry.essentialTooltip"),children:e.jsx(Le,{isChecked:b,isDisabled:!0})})]}),e.jsx(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.essentialInfo")}),e.jsxs(T,{color:m,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[t("header.settings.telemetry.essentialLink")," ",e.jsx(H,{as:P})]})]}),e.jsxs(L,{mt:"1",mb:"1",children:[e.jsxs(L,{display:"flex",children:[e.jsx(x,{flex:"1",children:t("header.settings.telemetry.additional")}),e.jsx(Le,{isChecked:n,onChange:({target:{checked:p}})=>y(p)})]}),e.jsx(x,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})};function Js(){const{t:s}=B();G();const i=D.isAllowAnalytics(),[o,n]=C.useState(!1),[a,c]=C.useState(!1),d=Ge(D.getEnv),u=Ge(D.getAppVersion);C.useEffect(()=>{i&&d!==Ce.DEV&&D.event(ye.APP_LOAD,{isStandaloneWindow:D.isStandaloneWindow()})},[d]);const t=m=>{D.getI18nInstance().changeLanguage(m)};return e.jsxs(zs,{children:[e.jsx(V,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rma")}),e.jsx(ks,{environment:d,version:u,popoverHeader:d===Ce.PRD?void 0:e.jsxs(hn,{i18nKey:"header.popoverHeader",environment:d,children:["You're on ",{environment:d}," environment!"]}),popoverBody:d===Ce.PRD?void 0:e.jsx(hn,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(Un,{ml:"auto",children:[e.jsx(re,{children:e.jsx(Hs,{})}),e.jsx(re,{children:e.jsx(Xs,{})}),e.jsx(re,{children:e.jsx(Us,{})}),e.jsx(re,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(Ss,{}),onClick:()=>n(!0)})}),D.isStandaloneWindow()&&e.jsx(re,{children:e.jsxs(Ve,{children:[e.jsx(Ye,{as:X,icon:e.jsx(vs,{}),variant:"ghost",size:"sm"}),e.jsx(Xe,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(m=>e.jsx(te,{onClick:()=>t(m),children:As[m][m]},m))})]})}),e.jsx(re,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(Cs,{}),onClick:()=>c(!0)})})]}),e.jsx($s,{isOpen:o,onClose:()=>n(!1)}),e.jsx(Ps,{isOpen:a,onClose:()=>c(!1)}),e.jsx(_s,{})]})}function Ks(){const s=G(),i=E(n=>n.runtime.globalAlerts),o=n=>{D.isStandaloneWindow()?window.open("/".concat(n),"_blank"):D.openApp({appId:n})};return e.jsx(e.Fragment,{children:Object.entries(i).map(([n,{message:a,url:c,linkedApp:d}])=>e.jsxs(fe,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(be,{}),d?e.jsx(T,{onClick:()=>o(d),children:a}):c?e.jsx(T,{href:c,target:"_blank",children:a}):a,e.jsx(Bn,{ml:"auto",onClick:()=>s(Ts(n))})]},n))})}function et(){return e.jsxs(e.Fragment,{children:[e.jsx(Js,{}),e.jsx(Ks,{})]})}export{et as default};
