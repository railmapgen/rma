System.register(["./chakra-legacy-BBIC2CLD.js","./index-legacy-C6fgaWkG.js","./react-legacy-hZgLs8_m.js","./rmg-output-legacy-Tk5GZIlz.js"],(function(e,n){"use strict";var i,s,t,a,r,o,l,d,h,c,p,m,u,x,g,j,f,w,b,z,v,k,y,S,C,T,H,A,O,D,M,E,P,W,R,N,I,L,U,_,B,G,Y,V,F,X,$,J,K,q,Z,Q,ee,ne,ie,se,te,ae,re,oe,le,de,he,ce,pe,me,ue,xe,ge,je,fe,we,be,ze,ve,ke,ye,Se,Ce,Te,He,Ae,Oe,De,Me,Ee,Pe,We,Re,Ne,Ie,Le,Ue,_e,Be,Ge,Ye,Ve,Fe,Xe,$e,Je,Ke,qe,Ze,Qe,en,nn,sn,tn,an,rn,on,ln,dn,hn,cn,pn,mn,un;return{setters:[e=>{i=e.j,s=e.h,t=e.aq,a=e.a1,r=e.ak,o=e.M,l=e.al,d=e.G,h=e.H,c=e.J,p=e.ar,m=e.K,u=e.B,x=e.an,g=e.am,j=e.T,f=e.as,w=e.b,b=e.L,z=e.N,v=e.O,k=e.ad,y=e.ae,S=e.af,C=e.ag,T=e.ah,H=e.ai,A=e.aj,O=e.Q,D=e.ao,M=e.ap,E=e.at,P=e.au,W=e.av,R=e.aw,N=e.ax,I=e.ay,L=e.az,U=e.aA,_=e.aB,B=e.a0,G=e.aC,Y=e.aD,V=e.k,F=e.W,X=e.R,$=e.U,J=e.aE},e=>{K=e.u,q=e.r,Z=e.R,Q=e.a,ee=e.b,ne=e.c,ie=e.d,se=e.e,te=e.f,ae=e.g,re=e.v,oe=e.M,le=e.h,de=e.i,he=e.s,ce=e.p,pe=e.l,me=e.n,ue=e.j,xe=e.k,ge=e.m,je=e.A,fe=e.o,we=e.q,be=e.t,ze=e.w,ve=e.x,ke=e.E,ye=e.y,Se=e.z,Ce=e.B,Te=e.C,He=e.D,Ae=e.F,Oe=e.G,De=e.H,Me=e.I,Ee=e.J,Pe=e.K,We=e.S,Re=e.L,Ne=e.N,Ie=e.O,Le=e.V,Ue=e.P,_e=e.Q,Be=e.T,Ge=e.U,Ye=e.W,Ve=e.X,Fe=e.Y,Xe=e.Z,$e=e._,Je=e.$,Ke=e.a0,qe=e.a1,Ze=e.a2,Qe=e.a3,en=e.a4,nn=e.a5,sn=e.a6,tn=e.a7,an=e.a8,rn=e.a9,on=e.aa,ln=e.ab,dn=e.ac},e=>{hn=e.a,cn=e.m,pn=e.d,mn=e.T},e=>{un=e.R}],execute:function(){e("default",(function(){return i.jsxs(i.Fragment,{children:[i.jsx(Gn,{}),i.jsx(Yn,{})]})}));var n=function(e){return K(q.ready(),e)};function xn(e){var n=e.fields,a=e.noLabel,r=e.minW;return i.jsx(s,{wrap:"wrap",children:n.map((function(e,n){if(e.hidden)return i.jsx(hn.Fragment,{},n);var s=e.minW||r,o="full"===s;return i.jsx(Z,{className:o?"mw-full":"",label:e.label,flex:o?void 0:1,minW:o?void 0:s,noLabel:a,oneLine:e.oneLine,helper:e.helper,errorMessage:e.errorMessage,children:function(e){switch(e.type){case"input":return i.jsx(ie,{placeholder:e.placeholder,defaultValue:e.value,type:e.variant,validator:e.validator,onDebouncedChange:e.onChange,delay:e.debouncedDelay,optionList:e.optionList,isDisabled:e.isDisabled});case"output":return i.jsx(un,{noWrap:e.noWrap,children:e.value});case"textarea":return i.jsx(ne,{placeholder:e.placeholder,defaultValue:e.value,onDebouncedChange:e.onChange,isDisabled:e.isDisabled});case"slider":return i.jsx(ee,{defaultValue:e.value,min:e.min,max:e.max,step:e.step,onThrottledChange:e.onChange,leftIcon:e.leftIcon,rightIcon:e.rightIcon,isDisabled:e.isDisabled});case"select":return i.jsx(Q,{defaultValue:e.value,onChange:function(n){var i,s=n.target.value;return null===(i=e.onChange)||void 0===i?void 0:i.call(e,"number"==typeof e.value?Number(s):s.toString())},options:e.options,disabledOptions:e.disabledOptions,isInvalid:e.isInvalid,isDisabled:e.isDisabled});case"switch":return i.jsx(t,{isChecked:e.isChecked,isDisabled:e.isDisabled,onChange:function(n){var i,s=n.target.checked;return null===(i=e.onChange)||void 0===i?void 0:i.call(e,s)}});case"custom":return e.component;default:return i.jsx("div",{})}}(e)},n)}))})}var gn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const jn=(()=>{const e=navigator.platform.toLowerCase();return e.includes("win")?"win":e.includes("android")?"android":e.includes("mac")?"mac":e.includes("iphone")||e.includes("ipad")?"ios":e.includes("linux")?"linux":"unknown"})();function fn(){const{reconciledPhrases:e,currentStyle:n,currentStationID:s,currentStage:t,currentVoice:r}=se((e=>e.runtime)),{preference:{previewAudio:o}}=se((e=>e.app)),l=te(),{t:d}=cn(),[h,c]=pn.useState(!1),[p,m]=pn.useState(!1),u=ae();return pn.useEffect((()=>{const e=re[n]?.defaultLang?.[r],i=u.find((n=>n.lang===e));m(!!i)}),[r,u]),i.jsx(a,{size:"sm",variant:"ghost","aria-label":"Settings",icon:p?h?i.jsx(oe,{}):i.jsx(le,{}):i.jsx(de,{}),isDisabled:!p,onClick:h?()=>{window.speechSynthesis.pause(),c(!1)}:()=>{l(he({status:"info",message:d("header.paly.previewWarning")}));const i=window.speechSynthesis;if(i.paused&&i.speaking)return c(!0),void i.resume();const a=e[s]?.[t]?.[r],h=ce(a??[]),p=""===h?" ":h,m=new SpeechSynthesisUtterance(p),u=o[r]??re[n]?.preferredPreviewVoiceName?.[r]?.[jn],x=i.getVoices().find((e=>e.name===u)),g=re[n]?.defaultLang?.[r];if(x)m.voice=x;else{if(!g)return void pe.error("Preview language not found for",r);m.lang=g}m.onend=()=>{c(!1)},c(!0),pe.debug(`Previewing audio "${p}" with ${m.voice?.name}`),i.speak(m)}})}const wn=e=>{const{isOpen:n,onClose:t}=e,{t:a}=cn(),b=q.getAppVersion();return i.jsxs(r,{isOpen:n,onClose:t,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:a("header.about.title")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsxs(s,{direction:"row",children:[i.jsx(p,{boxSize:"128px",src:"/rma//logo192.png"}),i.jsxs(s,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[i.jsx(m,{fontSize:"xl",as:"b",children:a("header.about.rma")}),i.jsx(m,{children:b}),i.jsx(m,{}),i.jsx(m,{fontSize:"sm",children:a("header.about.railmapgen")})]})]}),i.jsx(u,{margin:5,children:i.jsx(m,{fontSize:"xl",children:a("header.about.desc")})}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:a("header.about.contributors")}),i.jsx(g,{children:i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),i.jsx(m,{fontSize:"sm",children:a("header.about.content1")}),i.jsx(m,{fontSize:"sm",align:"right",mb:1,children:a("header.about.content2")})]})]})}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:a("header.about.contactUs")}),i.jsxs(g,{children:[i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.about.github")}),i.jsx(m,{fontSize:"sm",children:a("header.about.githubContent")})]})]}),i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.about.slack")}),i.jsx(m,{fontSize:"sm",children:a("header.about.slackContent")}),i.jsx(m,{fontSize:"sm",as:"i",children:"#rma, #rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:a("header.donation.title")}),i.jsxs(g,{children:[i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",pb:1,children:[i.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.donation.afdian")}),i.jsx(m,{fontSize:"sm",children:a("header.donation.viaCNY")})]})]}),i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",pb:1,children:[i.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.donation.openCollective")}),i.jsx(m,{fontSize:"sm",children:a("header.donation.viaUSD")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */function bn(e){const n=e.sizes.shift(),i=Math.max(Math.ceil(n[0]),1),s=Math.max(Math.ceil(n[1]),1),t=[i-1,s-1,1,1],a=performance.now(),r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let o,l;r?(o=new OffscreenCanvas(1,1),l=new OffscreenCanvas(i,s)):(o=document.createElement("canvas"),o.width=1,o.height=1,l=document.createElement("canvas"),l.width=i,l.height=s);const d=o.getContext("2d"),h=l.getContext("2d");h&&(h.fillRect.apply(h,t),d.drawImage(l,i-1,s-1,1,1,0,0,1,1));const c=d&&0!==d.getImageData(0,0,1,1).data[3],p=parseInt(performance.now()-a);return[o,l].forEach((e=>{e.height=0,e.width=0})),r?(postMessage({width:i,height:s,testTime:p,isTestPass:c}),!c&&e.sizes.length&&setTimeout((()=>{bn(e)}),0)):c?e.onSuccess({width:i,height:s,testTime:p}):(e.onError({width:i,height:s,testTime:p}),e.sizes.length&&setTimeout((()=>{bn(e)}),0)),c}const zn={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},vn={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},kn={};function yn(e){const n=e.width===e.height,i=1===e.height,s=1===e.width,t=[];if(e.width&&e.height){const a=e.min||vn.min,r=e.step||vn.step;let o=Math.max(e.width,e.height);for(;o>=a;){const e=n||i?o:1,a=n||s?o:1;t.push([e,a]),o-=r}}else e.sizes.forEach((e=>{const a=n||i?e:1,r=n||s?e:1;t.push([a,r])}));return t}function Sn(e){const n="undefined"!=typeof window,i=n&&"Promise"in window,s=n&&"HTMLCanvasElement"in window,t=n&&"OffscreenCanvas"in window,a=URL.createObjectURL(new Blob([])).slice(-36),r=performance.now(),{onError:o,onSuccess:l,...d}=e,h=()=>parseInt(performance.now()-r);let c=null;if(!s)return!1;if(e.useWorker&&t){const e=`\n            var canvasTest = ${bn.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,n=new Blob([e],{type:"application/javascript"}),i=URL.createObjectURL(n);c=new Worker(i),URL.revokeObjectURL(i),c.onmessage=function(e){const{width:n,height:i,testTime:s,isTestPass:t}=e.data,r={width:n,height:i,testTime:s,totalTime:h()};t?(kn[a].onSuccess(r),delete kn[a]):kn[a].onError(r)}}return i?new Promise((n=>{const i={...e,onError(i){let{width:s,height:t,testTime:a}=i;const r={width:s,height:t,testTime:a,totalTime:h()};let l;if(0===e.sizes.length)l=!0;else{const[[n,i]]=e.sizes.slice(-1);l=s===n&&t===i}o(r),l&&n({...r,success:!1})},onSuccess(e){let{width:i,height:s,testTime:t}=e;const a={width:i,height:s,testTime:t,totalTime:h()};l(a),n({...a,success:!0})}};if(c){const{onError:e,onSuccess:n}=i;kn[a]={onError:e,onSuccess:n},c.postMessage(d)}else bn(i)})):c?(kn[a]={onError:o,onSuccess:l},void c.postMessage(d)):bn(e)}const Cn={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=yn({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...zn.area]});return Sn({...vn,...e,sizes:n})},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=yn({width:1,height:e.max,min:e.min,step:e.step,sizes:[...zn.height]});return Sn({...vn,...e,sizes:n})},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=yn({width:e.max,height:1,min:e.min,step:e.step,sizes:[...zn.width]});return Sn({...vn,...e,sizes:n})},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n={...vn,...e};return n.sizes=[...n.sizes],n.width&&n.height&&(n.sizes=[[n.width,n.height]]),Sn(n)}},Tn=(e,n,i)=>{const s=new Blob([i],{type:n});Hn(e,s)},Hn=(e,n)=>{const i=window.URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(i)},An=e=>{const{isOpen:n,onClose:s}=e,{t:t}=cn(),a=te(),{reconciledPhrases:p}=se((e=>e.runtime)),{points:u}=se((e=>e.audio)),x=100*Object.keys(p).length;return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:t("header.audioTask.new.title")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsx(m,{children:t("header.audioTask.new.content1")}),i.jsxs(m,{children:[t("header.audioTask.new.content2"),x]}),i.jsx(m,{children:t("header.audioTask.new.content3")}),i.jsx(m,{children:t("header.audioTask.new.content4")})]}),i.jsx(b,{children:i.jsx(z,{style:{alignSelf:"center"},onClick:()=>a(me()),isDisabled:u<x,children:t("header.audioTask.new.create")})})]})]})},On=e=>{const{isOpen:n,onClose:t}=e,{t:p}=cn(),u=te(),{telemetry:{project:x}}=se((e=>e.app)),{tasks:j,points:f}=se((e=>e.audio)),{rmtToken:w,reconciledPhrases:b}=se((e=>e.runtime)),{project:z}=se((e=>e.param)),{style:D,metadata:M}=z,E=q.isAllowAnalytics(),P=v("primary.500","primary.300"),[W,R]=pn.useState(!1);return pn.useEffect((()=>{n&&u(ue())}),[n]),i.jsxs(r,{isOpen:n,onClose:t,size:"4xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:p("header.download.audio")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsx(m,{fontSize:"lg",mb:"4",children:p("header.audioTask.desc")}),i.jsx(m,{fontSize:"md",mt:"4",color:"gray.600",children:p("header.audioTask.exampleZH")}),i.jsxs("audio",{controls:!0,children:[i.jsx("source",{src:"audio/shmetro-zh.mp3",type:"audio/mpeg"}),p("header.audioTask.audioNotSupported")]}),i.jsx(m,{fontSize:"md",mt:"4",color:"gray.600",children:p("header.audioTask.exampleEN")}),i.jsxs("audio",{controls:!0,children:[i.jsx("source",{src:"audio/shmetro-en.mp3",type:"audio/mpeg"}),p("header.audioTask.audioNotSupported")]}),w?i.jsxs(i.Fragment,{children:[i.jsxs(s,{pl:"4",pr:"4",mt:"10",mb:"4",children:[i.jsx(m,{as:"b",fontSize:"4xl",children:f}),i.jsx(m,{style:{alignSelf:"self-end",marginLeft:"10px"},children:"pts"}),i.jsx(s,{style:{flex:1}}),i.jsx(m,{as:"b",style:{alignSelf:"self-end"},children:p("header.audioTask.title")}),i.jsx(s,{style:{flex:1}}),i.jsx(a,{icon:i.jsx(xe,{}),variant:"ghost",style:{alignSelf:"center"},"aria-label":p("header.audioTask.topUp"),isDisabled:!0}),i.jsx(a,{icon:i.jsx(ge,{}),variant:"ghost",style:{alignSelf:"center"},"aria-label":p("header.audioTask.new.title"),onClick:()=>R(!0)}),i.jsx(An,{isOpen:W,onClose:()=>R(!1)})]}),i.jsx(k,{height:"100%",overflowY:"auto",children:i.jsxs(y,{variant:"simple",height:"100%",children:[i.jsx(S,{children:i.jsxs(C,{children:[i.jsx(T,{children:p("header.audioTask.table.id")}),i.jsx(T,{children:p("header.audioTask.table.status")}),i.jsx(T,{children:p("header.audioTask.table.createdAt")}),i.jsx(T,{children:p("header.audioTask.table.updatedAt")}),i.jsx(T,{children:p("header.audioTask.table.points")}),i.jsx(T,{children:p("header.audioTask.table.actions")})]})}),i.jsx(H,{children:j.map((({id:e,status:n,createdAt:s,updatedAt:t,points:r})=>i.jsxs(C,{children:[i.jsx(A,{children:e}),i.jsx(A,{children:n}),i.jsx(A,{children:new Date(s).toLocaleString()}),i.jsx(A,{children:new Date(t).toLocaleString()}),i.jsx(A,{children:r}),i.jsxs(A,{children:[n===je.CREATED&&i.jsx(a,{icon:i.jsx(we,{}),"aria-label":p("Cancel Task"),onClick:()=>u(fe(e))}),n===je.COMPLETED&&i.jsx(a,{icon:i.jsx(be,{}),"aria-label":p("Download Audio"),onClick:()=>(async e=>{const n=await ze(`${ve.AUDIOTASKS}/${e}/download`,{},w);if(!n||!n.ok)throw new Error("Download error");Hn(`${e}.zip`,await n.blob())})(e)})]})]},e)))})]})})]}):i.jsx(m,{mt:"10",textAlign:"center",children:p("header.audioTask.loginFirst")}),i.jsx(g,{mt:10,children:i.jsxs(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[p("header.audioTask.freeInternet1"),i.jsx(O,{color:P,fontSize:"sm",lineHeight:"100%",onClick:()=>{E&&q.event(ke.DOWNLOAD_TEXT,x?{style:D,"#stations":Object.keys(M).length}:{});const e=ye(b);Tn(`RMA_${(new Date).valueOf()}.txt`,"text/plain",e.join("\n"))},children:p("header.audioTask.freeInternet2")}),p("header.audioTask.freeInternet3")]})})]})]})]})},Dn=e=>{const{isOpen:n,onClose:s}=e,{t:t}=cn();return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:t("header.download.termsAndConditions")}),i.jsx(h,{}),i.jsx(c,{children:i.jsxs(D,{children:[i.jsxs(M,{children:["The layout of the elements on the signage or rail map, is designed by"," ",i.jsxs(O,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",i.jsx(E,{as:Se})]}),", ",i.jsxs(O,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",i.jsx(E,{as:Se})]})," or ",i.jsxs(O,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",i.jsx(E,{as:Se})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",i.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",i.jsxs(O,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",i.jsx(E,{as:Se})]}),"，",i.jsxs(O,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",i.jsx(E,{as:Se})]}),"或",i.jsxs(O,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",i.jsx(E,{as:Se})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),i.jsxs(M,{children:["The elements including shapes and lines on the image are drawn by"," ",i.jsxs(O,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",i.jsx(E,{as:Se})]})," and ",i.jsxs(O,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",i.jsx(E,{as:Se})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",i.jsx("br",{}),"图像的元素，包括图形及线条，均由",i.jsxs(O,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",i.jsx(E,{as:Se})]}),"及",i.jsxs(O,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",i.jsx(E,{as:Se})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),i.jsxs(M,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",i.jsxs(O,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",i.jsx(E,{as:Se})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",i.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",i.jsxs(O,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",i.jsx(E,{as:Se})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),i.jsxs(M,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",i.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),i.jsxs(M,{children:["All flag emojis shown on Windows platforms are designed by"," ",i.jsxs(O,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",i.jsx(E,{as:Se})]})," ","– the open-source emoji and icon project. License:",i.jsxs(O,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",i.jsx(E,{as:Se})]}),i.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",i.jsxs(O,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",i.jsx(E,{as:Se})]}),"所设计。许可证：",i.jsxs(O,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",i.jsx(E,{as:Se})]})]}),i.jsxs(M,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",i.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Mn(){const{telemetry:{project:e}}=se((e=>e.app)),n=te(),{realColumns:s}=se((e=>e.crawl)),{project:t}=se((e=>e.param)),{reconciledPhrases:p,currentStationID:u,currentStage:x,currentVoice:g}=se((e=>e.runtime)),{isModalOpen:j}=se((e=>e.audio)),{style:f,metadata:w}=t,v=q.isAllowAnalytics(),{t:k}=cn(),[y,S]=pn.useState("png"),C={png:k("header.download.png"),svg:k("header.download.svg")},[T,H]=pn.useState({width:1,height:1,benchmark:.001}),[A,D]=pn.useState(200),M=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],U=Object.fromEntries(M.map((e=>[e,`${e}%`]))),[_,B]=pn.useState([]),G=[{type:"select",label:k("header.download.format"),value:y,options:C,onChange:e=>S("png"===e?"png":"svg")}],Y=[{type:"select",label:k("header.download.scale"),value:A,options:U,disabledOptions:_,onChange:e=>D(e)}],[V,F]=pn.useState(!1),[X,$]=pn.useState(!1),[J,K]=pn.useState(!1),[Z,Q]=pn.useState(!1);return pn.useEffect((()=>{(async()=>{const e=await Cn.maxArea({usePromise:!0,useWorker:!0});H(e)})()}),[]),pn.useEffect((()=>{if(V){const[e,n]=[s*Me*A/100,Ee*Me*A/100],i=M.filter((i=>e*i/100>T.width||n*i/100>T.height));B(i)}}),[V]),i.jsxs(P,{id:"download",children:[i.jsx(W,{as:a,size:"sm",variant:"ghost",icon:i.jsx(Ce,{})}),i.jsxs(R,{children:[i.jsx(N,{icon:i.jsx(Te,{}),onClick:()=>{v&&q.event(ke.DOWNLOAD_PARAM,e?{style:f,"#stations":Object.keys(w).length}:{}),Tn(`RMA_${(new Date).valueOf()}.json`,"application/json",JSON.stringify(t,null,2))},children:k("header.download.config")}),i.jsx(N,{icon:i.jsx(He,{}),onClick:()=>F(!0),children:k("header.download.image")}),i.jsx(N,{icon:i.jsx(Oe,{}),onClick:()=>n(Ae()),children:k("header.download.audio")})]}),i.jsxs(r,{size:"xl",isOpen:V,onClose:()=>F(!1),children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:k("header.download.image")}),i.jsx(h,{}),i.jsxs(c,{children:[i.jsx(xn,{fields:G}),"svg"===y&&i.jsx(xn,{fields:[]}),"png"===y&&i.jsx(xn,{fields:Y}),"png"===y&&_.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(m,{as:"i",fontSize:"sm",children:k("header.download.disabledScaleOptions")}),i.jsx("br",{}),i.jsx(m,{as:"i",fontSize:"sm",children:k("header.download.disabledScaleOptionsWorkarounds")}),i.jsxs(O,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",i.jsx(E,{as:Se})]}),i.jsx("br",{})]}),i.jsx("br",{}),i.jsx(I,{isChecked:Z,onChange:e=>Q(e.target.checked),children:i.jsxs(m,{children:[k("header.download.termsAndConditionsInfo"),i.jsxs(O,{color:"teal.500",onClick:()=>$(!0),children:[k("header.download.termsAndConditions")," ",i.jsx(E,{as:Se})]}),k("header.download.period")]})})]}),i.jsx(b,{children:i.jsx(L,{children:i.jsx(z,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Z||"png"===y&&_.includes(A),onClick:()=>{const e=p[u]?.[x]?.[g],n=Pe(e??[]),i=""===n?" ":n,t=document.getElementById("crawl").cloneNode(!0),a=t.outerHTML;if("svg"===y)return void Tn(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",a);document.body.appendChild(t);const r="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a)));document.body.removeChild(t),t.remove();const o=document.createElement("canvas"),[l,d]=[s*Me*A/100,Ee*Me*A/100];o.width=l,o.height=d;const h=o.getContext("2d");h.fillStyle="black",h.fillRect(0,0,l,d);const c=new Image;c.onload=()=>{setTimeout((()=>{h.drawImage(c,0,0,l,d),o.toBlob((e=>{Hn(`RMA_${i}.png`,e)}),"image/png")}),0)},c.src=r},children:k("header.download.confirm")})})}),i.jsx(Dn,{isOpen:X,onClose:()=>$(!1)})]})]}),i.jsx(On,{isOpen:j,onClose:()=>n(De())})]})}const En=e=>{const n=["linestart"],i=[["linestart"]];let s=0;for(;n.length;){let t=n.shift(),a=i[s].slice(-1)[0]||null;for(a&&"linestart"!==t?i[s].push(t):i[s]=[t];"lineend"!==t;){a=t;const r=e[a].children;switch(r.length){case 1:t=r[0];break;case 2:{const o=e[a].branch.right,l=o[1];"through"===o[0]?(i.push(i[s].slice()),n.push(l)):0===s&&(i.push([a]),n.push(l)),t=r.filter((e=>e!==l))[0];break}}if(i[s].push(t),a===e[t].branch?.left?.[1]&&"nonthrough"===e[t].branch?.left?.[0])break}s++}return i},Pn=e=>{for(const n in e)e[n]=e[n].replaceAll("\\"," ").replaceAll("\n"," ");return e},Wn=(e,n,i=We.local)=>{const s=structuredClone(Re),{line_name:t,stn_list:a,loop:r,direction:o}=e,l="left",d=En(a).map((e=>e.slice(1,-1)));o===Ne.left&&d.forEach((e=>e.reverse()));let h=d.at(n)??d.at(-1);i!==We.local&&(h=h.filter((e=>a[e].services.includes(i))));const c=h,p=new Set(c.map((e=>a[e].services)).flat()),m=c.at(-1),u=d.map((e=>e[e.length-1])).find((e=>e!==m)),{localisedName:x}=a[m];Pn(x),s.baseVariants=((e,n,i="left",s="left",t,a=!0,r=!1,o="none",l=!1,d=We.local)=>({[Ie.Arrival]:{[Le.ChineseWuSimplifiedXiaotong]:{terminal:e.zh,terminalPinyin:e.zh,doorDirection:i,thanksForTaking:t?.at(0),thanksForTakingPinyin:t?.at(0)},[Le.ChineseMandarinSimplified]:{terminal:e.zh,terminalPinyin:e.zh,doorDirection:i,thanksForTaking:t?.at(0),thanksForTakingPinyin:t?.at(0)},[Le.ChineseWuSimplifiedYunzhe]:{terminal:e.en,terminalPinyin:e.en,doorDirection:i,thanksForTaking:t?.at(1),thanksForTakingPinyin:t?.at(1)}},[Ie.Departure]:{[Le.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:t?.at(0),welcomeAbroadPinyin:t?.at(0),terminal:e.zh,terminalPinyin:e.zh,nextDoorDirection:s,lineName:n[0],lineNamePinyin:n[0],noteLastTrain:a,loop:o,loopTerminal:l,service:d},[Le.ChineseMandarinSimplified]:{welcomeAbroad:t?.at(0),welcomeAbroadPinyin:t?.at(0),terminal:e.zh,terminalPinyin:e.zh,nextDoorDirection:s,lineName:n[0],lineNamePinyin:n[0],noteLastTrain:a,loop:o,loopTerminal:l,service:d},[Le.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:t?.at(1),welcomeAbroadPinyin:t?.at(0),terminal:e.en,terminalPinyin:e.en,nextDoorDirection:s,lineName:n[1],lineNamePinyin:n[1],service:d}},[Ie.Midway]:{[Le.ChineseWuSimplifiedXiaotong]:{caution:r},[Le.ChineseMandarinSimplified]:{caution:r},[Le.ChineseWuSimplifiedYunzhe]:{}}}))(x,t,l,"left",void 0,void 0,void 0,r?"inner":"none",!1,p.has(i)?i:We.local);for(const[g,j]of c.entries()){const{localisedName:e}=a[j];if(Pn(e),s.metadata[j]={name:Object.values(e).at(0)??""},s.stations[j]={},s.stations[j][Ie.Midway]={[Le.ChineseWuSimplifiedXiaotong]:{},[Le.ChineseMandarinSimplified]:{},[Le.ChineseWuSimplifiedYunzhe]:{}},0!==g&&(s.stations[j][Ie.Arrival]={[Le.ChineseWuSimplifiedXiaotong]:{name:e.zh,namePinyin:e.zh},[Le.ChineseMandarinSimplified]:{name:e.zh,namePinyin:e.zh},[Le.ChineseWuSimplifiedYunzhe]:{name:e.en,namePinyin:e.en}}),g!==c.length-1||r){const e=r&&g===c.length-1?c[0]:c[g+1],{localisedName:n}=a[e];Pn(n);const t=a[e].transfer.groups.map((e=>e.lines?.map((e=>e.name)))).filter((e=>void 0!==e));if(s.stations[j][Ie.Departure]={[Le.ChineseWuSimplifiedXiaotong]:{next:n.zh,nextPinyin:n.zh,int:t?.map((e=>e?.map((e=>e[0]))))},[Le.ChineseMandarinSimplified]:{next:n.zh,nextPinyin:n.zh,int:t?.map((e=>e?.map((e=>e[0]))))},[Le.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:!1,next:n.en,nextPinyin:n.en,int:t?.map((e=>e?.map((e=>e[1])))),noteLastTrain:!1}},u&&g+1<c.length&&a[c[g+1]].branch?.["l"===o?Ue.left:Ue.right]){const{localisedName:e}=a[u];Pn(e),s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedXiaotong]={...s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedXiaotong],branchTerminalName:e.zh,branchTerminalNamePinyin:e.zh},s.stations[j][Ie.Departure][Le.ChineseMandarinSimplified]={...s.stations[j][Ie.Departure][Le.ChineseMandarinSimplified],branchTerminalName:e.zh,branchTerminalNamePinyin:e.zh},s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedYunzhe]={...s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedYunzhe],branchTerminalName:e.en,branchTerminalNamePinyin:e.en}}if(i!==We.local){const e=c.slice(g+1,-1).map((e=>{const{localisedName:n}=a[e];return Pn(n),n}));s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedXiaotong]={...s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedXiaotong],stopovers:e.map((e=>e.zh))},s.stations[j][Ie.Departure][Le.ChineseMandarinSimplified]={...s.stations[j][Ie.Departure][Le.ChineseMandarinSimplified],stopovers:e.map((e=>e.zh))},s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedYunzhe]={...s.stations[j][Ie.Departure][Le.ChineseWuSimplifiedYunzhe],stopovers:e.map((e=>e.en))}}}}if(r){const e=c[0],{localisedName:n}=a[e];Pn(n),s.stations[e][Ie.Arrival]={[Le.ChineseWuSimplifiedXiaotong]:{name:n.zh,namePinyin:n.zh,doorDirection:l},[Le.ChineseMandarinSimplified]:{name:n.zh,namePinyin:n.zh,doorDirection:l},[Le.ChineseWuSimplifiedYunzhe]:{name:n.en,namePinyin:n.en,doorDirection:l}}}return s},Rn=()=>{const{t:e}=cn(),n=te(),s=q.isAllowAnalytics(),{rmgParam:t,route:a,service:p}=se((e=>e.import)),j=t?En(t.stn_list).map((e=>[e.at(1),e.at(-2)])):[],f=t?j.map((e=>e.map((e=>Object.values(t.stn_list[e].localisedName).join(" "))))):[],w=new Set(Object.values(t?.stn_list??{}).map((e=>e.services)).flat());return i.jsxs(r,{isOpen:void 0!==t,onClose:()=>n(Ge()),size:"lg",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:e("import.title")}),i.jsx(h,{color:"white"}),i.jsxs(c,{py:3,children:[1===j.length&&1===w.size&&i.jsx(m,{children:e("import.goodToGo")}),j.length>1&&i.jsxs(i.Fragment,{children:[i.jsx(x,{fontSize:"md",mb:4,children:e("import.routes")}),i.jsx(U,{onChange:e=>n(_e(Number(e))),value:a.toString(),children:i.jsx(L,{spacing:4,align:"stretch",children:f.map(((e,n)=>i.jsx(u,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:a===n?"blue.500":"gray.200",children:i.jsx(_,{value:n.toString(),colorScheme:"blue",children:i.jsx(g,{align:"start",spacing:1,ml:2,children:i.jsx(m,{fontSize:"sm",children:e.join(" <=> ")})})})},n)))})})]}),w.size>1&&i.jsxs(i.Fragment,{children:[i.jsx(x,{fontSize:"md",mb:4,children:e("import.services")}),i.jsx(U,{onChange:e=>n(Be(e)),value:p,children:i.jsx(L,{spacing:4,align:"stretch",children:[...w].map((n=>i.jsx(u,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:p===n?"blue.500":"gray.200",children:i.jsx(_,{value:n,colorScheme:"blue",children:i.jsx(g,{align:"start",spacing:1,ml:2,children:i.jsx(m,{fontSize:"sm",children:e(`import.service.${n}`)})})})},n)))})})]})]}),i.jsx(b,{children:i.jsx(z,{colorScheme:"teal",variant:"outline",onClick:()=>{if(t){s&&q.event(ke.IMPORT_RMG_PARAM);try{const e=Wn(structuredClone(t),a,p);n(Ye(e)),n(Ve(Object.keys(e.metadata)[0])),n(Fe(Ie.Departure))}catch(i){n(he({status:"error",message:e("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",i)}finally{n(Ge()),n(_e(0)),n(Be(We.local))}}},children:e("import.import")})})]})]})},Nn="rmg-bridge--",In={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Ln(e){const{isOpen:n,onClose:s}=e,{t:t}=cn(),a=te(),[r]=hn.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:q.getAppName(),parentId:r});return hn.useEffect((()=>{const e=new BroadcastChannel(Nn+r);return e.onmessage=e=>{const{event:n,data:i}=e.data;pe.info("Received event from RMG app clip:",n),"CLOSE"===n?s():"IMPORT"===n&&(e=>{try{a($e(e))}catch(n){a(he({status:"error",message:t("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",n)}finally{s()}})(i)},()=>e.close()}),[]),i.jsx(Xe,{isOpen:n,onClose:s,sx:In,children:i.jsx("iframe",{src:o,loading:"lazy"})})}function Un(){const e=te(),{t:s}=cn(),{preference:{import:{route:t,service:r}}}=se((e=>e.app)),o=n(q.getEnv),l=pn.useRef(null),d=pn.useRef(null),[h,c]=pn.useState(!1);return i.jsxs(P,{children:[i.jsx(W,{as:a,size:"sm",variant:"ghost",icon:i.jsx(Je,{})}),i.jsxs(R,{children:[i.jsx("input",{id:"upload_project",ref:l,type:"file",accept:".json",hidden:!0,onChange:async n=>{const i=n.target.files?.[0];if(pe.info("OpenActions.handleUpload():: received file",i),"application/json"!==i?.type)e(he({status:"error",message:s("header.open.invalidType")})),pe.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const t=await _n(i),a=JSON.parse(t);if(!("baseVariants"in a))return e(he({status:"error",message:s("header.open.invalidType")})),pe.error("OpenActions.handleUpload():: Not a valid RMA project."),void(n.target.value="");e(Ye(a)),e(Ve(Object.keys(a.metadata)[0])),e(Fe(Ie.Departure))}catch(t){e(he({status:"error",message:s("header.open.unknownError")})),pe.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",t)}n.target.value=""},"data-testid":"file-upload"}),i.jsx(N,{icon:i.jsx(Je,{}),onClick:()=>l?.current?.click(),children:s("header.open.config")}),i.jsx("input",{id:"upload_RMG",ref:d,type:"file",accept:".json",hidden:!0,onChange:async n=>{const i=n.target.files?.[0];if(pe.info("OpenActions.handleUpload():: received file",i),"application/json"!==i?.type)e(he({status:"error",message:s("header.open.invalidType")})),pe.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const n=await _n(i);e($e(JSON.parse(n)))}catch(t){e(he({status:"error",message:s("header.open.unknownError")})),pe.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",t)}n.target.value=""},"data-testid":"file-upload"}),o===Ke.DEV&&i.jsx(N,{icon:i.jsx(Je,{}),onClick:()=>d?.current?.click(),children:s("header.open.RMG")}),i.jsx(N,{icon:i.jsx(qe,{}),onClick:()=>c(!0),children:s("header.open.projectRMG")})]}),i.jsx(Ln,{isOpen:h,onClose:()=>c(!1)})]})}const _n=e=>new Promise((n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.readAsText(e)})),Bn=e=>{const{isOpen:n,onClose:s}=e,{telemetry:{project:a},preference:{import:{route:p,service:j},previewAudio:f}}=se((e=>e.app)),w=te(),{t:b}=cn(),z=v("primary.500","primary.300"),{scale:k}=se((e=>e.crawl)),y=ae(),[S,C]=pn.useState({[Le.ChineseMandarinSimplified]:[],[Le.ChineseWuSimplifiedXiaotong]:[],[Le.ChineseWuSimplifiedYunzhe]:[]});pn.useEffect((()=>{C({[Le.ChineseMandarinSimplified]:y.filter((e=>e.lang===re[Ze.ShanghaiMetro]?.defaultLang?.[Le.ChineseMandarinSimplified])).map((e=>e.name)),[Le.ChineseWuSimplifiedXiaotong]:[],[Le.ChineseWuSimplifiedYunzhe]:y.filter((e=>e.lang===re[Ze.ShanghaiMetro]?.defaultLang?.[Le.ChineseWuSimplifiedYunzhe])).map((e=>e.name))})}),[y]);const T=(e,n)=>{w("undefined"===n?en(e):nn([e,n]))},H=q.isAllowAnalytics();return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:b("header.settings.title")}),i.jsx(h,{}),i.jsx(c,{children:i.jsxs(g,{divider:i.jsx(Y,{borderColor:"gray.200"}),children:[i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:b("header.settings.crawl.title")}),i.jsx(u,{mt:"3",children:i.jsx(Z,{label:b("header.settings.crawl.scale"),children:i.jsx(ee,{defaultValue:k,value:k,min:.1,max:1,step:.1,onThrottledChange:e=>w(Qe(e))})})})]}),i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:b("header.settings.previewAudio.title")}),i.jsxs(u,{mt:"3",children:[i.jsxs(u,{mb:"1",display:"flex",children:[i.jsx(m,{flex:"1",children:b("header.settings.previewAudio.shmetro-zh")}),i.jsxs(B,{size:"xs",width:"300px",ml:"1",defaultValue:f[Le.ChineseMandarinSimplified]??"undefined",onChange:({target:{value:e}})=>T(Le.ChineseMandarinSimplified,e),children:[i.jsx("option",{value:"undefined",children:b("header.settings.previewAudio.notModified")}),S[Le.ChineseMandarinSimplified].map((e=>i.jsx("option",{value:e,children:e},e)))]})]}),i.jsxs(u,{mb:"1",display:"flex",children:[i.jsx(m,{flex:"1",children:b("header.settings.previewAudio.shmetro-en")}),i.jsxs(B,{size:"xs",width:"300px",ml:"1",defaultValue:f[Le.ChineseWuSimplifiedYunzhe]??"undefined",onChange:({target:{value:e}})=>T(Le.ChineseWuSimplifiedYunzhe,e),children:[i.jsx("option",{value:"undefined",children:b("header.settings.previewAudio.notModified")}),S[Le.ChineseWuSimplifiedYunzhe].map((e=>i.jsx("option",{value:e,children:e},e)))]})]})]})]}),i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:b("header.settings.telemetry.title")}),i.jsxs(u,{mt:"3",children:[i.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:b("header.settings.telemetry.info")}),i.jsxs(u,{mt:"3",mb:"1",children:[i.jsxs(u,{display:"flex",mb:"1",children:[i.jsx(m,{flex:"1",children:b("header.settings.telemetry.essential")}),i.jsx(G,{label:b("header.settings.telemetry.essentialTooltip"),children:i.jsx(t,{isChecked:H,isDisabled:!0})})]}),i.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:b("header.settings.telemetry.essentialInfo")}),i.jsxs(O,{color:z,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[b("header.settings.telemetry.essentialLink")," ",i.jsx(E,{as:Se})]})]}),i.jsxs(u,{mt:"1",mb:"1",children:[i.jsxs(u,{display:"flex",children:[i.jsx(m,{flex:"1",children:b("header.settings.telemetry.additional")}),i.jsx(t,{isChecked:a,onChange:({target:{checked:e}})=>{w(sn(e))}})]}),i.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:b("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})};function Gn(){const{t:e}=cn();te();const s=q.isAllowAnalytics(),[t,r]=pn.useState(!1),[o,l]=pn.useState(!1),d=n(q.getEnv),h=n(q.getAppVersion);return pn.useEffect((()=>{s&&d!==Ke.DEV&&q.event(ke.APP_LOAD,{isStandaloneWindow:q.isStandaloneWindow()})}),[d]),i.jsxs(tn,{children:[i.jsx(x,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rma")}),i.jsx(an,{environment:d,version:h,popoverHeader:d===Ke.PRD?void 0:i.jsxs(mn,{i18nKey:"header.popoverHeader",environment:d,children:["You're on ",{environment:d}," environment!"]}),popoverBody:d===Ke.PRD?void 0:i.jsx(mn,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),i.jsxs(V,{ml:"auto",children:[i.jsx(F,{children:i.jsx(fn,{})}),i.jsx(F,{children:i.jsx(Un,{})}),i.jsx(F,{children:i.jsx(Mn,{})}),i.jsx(F,{children:i.jsx(a,{size:"sm",variant:"ghost","aria-label":"Settings",icon:i.jsx(rn,{}),onClick:()=>r(!0)})}),q.isStandaloneWindow()&&i.jsx(F,{children:i.jsxs(P,{children:[i.jsx(W,{as:a,icon:i.jsx(on,{}),variant:"ghost",size:"sm"}),i.jsx(R,{children:["en","zh-Hans","zh-Hant","ja","ko"].map((e=>i.jsx(N,{onClick:()=>{return n=e,void q.getI18nInstance().changeLanguage(n);var n},children:gn[e][e]},e)))})]})}),i.jsx(F,{children:i.jsx(a,{size:"sm",variant:"ghost","aria-label":"Help",icon:i.jsx(ln,{}),onClick:()=>l(!0)})})]}),i.jsx(Bn,{isOpen:t,onClose:()=>r(!1)}),i.jsx(wn,{isOpen:o,onClose:()=>l(!1)}),i.jsx(Rn,{})]})}function Yn(){const e=te(),n=se((e=>e.runtime.globalAlerts));return i.jsx(i.Fragment,{children:Object.entries(n).map((([n,{message:s,url:t,linkedApp:a}])=>i.jsxs(X,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[i.jsx($,{}),a?i.jsx(O,{onClick:()=>(e=>{q.isStandaloneWindow()?window.open(`/${e}`,"_blank"):q.openApp({appId:e})})(a),children:s}):t?i.jsx(O,{href:t,target:"_blank",children:s}):s,i.jsx(J,{ml:"auto",onClick:()=>e(dn(n))})]},n)))})}}}}));
