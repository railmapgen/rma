System.register(["./chakra-legacy-Cd_onqHs.js","./index-legacy-D98tJa30.js","./react-legacy-hZgLs8_m.js","./rmg-output-legacy-c0w5dFxW.js"],(function(e,n){"use strict";var i,s,t,a,r,o,l,d,h,c,m,p,u,x,g,j,f,w,b,z,k,v,y,C,S,T,H,O,A,D,M,E,P,W,R,I,N,L,U,_,B,G,Y,V,F,X,$,J,K,q,Z,Q,ee,ne,ie,se,te,ae,re,oe,le,de,he,ce,me,pe,ue,xe,ge,je,fe,we,be,ze,ke,ve,ye,Ce,Se,Te,He,Oe,Ae,De,Me,Ee,Pe,We,Re,Ie,Ne,Le,Ue,_e,Be,Ge,Ye,Ve,Fe,Xe,$e,Je,Ke,qe,Ze,Qe,en,nn,sn,tn,an,rn,on,ln,dn,hn,cn,mn,pn,un,xn,gn,jn,fn,wn;return{setters:[e=>{i=e.j,s=e.h,t=e.aq,a=e.a1,r=e.ak,o=e.M,l=e.al,d=e.G,h=e.H,c=e.J,m=e.ar,p=e.K,u=e.B,x=e.an,g=e.am,j=e.T,f=e.as,w=e.b,b=e.L,z=e.N,k=e.at,v=e.O,y=e.au,C=e.ap,S=e.Q,T=e.av,H=e.aw,O=e.q,A=e.ad,D=e.ae,M=e.af,E=e.ag,P=e.ah,W=e.ai,R=e.aj,I=e.ao,N=e.ax,L=e.ay,U=e.az,_=e.aA,B=e.aB,G=e.aC,Y=e.aD,V=e.aE,F=e.a0,X=e.aF,$=e.aG,J=e.k,K=e.W,q=e.R,Z=e.U,Q=e.aH},e=>{ee=e.u,ne=e.r,ie=e.R,se=e.a,te=e.b,ae=e.c,re=e.d,oe=e.e,le=e.f,de=e.g,he=e.v,ce=e.M,me=e.h,pe=e.i,ue=e.s,xe=e.p,ge=e.l,je=e.n,fe=e.j,we=e.k,be=e.m,ze=e.o,ke=e.q,ve=e.A,ye=e.t,Ce=e.w,Se=e.x,Te=e.y,He=e.z,Oe=e.E,Ae=e.B,De=e.C,Me=e.D,Ee=e.F,Pe=e.G,We=e.H,Re=e.I,Ie=e.J,Ne=e.K,Le=e.L,Ue=e.S,_e=e.N,Be=e.O,Ge=e.P,Ye=e.V,Ve=e.Q,Fe=e.T,Xe=e.U,$e=e.W,Je=e.X,Ke=e.Y,qe=e.Z,Ze=e._,Qe=e.$,en=e.a0,nn=e.a1,sn=e.a2,tn=e.a3,an=e.a4,rn=e.a5,on=e.a6,ln=e.a7,dn=e.a8,hn=e.a9,cn=e.aa,mn=e.ab,pn=e.ac,un=e.ad},e=>{xn=e.a,gn=e.m,jn=e.d,fn=e.T},e=>{wn=e.R}],execute:function(){e("default",(function(){return i.jsxs(i.Fragment,{children:[i.jsx(Jn,{}),i.jsx(Kn,{})]})}));var n=function(e){return ee(ne.ready(),e)};function bn(e){var n=e.fields,a=e.noLabel,r=e.minW;return i.jsx(s,{wrap:"wrap",children:n.map((function(e,n){if(e.hidden)return i.jsx(xn.Fragment,{},n);var s=e.minW||r,o="full"===s;return i.jsx(ie,{className:o?"mw-full":"",label:e.label,flex:o?void 0:1,minW:o?void 0:s,noLabel:a,oneLine:e.oneLine,helper:e.helper,errorMessage:e.errorMessage,children:function(e){switch(e.type){case"input":return i.jsx(re,{placeholder:e.placeholder,defaultValue:e.value,type:e.variant,validator:e.validator,onDebouncedChange:e.onChange,delay:e.debouncedDelay,optionList:e.optionList,isDisabled:e.isDisabled});case"output":return i.jsx(wn,{noWrap:e.noWrap,children:e.value});case"textarea":return i.jsx(ae,{placeholder:e.placeholder,defaultValue:e.value,onDebouncedChange:e.onChange,isDisabled:e.isDisabled});case"slider":return i.jsx(te,{defaultValue:e.value,min:e.min,max:e.max,step:e.step,onThrottledChange:e.onChange,leftIcon:e.leftIcon,rightIcon:e.rightIcon,isDisabled:e.isDisabled});case"select":return i.jsx(se,{defaultValue:e.value,onChange:function(n){var i,s=n.target.value;return null===(i=e.onChange)||void 0===i?void 0:i.call(e,"number"==typeof e.value?Number(s):s.toString())},options:e.options,disabledOptions:e.disabledOptions,isInvalid:e.isInvalid,isDisabled:e.isDisabled});case"switch":return i.jsx(t,{isChecked:e.isChecked,isDisabled:e.isDisabled,onChange:function(n){var i,s=n.target.checked;return null===(i=e.onChange)||void 0===i?void 0:i.call(e,s)}});case"custom":return e.component;default:return i.jsx("div",{})}}(e)},n)}))})}var zn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const kn=(()=>{const e=navigator.platform.toLowerCase();return e.includes("win")?"win":e.includes("android")?"android":e.includes("mac")?"mac":e.includes("iphone")||e.includes("ipad")?"ios":e.includes("linux")?"linux":"unknown"})();function vn(){const{reconciledPhrases:e,currentStyle:n,currentStationID:s,currentStage:t,currentVoice:r}=oe((e=>e.runtime)),{preference:{previewAudio:o}}=oe((e=>e.app)),l=le(),{t:d}=gn(),[h,c]=jn.useState(!1),[m,p]=jn.useState(!1),u=de();return jn.useEffect((()=>{const e=he[n]?.defaultLang?.[r],i=u.find((n=>n.lang===e));p(!!i)}),[r,u]),i.jsx(a,{size:"sm",variant:"ghost","aria-label":"Settings",icon:m?h?i.jsx(ce,{}):i.jsx(me,{}):i.jsx(pe,{}),isDisabled:!m,onClick:h?()=>{window.speechSynthesis.pause(),c(!1)}:()=>{l(ue({status:"info",message:d("header.paly.previewWarning")}));const i=window.speechSynthesis;if(i.paused&&i.speaking)return c(!0),void i.resume();const a=e[s]?.[t]?.[r],h=xe(a??[]),m=""===h?" ":h,p=new SpeechSynthesisUtterance(m),u=o[r]??he[n]?.preferredPreviewVoiceName?.[r]?.[kn],x=i.getVoices().find((e=>e.name===u)),g=he[n]?.defaultLang?.[r];if(x)p.voice=x;else{if(!g)return void ge.error("Preview language not found for",r);p.lang=g}p.onend=()=>{c(!1)},c(!0),ge.debug(`Previewing audio "${m}" with ${p.voice?.name}`),i.speak(p)}})}const yn=e=>{const{isOpen:n,onClose:t}=e,{t:a}=gn(),b=ne.getAppVersion();return i.jsxs(r,{isOpen:n,onClose:t,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:a("header.about.title")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsxs(s,{direction:"row",children:[i.jsx(m,{boxSize:"128px",src:"/rma//logo192.png"}),i.jsxs(s,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[i.jsx(p,{fontSize:"xl",as:"b",children:a("header.about.rma")}),i.jsx(p,{children:b}),i.jsx(p,{}),i.jsx(p,{fontSize:"sm",children:a("header.about.railmapgen")})]})]}),i.jsx(u,{margin:5,children:i.jsx(p,{fontSize:"xl",children:a("header.about.desc")})}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:a("header.about.contributors")}),i.jsx(g,{children:i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),i.jsx(p,{fontSize:"sm",children:a("header.about.content1")}),i.jsx(p,{fontSize:"sm",align:"right",mb:1,children:a("header.about.content2")})]})]})}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:a("header.about.contactUs")}),i.jsxs(g,{children:[i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.about.github")}),i.jsx(p,{fontSize:"sm",children:a("header.about.githubContent")})]})]}),i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.about.slack")}),i.jsx(p,{fontSize:"sm",children:a("header.about.slackContent")}),i.jsx(p,{fontSize:"sm",as:"i",children:"#rma, #rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),i.jsx(x,{as:"h5",size:"sm",mt:3,mb:2,children:a("header.donation.title")}),i.jsxs(g,{children:[i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",pb:1,children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.donation.afdian")}),i.jsx(p,{fontSize:"sm",children:a("header.donation.viaCNY")})]})]}),i.jsxs(j,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[i.jsx(f,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),i.jsxs(w,{display:"block",width:"100%",pb:1,children:[i.jsx(p,{fontSize:"lg",fontWeight:"bold",mb:1,children:a("header.donation.openCollective")}),i.jsx(p,{fontSize:"sm",children:a("header.donation.viaUSD")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */function Cn(e){const n=e.sizes.shift(),i=Math.max(Math.ceil(n[0]),1),s=Math.max(Math.ceil(n[1]),1),t=[i-1,s-1,1,1],a=performance.now(),r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let o,l;r?(o=new OffscreenCanvas(1,1),l=new OffscreenCanvas(i,s)):(o=document.createElement("canvas"),o.width=1,o.height=1,l=document.createElement("canvas"),l.width=i,l.height=s);const d=o.getContext("2d"),h=l.getContext("2d");h&&(h.fillRect.apply(h,t),d.drawImage(l,i-1,s-1,1,1,0,0,1,1));const c=d&&0!==d.getImageData(0,0,1,1).data[3],m=parseInt(performance.now()-a);return[o,l].forEach((e=>{e.height=0,e.width=0})),r?(postMessage({width:i,height:s,testTime:m,isTestPass:c}),!c&&e.sizes.length&&setTimeout((()=>{Cn(e)}),0)):c?e.onSuccess({width:i,height:s,testTime:m}):(e.onError({width:i,height:s,testTime:m}),e.sizes.length&&setTimeout((()=>{Cn(e)}),0)),c}const Sn={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Tn={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Hn={};function On(e){const n=e.width===e.height,i=1===e.height,s=1===e.width,t=[];if(e.width&&e.height){const a=e.min||Tn.min,r=e.step||Tn.step;let o=Math.max(e.width,e.height);for(;o>=a;){const e=n||i?o:1,a=n||s?o:1;t.push([e,a]),o-=r}}else e.sizes.forEach((e=>{const a=n||i?e:1,r=n||s?e:1;t.push([a,r])}));return t}function An(e){const n="undefined"!=typeof window,i=n&&"Promise"in window,s=n&&"HTMLCanvasElement"in window,t=n&&"OffscreenCanvas"in window,a=URL.createObjectURL(new Blob([])).slice(-36),r=performance.now(),{onError:o,onSuccess:l,...d}=e,h=()=>parseInt(performance.now()-r);let c=null;if(!s)return!1;if(e.useWorker&&t){const e=`\n            var canvasTest = ${Cn.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,n=new Blob([e],{type:"application/javascript"}),i=URL.createObjectURL(n);c=new Worker(i),URL.revokeObjectURL(i),c.onmessage=function(e){const{width:n,height:i,testTime:s,isTestPass:t}=e.data,r={width:n,height:i,testTime:s,totalTime:h()};t?(Hn[a].onSuccess(r),delete Hn[a]):Hn[a].onError(r)}}return i?new Promise((n=>{const i={...e,onError(i){let{width:s,height:t,testTime:a}=i;const r={width:s,height:t,testTime:a,totalTime:h()};let l;if(0===e.sizes.length)l=!0;else{const[[n,i]]=e.sizes.slice(-1);l=s===n&&t===i}o(r),l&&n({...r,success:!1})},onSuccess(e){let{width:i,height:s,testTime:t}=e;const a={width:i,height:s,testTime:t,totalTime:h()};l(a),n({...a,success:!0})}};if(c){const{onError:e,onSuccess:n}=i;Hn[a]={onError:e,onSuccess:n},c.postMessage(d)}else Cn(i)})):c?(Hn[a]={onError:o,onSuccess:l},void c.postMessage(d)):Cn(e)}const Dn={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=On({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...Sn.area]});return An({...Tn,...e,sizes:n})},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=On({width:1,height:e.max,min:e.min,step:e.step,sizes:[...Sn.height]});return An({...Tn,...e,sizes:n})},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=On({width:e.max,height:1,min:e.min,step:e.step,sizes:[...Sn.width]});return An({...Tn,...e,sizes:n})},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n={...Tn,...e};return n.sizes=[...n.sizes],n.width&&n.height&&(n.sizes=[[n.width,n.height]]),An(n)}},Mn=(e,n,i)=>{const s=new Blob([i],{type:n});En(e,s)},En=(e,n)=>{const i=window.URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(i)},Pn=e=>{const{isOpen:n,onClose:s}=e,{t:t}=gn(),a=le(),{reconciledPhrases:m}=oe((e=>e.runtime)),{points:u}=oe((e=>e.audio)),x=100*Object.keys(m).length;return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:t("header.audioTask.new.title")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsx(p,{children:t("header.audioTask.new.content1")}),i.jsxs(p,{children:[t("header.audioTask.new.content2"),x]}),i.jsx(p,{children:t("header.audioTask.new.content3")}),i.jsx(p,{children:t("header.audioTask.new.content4")})]}),i.jsx(b,{children:i.jsx(z,{style:{alignSelf:"center"},onClick:()=>a(je()),isDisabled:u<x,children:t("header.audioTask.new.create")})})]})]})},Wn=e=>{k();const{t:n}=gn(),{isOpen:s,onClose:t}=e,a=le(),m=v("primary.500","primary.300"),[u,x]=jn.useState("");return i.jsxs(r,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:n("header.audioTask.redeem.title")}),i.jsx(h,{}),i.jsxs(c,{children:[i.jsx(p,{mb:"4",children:n("header.audioTask.redeem.desc")}),i.jsx(y,{children:i.jsx(C,{children:i.jsxs(S,{color:m,href:"https://afdian.com/item/851c2bb4110d11f0935a5254001e7c00",isExternal:!0,children:["爱发电 ",i.jsx(T,{as:fe})]})})}),i.jsxs(H,{mt:"5",direction:{base:"column",sm:"row"},children:[i.jsx(p,{mr:"auto",children:n("header.audioTask.redeem.input")}),i.jsx(O,{w:"200px",value:u,onChange:e=>x(e.target.value)}),i.jsx(z,{colorScheme:"teal",onClick:()=>a(we(u.trim())),children:n("header.audioTask.redeem.redeem")})]})]}),i.jsx(b,{})]})]})},Rn=e=>{const{isOpen:n,onClose:t}=e,{t:m}=gn(),u=le(),{telemetry:{project:x}}=oe((e=>e.app)),{tasks:j,points:f}=oe((e=>e.audio)),{rmtToken:w,reconciledPhrases:b}=oe((e=>e.runtime)),{project:k}=oe((e=>e.param)),{style:y,metadata:C}=k,T=ne.isAllowAnalytics(),H=v("primary.500","primary.300"),[O,I]=jn.useState(!1),[N,L]=jn.useState(!1);return jn.useEffect((()=>{n&&u(be())}),[n]),i.jsxs(r,{isOpen:n,onClose:t,size:"4xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:m("header.download.audio")}),i.jsx(h,{}),i.jsxs(c,{paddingBottom:10,children:[i.jsx(p,{fontSize:"lg",mb:"4",children:m("header.audioTask.desc")}),i.jsx(p,{fontSize:"md",mt:"4",color:"gray.600",children:m("header.audioTask.exampleZH")}),i.jsxs("audio",{controls:!0,children:[i.jsx("source",{src:"audio/shmetro-zh.mp3",type:"audio/mpeg"}),m("header.audioTask.audioNotSupported")]}),i.jsx(p,{fontSize:"md",mt:"4",color:"gray.600",children:m("header.audioTask.exampleEN")}),i.jsxs("audio",{controls:!0,children:[i.jsx("source",{src:"audio/shmetro-en.mp3",type:"audio/mpeg"}),m("header.audioTask.audioNotSupported")]}),w?i.jsxs(i.Fragment,{children:[i.jsxs(s,{pl:"4",pr:"4",mt:"10",mb:"4",children:[i.jsx(p,{as:"b",fontSize:"4xl",children:f}),i.jsx(p,{style:{alignSelf:"self-end",marginLeft:"10px"},children:"pts"}),i.jsx(s,{style:{flex:1}}),i.jsx(p,{as:"b",style:{alignSelf:"self-end"},children:m("header.audioTask.title")}),i.jsx(s,{style:{flex:1}}),i.jsx(z,{leftIcon:i.jsx(ze,{}),style:{alignSelf:"center"},onClick:()=>L(!0),mr:"2",children:m("header.audioTask.topUp")}),i.jsx(Wn,{isOpen:N,onClose:()=>L(!1)}),i.jsx(z,{leftIcon:i.jsx(ke,{}),style:{alignSelf:"center"},onClick:()=>I(!0),children:m("header.audioTask.new.title")}),i.jsx(Pn,{isOpen:O,onClose:()=>I(!1)})]}),i.jsx(A,{height:"100%",overflowY:"auto",children:i.jsxs(D,{variant:"simple",height:"100%",children:[i.jsx(M,{children:i.jsxs(E,{children:[i.jsx(P,{children:m("header.audioTask.table.id")}),i.jsx(P,{children:m("header.audioTask.table.status")}),i.jsx(P,{children:m("header.audioTask.table.createdAt")}),i.jsx(P,{children:m("header.audioTask.table.updatedAt")}),i.jsx(P,{children:m("header.audioTask.table.points")}),i.jsx(P,{children:m("header.audioTask.table.actions")})]})}),i.jsx(W,{children:j.map((({id:e,status:n,createdAt:s,updatedAt:t,points:r})=>i.jsxs(E,{children:[i.jsx(R,{children:e}),i.jsx(R,{children:n}),i.jsx(R,{children:new Date(s).toLocaleString()}),i.jsx(R,{children:new Date(t).toLocaleString()}),i.jsx(R,{children:r}),i.jsxs(R,{children:[n===ve.CREATED&&i.jsx(a,{icon:i.jsx(Ce,{}),"aria-label":m("Cancel Task"),onClick:()=>u(ye(e))}),n===ve.COMPLETED&&i.jsx(a,{icon:i.jsx(Se,{}),"aria-label":m("Download Audio"),onClick:()=>(async e=>{const n=await Te(`${He.AUDIOTASKS}/${e}/download`,{},w);if(!n||!n.ok)throw new Error("Download error");En(`${e}.zip`,await n.blob())})(e)})]})]},e)))})]})})]}):i.jsx(p,{mt:"10",textAlign:"center",children:m("header.audioTask.loginFirst")}),i.jsx(g,{mt:10,children:i.jsxs(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[m("header.audioTask.freeInternet1"),i.jsx(S,{color:H,fontSize:"sm",lineHeight:"100%",onClick:()=>{T&&ne.event(Oe.DOWNLOAD_TEXT,x?{style:y,"#stations":Object.keys(C).length}:{});const e=Ae(b);Mn(`RMA_${(new Date).valueOf()}.txt`,"text/plain",e.join("\n"))},children:m("header.audioTask.freeInternet2")}),m("header.audioTask.freeInternet3")]})})]})]})]})},In=e=>{const{isOpen:n,onClose:s}=e,{t:t}=gn();return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:t("header.download.termsAndConditions")}),i.jsx(h,{}),i.jsx(c,{children:i.jsxs(I,{children:[i.jsxs(C,{children:["The layout of the elements on the signage or rail map, is designed by"," ",i.jsxs(S,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",i.jsx(T,{as:fe})]}),", ",i.jsxs(S,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",i.jsx(T,{as:fe})]})," or ",i.jsxs(S,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",i.jsx(T,{as:fe})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",i.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",i.jsxs(S,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",i.jsx(T,{as:fe})]}),"，",i.jsxs(S,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",i.jsx(T,{as:fe})]}),"或",i.jsxs(S,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",i.jsx(T,{as:fe})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),i.jsxs(C,{children:["The elements including shapes and lines on the image are drawn by"," ",i.jsxs(S,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",i.jsx(T,{as:fe})]})," and ",i.jsxs(S,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",i.jsx(T,{as:fe})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",i.jsx("br",{}),"图像的元素，包括图形及线条，均由",i.jsxs(S,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",i.jsx(T,{as:fe})]}),"及",i.jsxs(S,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",i.jsx(T,{as:fe})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),i.jsxs(C,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",i.jsxs(S,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",i.jsx(T,{as:fe})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",i.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",i.jsxs(S,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",i.jsx(T,{as:fe})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),i.jsxs(C,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",i.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),i.jsxs(C,{children:["All flag emojis shown on Windows platforms are designed by"," ",i.jsxs(S,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",i.jsx(T,{as:fe})]})," ","– the open-source emoji and icon project. License:",i.jsxs(S,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",i.jsx(T,{as:fe})]}),i.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",i.jsxs(S,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",i.jsx(T,{as:fe})]}),"所设计。许可证：",i.jsxs(S,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",i.jsx(T,{as:fe})]})]}),i.jsxs(C,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",i.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Nn(){const{telemetry:{project:e}}=oe((e=>e.app)),n=le(),{realColumns:s}=oe((e=>e.crawl)),{project:t}=oe((e=>e.param)),{reconciledPhrases:m,currentStationID:u,currentStage:x,currentVoice:g}=oe((e=>e.runtime)),{isModalOpen:j}=oe((e=>e.audio)),{style:f,metadata:w}=t,k=ne.isAllowAnalytics(),{t:v}=gn(),[y,C]=jn.useState("png"),H={png:v("header.download.png"),svg:v("header.download.svg")},[O,A]=jn.useState({width:1,height:1,benchmark:.001}),[D,M]=jn.useState(200),E=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],P=Object.fromEntries(E.map((e=>[e,`${e}%`]))),[W,R]=jn.useState([]),I=[{type:"select",label:v("header.download.format"),value:y,options:H,onChange:e=>C("png"===e?"png":"svg")}],Y=[{type:"select",label:v("header.download.scale"),value:D,options:P,disabledOptions:W,onChange:e=>M(e)}],[V,F]=jn.useState(!1),[X,$]=jn.useState(!1),[J,K]=jn.useState(!1),[q,Z]=jn.useState(!1);return jn.useEffect((()=>{(async()=>{const e=await Dn.maxArea({usePromise:!0,useWorker:!0});A(e)})()}),[]),jn.useEffect((()=>{if(V){const[e,n]=[s*Ie*D/100,Ne*Ie*D/100],i=E.filter((i=>e*i/100>O.width||n*i/100>O.height));R(i)}}),[V]),i.jsxs(N,{id:"download",children:[i.jsx(L,{as:a,size:"sm",variant:"ghost",icon:i.jsx(De,{})}),i.jsxs(U,{children:[i.jsx(_,{icon:i.jsx(Me,{}),onClick:()=>{k&&ne.event(Oe.DOWNLOAD_PARAM,e?{style:f,"#stations":Object.keys(w).length}:{}),Mn(`RMA_${(new Date).valueOf()}.json`,"application/json",JSON.stringify(t,null,2))},children:v("header.download.config")}),i.jsx(_,{icon:i.jsx(Ee,{}),onClick:()=>F(!0),children:v("header.download.image")}),i.jsx(_,{icon:i.jsx(We,{}),onClick:()=>n(Pe()),children:v("header.download.audio")})]}),i.jsxs(r,{size:"xl",isOpen:V,onClose:()=>F(!1),children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:v("header.download.image")}),i.jsx(h,{}),i.jsxs(c,{children:[i.jsx(bn,{fields:I}),"svg"===y&&i.jsx(bn,{fields:[]}),"png"===y&&i.jsx(bn,{fields:Y}),"png"===y&&W.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(p,{as:"i",fontSize:"sm",children:v("header.download.disabledScaleOptions")}),i.jsx("br",{}),i.jsx(p,{as:"i",fontSize:"sm",children:v("header.download.disabledScaleOptionsWorkarounds")}),i.jsxs(S,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",i.jsx(T,{as:fe})]}),i.jsx("br",{})]}),i.jsx("br",{}),i.jsx(B,{isChecked:q,onChange:e=>Z(e.target.checked),children:i.jsxs(p,{children:[v("header.download.termsAndConditionsInfo"),i.jsxs(S,{color:"teal.500",onClick:()=>$(!0),children:[v("header.download.termsAndConditions")," ",i.jsx(T,{as:fe})]}),v("header.download.period")]})})]}),i.jsx(b,{children:i.jsx(G,{children:i.jsx(z,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!q||"png"===y&&W.includes(D),onClick:()=>{const e=m[u]?.[x]?.[g],n=Le(e??[]),i=""===n?" ":n,t=document.getElementById("crawl").cloneNode(!0),a=t.outerHTML;if("svg"===y)return void Mn(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",a);document.body.appendChild(t);const r="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a)));document.body.removeChild(t),t.remove();const o=document.createElement("canvas"),[l,d]=[s*Ie*D/100,Ne*Ie*D/100];o.width=l,o.height=d;const h=o.getContext("2d");h.fillStyle="black",h.fillRect(0,0,l,d);const c=new Image;c.onload=()=>{setTimeout((()=>{h.drawImage(c,0,0,l,d),o.toBlob((e=>{En(`RMA_${i}.png`,e)}),"image/png")}),0)},c.src=r},children:v("header.download.confirm")})})}),i.jsx(In,{isOpen:X,onClose:()=>$(!1)})]})]}),i.jsx(Rn,{isOpen:j,onClose:()=>n(Re())})]})}const Ln=e=>{const n=["linestart"],i=[["linestart"]];let s=0;for(;n.length;){let t=n.shift(),a=i[s].slice(-1)[0]||null;for(a&&"linestart"!==t?i[s].push(t):i[s]=[t];"lineend"!==t;){a=t;const r=e[a].children;switch(r.length){case 1:t=r[0];break;case 2:{const o=e[a].branch.right,l=o[1];"through"===o[0]?(i.push(i[s].slice()),n.push(l)):0===s&&(i.push([a]),n.push(l)),t=r.filter((e=>e!==l))[0];break}}if(i[s].push(t),a===e[t].branch?.left?.[1]&&"nonthrough"===e[t].branch?.left?.[0])break}s++}return i},Un=e=>{for(const n in e)e[n]=e[n].replaceAll("\\"," ").replaceAll("\n"," ");return e},_n=(e,n,i=Ue.local)=>{const s=structuredClone(_e),{line_name:t,stn_list:a,loop:r,direction:o}=e,l="left",d=Ln(a).map((e=>e.slice(1,-1)));o===Be.left&&d.forEach((e=>e.reverse()));let h=d.at(n)??d.at(-1);i!==Ue.local&&(h=h.filter((e=>a[e].services.includes(i))));const c=h,m=new Set(c.map((e=>a[e].services)).flat()),p=c.at(-1),u=d.map((e=>e[e.length-1])).find((e=>e!==p)),{localisedName:x}=a[p];Un(x),s.baseVariants=((e,n,i="left",s="left",t,a=!0,r=!1,o="none",l=!1,d=Ue.local)=>({[Ge.Arrival]:{[Ye.ChineseWuSimplifiedXiaotong]:{terminal:e.zh,terminalPinyin:e.zh,doorDirection:i,thanksForTaking:t?.at(0),thanksForTakingPinyin:t?.at(0)},[Ye.ChineseMandarinSimplified]:{terminal:e.zh,terminalPinyin:e.zh,doorDirection:i,thanksForTaking:t?.at(0),thanksForTakingPinyin:t?.at(0)},[Ye.ChineseWuSimplifiedYunzhe]:{terminal:e.en,terminalPinyin:e.en,doorDirection:i,thanksForTaking:t?.at(1),thanksForTakingPinyin:t?.at(1)}},[Ge.Departure]:{[Ye.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:t?.at(0),welcomeAbroadPinyin:t?.at(0),terminal:e.zh,terminalPinyin:e.zh,nextDoorDirection:s,lineName:n[0],lineNamePinyin:n[0],noteLastTrain:a,loop:o,loopTerminal:l,service:d},[Ye.ChineseMandarinSimplified]:{welcomeAbroad:t?.at(0),welcomeAbroadPinyin:t?.at(0),terminal:e.zh,terminalPinyin:e.zh,nextDoorDirection:s,lineName:n[0],lineNamePinyin:n[0],noteLastTrain:a,loop:o,loopTerminal:l,service:d},[Ye.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:t?.at(1),welcomeAbroadPinyin:t?.at(0),terminal:e.en,terminalPinyin:e.en,nextDoorDirection:s,lineName:n[1],lineNamePinyin:n[1],service:d}},[Ge.Midway]:{[Ye.ChineseWuSimplifiedXiaotong]:{caution:r},[Ye.ChineseMandarinSimplified]:{caution:r},[Ye.ChineseWuSimplifiedYunzhe]:{}}}))(x,t,l,"left",void 0,void 0,void 0,r?"inner":"none",!1,m.has(i)?i:Ue.local);for(const[g,j]of c.entries()){const{localisedName:e}=a[j];if(Un(e),s.metadata[j]={name:Object.values(e).at(0)??""},s.stations[j]={},s.stations[j][Ge.Midway]={[Ye.ChineseWuSimplifiedXiaotong]:{},[Ye.ChineseMandarinSimplified]:{},[Ye.ChineseWuSimplifiedYunzhe]:{}},0!==g&&(s.stations[j][Ge.Arrival]={[Ye.ChineseWuSimplifiedXiaotong]:{name:e.zh,namePinyin:e.zh},[Ye.ChineseMandarinSimplified]:{name:e.zh,namePinyin:e.zh},[Ye.ChineseWuSimplifiedYunzhe]:{name:e.en,namePinyin:e.en}}),g!==c.length-1||r){const e=r&&g===c.length-1?c[0]:c[g+1],{localisedName:n}=a[e];Un(n);const t=a[e].transfer.groups.map((e=>e.lines?.map((e=>e.name)))).filter((e=>void 0!==e));if(s.stations[j][Ge.Departure]={[Ye.ChineseWuSimplifiedXiaotong]:{next:n.zh,nextPinyin:n.zh,int:t?.map((e=>e?.map((e=>e[0]))))},[Ye.ChineseMandarinSimplified]:{next:n.zh,nextPinyin:n.zh,int:t?.map((e=>e?.map((e=>e[0]))))},[Ye.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:!1,next:n.en,nextPinyin:n.en,int:t?.map((e=>e?.map((e=>e[1])))),noteLastTrain:!1}},u&&g+1<c.length&&a[c[g+1]].branch?.["l"===o?Ve.left:Ve.right]){const{localisedName:e}=a[u];Un(e),s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedXiaotong]={...s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedXiaotong],branchTerminalName:e.zh,branchTerminalNamePinyin:e.zh},s.stations[j][Ge.Departure][Ye.ChineseMandarinSimplified]={...s.stations[j][Ge.Departure][Ye.ChineseMandarinSimplified],branchTerminalName:e.zh,branchTerminalNamePinyin:e.zh},s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedYunzhe]={...s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedYunzhe],branchTerminalName:e.en,branchTerminalNamePinyin:e.en}}if(i!==Ue.local){const e=c.slice(g+1,-1).map((e=>{const{localisedName:n}=a[e];return Un(n),n}));s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedXiaotong]={...s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedXiaotong],stopovers:e.map((e=>e.zh))},s.stations[j][Ge.Departure][Ye.ChineseMandarinSimplified]={...s.stations[j][Ge.Departure][Ye.ChineseMandarinSimplified],stopovers:e.map((e=>e.zh))},s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedYunzhe]={...s.stations[j][Ge.Departure][Ye.ChineseWuSimplifiedYunzhe],stopovers:e.map((e=>e.en))}}}}if(r){const e=c[0],{localisedName:n}=a[e];Un(n),s.stations[e][Ge.Arrival]={[Ye.ChineseWuSimplifiedXiaotong]:{name:n.zh,namePinyin:n.zh,doorDirection:l},[Ye.ChineseMandarinSimplified]:{name:n.zh,namePinyin:n.zh,doorDirection:l},[Ye.ChineseWuSimplifiedYunzhe]:{name:n.en,namePinyin:n.en,doorDirection:l}}}return s},Bn=()=>{const{t:e}=gn(),n=le(),s=ne.isAllowAnalytics(),{rmgParam:t,route:a,service:m}=oe((e=>e.import)),j=t?Ln(t.stn_list).map((e=>[e.at(1),e.at(-2)])):[],f=t?j.map((e=>e.map((e=>Object.values(t.stn_list[e].localisedName).join(" "))))):[],w=new Set(Object.values(t?.stn_list??{}).map((e=>e.services)).flat());return i.jsxs(r,{isOpen:void 0!==t,onClose:()=>n($e()),size:"lg",children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:e("import.title")}),i.jsx(h,{color:"white"}),i.jsxs(c,{py:3,children:[1===j.length&&1===w.size&&i.jsx(p,{children:e("import.goodToGo")}),j.length>1&&i.jsxs(i.Fragment,{children:[i.jsx(x,{fontSize:"md",mb:4,children:e("import.routes")}),i.jsx(Y,{onChange:e=>n(Fe(Number(e))),value:a.toString(),children:i.jsx(G,{spacing:4,align:"stretch",children:f.map(((e,n)=>i.jsx(u,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:a===n?"blue.500":"gray.200",children:i.jsx(V,{value:n.toString(),colorScheme:"blue",children:i.jsx(g,{align:"start",spacing:1,ml:2,children:i.jsx(p,{fontSize:"sm",children:e.join(" <=> ")})})})},n)))})})]}),w.size>1&&i.jsxs(i.Fragment,{children:[i.jsx(x,{fontSize:"md",mb:4,children:e("import.services")}),i.jsx(Y,{onChange:e=>n(Xe(e)),value:m,children:i.jsx(G,{spacing:4,align:"stretch",children:[...w].map((n=>i.jsx(u,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:m===n?"blue.500":"gray.200",children:i.jsx(V,{value:n,colorScheme:"blue",children:i.jsx(g,{align:"start",spacing:1,ml:2,children:i.jsx(p,{fontSize:"sm",children:e(`import.service.${n}`)})})})},n)))})})]})]}),i.jsx(b,{children:i.jsx(z,{colorScheme:"teal",variant:"outline",onClick:()=>{if(t){s&&ne.event(Oe.IMPORT_RMG_PARAM);try{const e=_n(structuredClone(t),a,m);n(Je(e)),n(Ke(Object.keys(e.metadata)[0])),n(qe(Ge.Departure))}catch(i){n(ue({status:"error",message:e("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",i)}finally{n($e()),n(Fe(0)),n(Xe(Ue.local))}}},children:e("import.import")})})]})]})},Gn="rmg-bridge--",Yn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Vn(e){const{isOpen:n,onClose:s}=e,{t:t}=gn(),a=le(),[r]=xn.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:ne.getAppName(),parentId:r});return xn.useEffect((()=>{const e=new BroadcastChannel(Gn+r);return e.onmessage=e=>{const{event:n,data:i}=e.data;ge.info("Received event from RMG app clip:",n),"CLOSE"===n?s():"IMPORT"===n&&(e=>{try{a(Qe(e))}catch(n){a(ue({status:"error",message:t("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",n)}finally{s()}})(i)},()=>e.close()}),[]),i.jsx(Ze,{isOpen:n,onClose:s,sx:Yn,children:i.jsx("iframe",{src:o,loading:"lazy"})})}function Fn(){const e=le(),{t:s}=gn(),{preference:{import:{route:t,service:r}}}=oe((e=>e.app)),o=n(ne.getEnv),l=jn.useRef(null),d=jn.useRef(null),[h,c]=jn.useState(!1);return i.jsxs(N,{children:[i.jsx(L,{as:a,size:"sm",variant:"ghost",icon:i.jsx(en,{})}),i.jsxs(U,{children:[i.jsx("input",{id:"upload_project",ref:l,type:"file",accept:".json",hidden:!0,onChange:async n=>{const i=n.target.files?.[0];if(ge.info("OpenActions.handleUpload():: received file",i),"application/json"!==i?.type)e(ue({status:"error",message:s("header.open.invalidType")})),ge.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const t=await Xn(i),a=JSON.parse(t);if(!("baseVariants"in a))return e(ue({status:"error",message:s("header.open.invalidType")})),ge.error("OpenActions.handleUpload():: Not a valid RMA project."),void(n.target.value="");e(Je(a)),e(Ke(Object.keys(a.metadata)[0])),e(qe(Ge.Departure))}catch(t){e(ue({status:"error",message:s("header.open.unknownError")})),ge.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",t)}n.target.value=""},"data-testid":"file-upload"}),i.jsx(_,{icon:i.jsx(en,{}),onClick:()=>l?.current?.click(),children:s("header.open.config")}),i.jsx("input",{id:"upload_RMG",ref:d,type:"file",accept:".json",hidden:!0,onChange:async n=>{const i=n.target.files?.[0];if(ge.info("OpenActions.handleUpload():: received file",i),"application/json"!==i?.type)e(ue({status:"error",message:s("header.open.invalidType")})),ge.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const n=await Xn(i);e(Qe(JSON.parse(n)))}catch(t){e(ue({status:"error",message:s("header.open.unknownError")})),ge.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",t)}n.target.value=""},"data-testid":"file-upload"}),o===nn.DEV&&i.jsx(_,{icon:i.jsx(en,{}),onClick:()=>d?.current?.click(),children:s("header.open.RMG")}),i.jsx(_,{icon:i.jsx(sn,{}),onClick:()=>c(!0),children:s("header.open.projectRMG")})]}),i.jsx(Vn,{isOpen:h,onClose:()=>c(!1)})]})}const Xn=e=>new Promise((n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.readAsText(e)})),$n=e=>{const{isOpen:n,onClose:s}=e,{telemetry:{project:a},preference:{import:{route:m,service:j},previewAudio:f}}=oe((e=>e.app)),w=le(),{t:b}=gn(),z=v("primary.500","primary.300"),{scale:k}=oe((e=>e.crawl)),y=de(),[C,H]=jn.useState({[Ye.ChineseMandarinSimplified]:[],[Ye.ChineseWuSimplifiedXiaotong]:[],[Ye.ChineseWuSimplifiedYunzhe]:[]});jn.useEffect((()=>{H({[Ye.ChineseMandarinSimplified]:y.filter((e=>e.lang===he[tn.ShanghaiMetro]?.defaultLang?.[Ye.ChineseMandarinSimplified])).map((e=>e.name)),[Ye.ChineseWuSimplifiedXiaotong]:[],[Ye.ChineseWuSimplifiedYunzhe]:y.filter((e=>e.lang===he[tn.ShanghaiMetro]?.defaultLang?.[Ye.ChineseWuSimplifiedYunzhe])).map((e=>e.name))})}),[y]);const O=(e,n)=>{w("undefined"===n?rn(e):on([e,n]))},A=ne.isAllowAnalytics();return i.jsxs(r,{isOpen:n,onClose:s,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[i.jsx(o,{}),i.jsxs(l,{children:[i.jsx(d,{children:b("header.settings.title")}),i.jsx(h,{}),i.jsx(c,{children:i.jsxs(g,{divider:i.jsx($,{borderColor:"gray.200"}),children:[i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:b("header.settings.crawl.title")}),i.jsx(u,{mt:"3",children:i.jsx(ie,{label:b("header.settings.crawl.scale"),children:i.jsx(te,{defaultValue:k,value:k,min:.1,max:1,step:.1,onThrottledChange:e=>w(an(e))})})})]}),i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:b("header.settings.previewAudio.title")}),i.jsxs(u,{mt:"3",children:[i.jsxs(u,{mb:"1",display:"flex",children:[i.jsx(p,{flex:"1",children:b("header.settings.previewAudio.shmetro-zh")}),i.jsxs(F,{size:"xs",width:"300px",ml:"1",defaultValue:f[Ye.ChineseMandarinSimplified]??"undefined",onChange:({target:{value:e}})=>O(Ye.ChineseMandarinSimplified,e),children:[i.jsx("option",{value:"undefined",children:b("header.settings.previewAudio.notModified")}),C[Ye.ChineseMandarinSimplified].map((e=>i.jsx("option",{value:e,children:e},e)))]})]}),i.jsxs(u,{mb:"1",display:"flex",children:[i.jsx(p,{flex:"1",children:b("header.settings.previewAudio.shmetro-en")}),i.jsxs(F,{size:"xs",width:"300px",ml:"1",defaultValue:f[Ye.ChineseWuSimplifiedYunzhe]??"undefined",onChange:({target:{value:e}})=>O(Ye.ChineseWuSimplifiedYunzhe,e),children:[i.jsx("option",{value:"undefined",children:b("header.settings.previewAudio.notModified")}),C[Ye.ChineseWuSimplifiedYunzhe].map((e=>i.jsx("option",{value:e,children:e},e)))]})]})]})]}),i.jsxs(u,{width:"100%",mb:"3",children:[i.jsx(x,{fontSize:"md",children:b("header.settings.telemetry.title")}),i.jsxs(u,{mt:"3",children:[i.jsx(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:b("header.settings.telemetry.info")}),i.jsxs(u,{mt:"3",mb:"1",children:[i.jsxs(u,{display:"flex",mb:"1",children:[i.jsx(p,{flex:"1",children:b("header.settings.telemetry.essential")}),i.jsx(X,{label:b("header.settings.telemetry.essentialTooltip"),children:i.jsx(t,{isChecked:A,isDisabled:!0})})]}),i.jsx(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:b("header.settings.telemetry.essentialInfo")}),i.jsxs(S,{color:z,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[b("header.settings.telemetry.essentialLink")," ",i.jsx(T,{as:fe})]})]}),i.jsxs(u,{mt:"1",mb:"1",children:[i.jsxs(u,{display:"flex",children:[i.jsx(p,{flex:"1",children:b("header.settings.telemetry.additional")}),i.jsx(t,{isChecked:a,onChange:({target:{checked:e}})=>{w(ln(e))}})]}),i.jsx(p,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:b("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})};function Jn(){const{t:e}=gn();le();const s=ne.isAllowAnalytics(),[t,r]=jn.useState(!1),[o,l]=jn.useState(!1),d=n(ne.getEnv),h=n(ne.getAppVersion);return jn.useEffect((()=>{s&&d!==nn.DEV&&ne.event(Oe.APP_LOAD,{isStandaloneWindow:ne.isStandaloneWindow()})}),[d]),i.jsxs(dn,{children:[i.jsx(x,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rma")}),i.jsx(hn,{environment:d,version:h,popoverHeader:d===nn.PRD?void 0:i.jsxs(fn,{i18nKey:"header.popoverHeader",environment:d,children:["You're on ",{environment:d}," environment!"]}),popoverBody:d===nn.PRD?void 0:i.jsx(fn,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),i.jsxs(J,{ml:"auto",children:[i.jsx(K,{children:i.jsx(vn,{})}),i.jsx(K,{children:i.jsx(Fn,{})}),i.jsx(K,{children:i.jsx(Nn,{})}),i.jsx(K,{children:i.jsx(a,{size:"sm",variant:"ghost","aria-label":"Settings",icon:i.jsx(cn,{}),onClick:()=>r(!0)})}),ne.isStandaloneWindow()&&i.jsx(K,{children:i.jsxs(N,{children:[i.jsx(L,{as:a,icon:i.jsx(mn,{}),variant:"ghost",size:"sm"}),i.jsx(U,{children:["en","zh-Hans","zh-Hant","ja","ko"].map((e=>i.jsx(_,{onClick:()=>{return n=e,void ne.getI18nInstance().changeLanguage(n);var n},children:zn[e][e]},e)))})]})}),i.jsx(K,{children:i.jsx(a,{size:"sm",variant:"ghost","aria-label":"Help",icon:i.jsx(pn,{}),onClick:()=>l(!0)})})]}),i.jsx($n,{isOpen:t,onClose:()=>r(!1)}),i.jsx(yn,{isOpen:o,onClose:()=>l(!1)}),i.jsx(Bn,{})]})}function Kn(){const e=le(),n=oe((e=>e.runtime.globalAlerts));return i.jsx(i.Fragment,{children:Object.entries(n).map((([n,{message:s,url:t,linkedApp:a}])=>i.jsxs(q,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[i.jsx(Z,{}),a?i.jsx(S,{onClick:()=>(e=>{ne.isStandaloneWindow()?window.open(`/${e}`,"_blank"):ne.openApp({appId:e})})(a),children:s}):t?i.jsx(S,{href:t,target:"_blank",children:s}):s,i.jsx(Q,{ml:"auto",onClick:()=>e(un(n))})]},n)))})}}}}));
