import{j as e,h as be,am as rn,ak as K,M as q,al as Q,G as Z,H as N,J as ee,an as ln,K as x,B as we,ao as oe,ap as $,T as F,aq as _,b as V,N as L,ar as cn,as as I,Q as j,at as f,au as Se,av as Ae,a1 as ae,aw as Te,ax as R,ay as Ee,L as Re,az as dn,aA as Pe,aB as De,aC as Ie,aD as We,k as hn,W as ne,R as pn,U as un,aE as mn}from"./chakra-DHo0XYjR.js";import{u as gn,r as A,R as xn,a as jn,b as fn,c as bn,d as wn,e as zn,f as U,g as O,h as kn,A as Le,i as vn,n as Cn,j as Sn,k as An,M as w,l as Tn,m as Mn,o as Hn,p as On,q as yn,s as En,t as Rn,v as Pn,E as ie,w as Dn,x as In,S as H,V as b,y as E,z as Wn,B as ze,C as ke,D as ve,F as J,G as me,H as Ln,I as ge,J as Un,K as Bn,L as Gn,N as Fn,O as _n}from"./index-k1ejwZjr.js";import{a as Ce,m as P,d as z,T as Ue}from"./react-DFJlY5Ze.js";var Be=function(n){return gn(A.ready(),n)};function xe(n){var a=n.fields,r=n.noLabel,o=n.minW;return e.jsx(be,{wrap:"wrap",children:a.map(function(t,d){if(t.hidden)return e.jsx(Ce.Fragment,{},d);var h=t.minW||o,p=h==="full";return e.jsx(xn,{className:p?"mw-full":"",label:t.label,flex:p?void 0:1,minW:p?void 0:h,noLabel:r,oneLine:t.oneLine,helper:t.helper,errorMessage:t.errorMessage,children:function(s){switch(s.type){case"input":return e.jsx(zn,{placeholder:s.placeholder,defaultValue:s.value,type:s.variant,validator:s.validator,onDebouncedChange:s.onChange,delay:s.debouncedDelay,optionList:s.optionList,isDisabled:s.isDisabled});case"output":return e.jsx(wn,{noWrap:s.noWrap,children:s.value});case"textarea":return e.jsx(bn,{placeholder:s.placeholder,defaultValue:s.value,onDebouncedChange:s.onChange,isDisabled:s.isDisabled});case"slider":return e.jsx(fn,{defaultValue:s.value,min:s.min,max:s.max,step:s.step,onThrottledChange:s.onChange,leftIcon:s.leftIcon,rightIcon:s.rightIcon,isDisabled:s.isDisabled});case"select":return e.jsx(jn,{defaultValue:s.value,onChange:function(l){var c,i=l.target.value;return(c=s.onChange)===null||c===void 0?void 0:c.call(s,typeof s.value=="number"?Number(i):i.toString())},options:s.options,disabledOptions:s.disabledOptions,isInvalid:s.isInvalid,isDisabled:s.isDisabled});case"switch":return e.jsx(rn,{isChecked:s.isChecked,isDisabled:s.isDisabled,onChange:function(l){var c,i=l.target.checked;return(c=s.onChange)===null||c===void 0?void 0:c.call(s,i)}});case"custom":return s.component;default:return e.jsx("div",{})}}(t)},d)})})}var Vn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Yn=n=>{const{isOpen:a,onClose:r}=n,{t:o}=P(),t=A.getAppVersion();return e.jsxs(K,{isOpen:a,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:o("header.about.title")}),e.jsx(N,{}),e.jsxs(ee,{paddingBottom:10,children:[e.jsxs(be,{direction:"row",children:[e.jsx(ln,{boxSize:"128px",src:"/rma//logo192.png"}),e.jsxs(be,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(x,{fontSize:"xl",as:"b",children:o("header.about.rma")}),e.jsx(x,{children:t}),e.jsx(x,{}),e.jsx(x,{fontSize:"sm",children:o("header.about.railmapgen")})]})]}),e.jsx(we,{margin:5,children:e.jsx(x,{fontSize:"xl",children:o("header.about.desc")})}),e.jsx(oe,{as:"h5",size:"sm",mt:3,mb:2,children:o("header.about.contributors")}),e.jsx($,{children:e.jsxs(F,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(_,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(V,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(x,{fontSize:"sm",children:o("header.about.content1")}),e.jsx(x,{fontSize:"sm",align:"right",mb:1,children:o("header.about.content2")})]})]})}),e.jsx(oe,{as:"h5",size:"sm",mt:3,mb:2,children:o("header.about.contactUs")}),e.jsxs($,{children:[e.jsxs(F,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[e.jsx(_,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(V,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:o("header.about.github")}),e.jsx(x,{fontSize:"sm",children:o("header.about.githubContent")})]})]}),e.jsxs(F,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(_,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(V,{display:"block",width:"100%",children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:o("header.about.slack")}),e.jsx(x,{fontSize:"sm",children:o("header.about.slackContent")}),e.jsx(x,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(oe,{as:"h5",size:"sm",mt:3,mb:2,children:o("header.donation.title")}),e.jsxs($,{children:[e.jsxs(F,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(_,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(V,{display:"block",width:"100%",pb:1,children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:o("header.donation.afdian")}),e.jsx(x,{fontSize:"sm",children:o("header.donation.viaCNY")})]})]}),e.jsxs(F,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(_,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(V,{display:"block",width:"100%",pb:1,children:[e.jsx(x,{fontSize:"lg",fontWeight:"bold",mb:1,children:o("header.donation.openCollective")}),e.jsx(x,{fontSize:"sm",children:o("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function X(n){const a=n.sizes.shift(),r=Math.max(Math.ceil(a[0]),1),o=Math.max(Math.ceil(a[1]),1),t=[r-1,o-1,1,1],d=performance.now(),h=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let p,s;h?(p=new OffscreenCanvas(1,1),s=new OffscreenCanvas(r,o)):(p=document.createElement("canvas"),p.width=1,p.height=1,s=document.createElement("canvas"),s.width=r,s.height=o);const l=p.getContext("2d"),c=s.getContext("2d");c&&(c.fillRect.apply(c,t),l.drawImage(s,r-1,o-1,1,1,0,0,1,1));const i=l&&l.getImageData(0,0,1,1).data[3]!==0,u=parseInt(performance.now()-d);return[p,s].forEach(S=>{S.height=0,S.width=0}),h?(postMessage({width:r,height:o,testTime:u,isTestPass:i}),!i&&n.sizes.length&&setTimeout(()=>{X(n)},0)):i?n.onSuccess({width:r,height:o,testTime:u}):(n.onError({width:r,height:o,testTime:u}),n.sizes.length&&setTimeout(()=>{X(n)},0)),i}const je={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},W={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Y={};function fe(n){const a=n.width===n.height,r=n.height===1,o=n.width===1,t=[];if(!n.width||!n.height)n.sizes.forEach(d=>{const h=a||r?d:1,p=a||o?d:1;t.push([h,p])});else{const d=n.min||W.min,h=n.step||W.step;let p=Math.max(n.width,n.height);for(;p>=d;){const s=a||r?p:1,l=a||o?p:1;t.push([s,l]),p-=h}}return t}function se(n){const a=typeof window<"u",r=a&&"Promise"in window,o=a&&"HTMLCanvasElement"in window,t=a&&"OffscreenCanvas"in window,d=URL.createObjectURL(new Blob([])).slice(-36),h=performance.now(),{onError:p,onSuccess:s,...l}=n,c=()=>parseInt(performance.now()-h);let i=null;if(!o)return!1;if(n.useWorker&&t){const u="\n            var canvasTest = ".concat(X.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),S=new Blob([u],{type:"application/javascript"}),T=URL.createObjectURL(S);i=new Worker(T),URL.revokeObjectURL(T),i.onmessage=function(k){const{width:v,height:g,testTime:C,isTestPass:M}=k.data,D={width:v,height:g,testTime:C,totalTime:c()};M?(Y[d].onSuccess(D),delete Y[d]):Y[d].onError(D)}}if(r)return new Promise(u=>{const S={...n,onError(T){let{width:k,height:v,testTime:g}=T;const C={width:k,height:v,testTime:g,totalTime:c()};let M;if(n.sizes.length===0)M=!0;else{const[[D,B]]=n.sizes.slice(-1);M=k===D&&v===B}p(C),M&&u({...C,success:!1})},onSuccess(T){let{width:k,height:v,testTime:g}=T;const C={width:k,height:v,testTime:g,totalTime:c()};s(C),u({...C,success:!0})}};if(i){const{onError:T,onSuccess:k}=S;Y[d]={onError:T,onSuccess:k},i.postMessage(l)}else X(S)});if(i)Y[d]={onError:p,onSuccess:s},i.postMessage(l);else return X(n)}const Jn={maxArea(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=fe({width:n.max,height:n.max,min:n.min,step:n.step,sizes:[...je.area]}),r={...W,...n,sizes:a};return se(r)},maxHeight(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=fe({width:1,height:n.max,min:n.min,step:n.step,sizes:[...je.height]}),r={...W,...n,sizes:a};return se(r)},maxWidth(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=fe({width:n.max,height:1,min:n.min,step:n.step,sizes:[...je.width]}),r={...W,...n,sizes:a};return se(r)},test(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={...W,...n};return a.sizes=[...a.sizes],a.width&&a.height&&(a.sizes=[[a.width,a.height]]),se(a)}},Ge=(n,a,r)=>{const o=new Blob([r],{type:a});Me(n,o)},Me=(n,a)=>{const r=window.URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r)},$n=n=>{const{isOpen:a,onClose:r}=n,{t:o}=P(),t=U(),{tasks:d}=O(s=>s.audio),{rmtToken:h}=O(s=>s.runtime);z.useEffect(()=>{a&&t(kn())},[a]);const p=async s=>{const l=await Sn("".concat(An.AUDIOTASKS,"/").concat(s,"/download"),{},h);if(!l||!l.ok)throw new Error("文件下载失败");Me("".concat(s,".zip"),await l.blob())};return e.jsxs(K,{isOpen:a,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:o("header.audioTask.title")}),e.jsx(N,{}),e.jsx(ee,{paddingBottom:10,children:e.jsxs($,{spacing:4,align:"stretch",children:[e.jsx(x,{children:h?"Task List":"Please login first"}),d.map(s=>e.jsxs(we,{border:"1px",borderColor:"gray.300",p:4,borderRadius:"md",children:[e.jsxs(x,{children:["ID: ",s.id]}),e.jsxs(x,{children:["Status: ",s.status]}),e.jsxs(x,{children:["Created At: ",new Date(s.createdAt).toLocaleString()]}),e.jsxs(x,{children:["Updated At: ",new Date(s.updatedAt).toLocaleString()]}),s.status===Le.CREATED&&e.jsx(L,{colorScheme:"red",onClick:()=>t(vn(s.id)),children:"Cancel Task"}),s.status===Le.COMPLETED&&e.jsx(L,{colorScheme:"blue",onClick:()=>p(s.id),children:"Download Audio"})]},s.id)),h&&e.jsx(we,{p:4,border:"1px",borderColor:"gray.300",borderRadius:"md",children:e.jsx($,{spacing:4,children:e.jsx(L,{colorScheme:"blue",onClick:()=>t(Cn()),children:"Upload current project as a new task"})})})]})})]})]})},Xn=n=>{const{isOpen:a,onClose:r}=n,{t:o}=P();return e.jsxs(K,{isOpen:a,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:o("header.download.termsAndConditions")}),e.jsx(N,{}),e.jsx(ee,{children:e.jsxs(cn,{children:[e.jsxs(I,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(j,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(f,{as:w})]}),", ",e.jsxs(j,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(f,{as:w})]})," or ",e.jsxs(j,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(f,{as:w})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(j,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(f,{as:w})]}),"，",e.jsxs(j,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(f,{as:w})]}),"或",e.jsxs(j,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(f,{as:w})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(I,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(j,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(f,{as:w})]})," and ",e.jsxs(j,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(f,{as:w})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(j,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(f,{as:w})]}),"及",e.jsxs(j,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(f,{as:w})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(I,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(j,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(f,{as:w})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(j,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(f,{as:w})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(I,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(I,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(j,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(f,{as:w})]})," ","– the open-source emoji and icon project. License:",e.jsxs(j,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(f,{as:w})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(j,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(f,{as:w})]}),"所设计。许可证：",e.jsxs(j,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(f,{as:w})]})]}),e.jsxs(I,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},Kn=16,te=Kn*2,Fe=16;function qn(){const{telemetry:{project:n}}=O(m=>m.app),a=U(),{content:r,columns:o,viewableColumns:t}=O(m=>m.crawl),{project:d}=O(m=>m.param),{reconciledPhrases:h}=O(m=>m.runtime),{isModalOpen:p}=O(m=>m.audio),{style:s,metadata:l}=d,c=A.isAllowAnalytics(),{t:i}=P(),[u,S]=z.useState("png"),T={png:i("header.download.png"),svg:i("header.download.svg")},[k,v]=z.useState({width:1,height:1,benchmark:.001}),[g,C]=z.useState(200),M=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],D=Object.fromEntries(M.map(m=>[m,"".concat(m,"%")])),[B,Ye]=z.useState([]),[Je,$e]=z.useState(!1),Xe=[{type:"select",label:i("header.download.format"),value:u,options:T,onChange:m=>S(m==="png"?"png":"svg")}],Ke=[],qe=[{type:"select",label:i("header.download.scale"),value:g,options:D,disabledOptions:B,onChange:m=>C(m)},{type:"switch",label:i("header.download.transparent"),isChecked:Je,onChange:$e}],[re,He]=z.useState(!1),[Qe,Oe]=z.useState(!1),[Ze,Ne]=z.useState(!1),[ye,en]=z.useState(!1),[nn,le]=z.useState(!1);z.useEffect(()=>{(async()=>{const G=await Jn.maxArea({usePromise:!0,useWorker:!0});v(G)})()},[]),z.useEffect(()=>{if(re){const[m,G]=[t*te*g/100,Fe*te*g/100],ce=M.filter(y=>m*y/100>k.width&&G*y/100>k.height);Ye(ce)}},[re]);const sn=()=>{c&&A.event(ie.DOWNLOAD_PARAM,n?{style:s,"#stations":Object.keys(l).length}:{}),Ge("RMA_".concat(new Date().valueOf(),".json"),"application/json",JSON.stringify(d,null,2))},tn=()=>{c&&A.event(ie.DOWNLOAD_TEXT,n?{style:s,"#stations":Object.keys(l).length}:{});const m=Dn(h);Ge("RMA_".concat(new Date().valueOf(),".txt"),"text/plain",m.join("\n"))},on=()=>{const m=document.getElementById("crawl").cloneNode(!0),G=m.outerHTML;document.body.appendChild(m);const ce="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(G)));document.body.removeChild(m),m.remove();const y=document.createElement("canvas"),[de,he]=[t*te*g/100,Fe*te*g/100];y.width=de,y.height=he;const pe=y.getContext("2d");pe.fillStyle="black",pe.fillRect(0,0,de,he);const ue=new Image;ue.onload=()=>{setTimeout(()=>{pe.drawImage(ue,0,0,de,he),y.toBlob(an=>{Me("RMA_".concat(r,".png"),an)},"image/png")},0)},ue.src=ce};return e.jsxs(Se,{id:"download",children:[e.jsx(Ae,{as:ae,size:"sm",variant:"ghost",icon:e.jsx(Tn,{})}),e.jsxs(Te,{children:[e.jsx(R,{icon:e.jsx(Mn,{}),onClick:sn,children:i("header.download.config")}),e.jsx(R,{icon:e.jsx(Hn,{}),onClick:()=>He(!0),children:i("header.download.image")}),e.jsx(R,{icon:e.jsx(On,{}),onClick:()=>le(!0),children:i("header.download.audio")})]}),e.jsxs(K,{size:"xl",isOpen:re,onClose:()=>He(!1),children:[e.jsx(q,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:i("header.download.image")}),e.jsx(N,{}),e.jsxs(ee,{children:[e.jsx(xe,{fields:Xe}),u==="svg"&&e.jsx(xe,{fields:Ke}),u==="png"&&e.jsx(xe,{fields:qe}),u==="png"&&B.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(x,{as:"i",fontSize:"sm",children:i("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(x,{as:"i",fontSize:"sm",children:i("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(j,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(f,{as:w})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(Ee,{isChecked:Ze,onChange:m=>Ne(m.target.checked),children:e.jsxs(x,{children:[i("header.download.shareInfo1"),e.jsxs(j,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[i("header.about.rmp")," ",e.jsx(f,{as:w})]}),i("header.download.shareInfo2")]})}),e.jsx(Ee,{isChecked:ye,onChange:m=>en(m.target.checked),children:e.jsxs(x,{children:[i("header.download.termsAndConditionsInfo"),e.jsxs(j,{color:"teal.500",onClick:()=>Oe(!0),children:[i("header.download.termsAndConditions")," ",e.jsx(f,{as:w})]}),i("header.download.period")]})})]}),e.jsx(Re,{children:e.jsx(dn,{children:e.jsx(L,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!ye||u==="png"&&B.includes(g),onClick:on,children:i("header.download.confirm")})})}),e.jsx(Xn,{isOpen:Qe,onClose:()=>Oe(!1)})]})]}),e.jsxs(K,{size:"xl",isOpen:nn,onClose:()=>le(!1),children:[e.jsx(q,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:i("header.download.audio.title")}),e.jsx(N,{}),e.jsxs(ee,{children:[e.jsxs(Pe,{direction:{base:"column",sm:"row"},overflow:"hidden",variant:"outline",children:[e.jsx(f,{as:yn,boxSize:20,color:"blue.500",ml:"2.5",alignSelf:"center"}),e.jsxs(De,{children:[e.jsx(Ie,{children:i("header.download.audio.rawText")}),e.jsx(We,{children:e.jsx(L,{variant:"solid",colorScheme:"blue",onClick:tn,children:i("header.download.audio.rawTextExport")})})]})]}),e.jsxs(Pe,{direction:{base:"column",sm:"row"},overflow:"hidden",variant:"outline",children:[e.jsx(f,{as:En,boxSize:20,color:"blue.500",ml:"2.5",alignSelf:"center"}),e.jsxs(De,{children:[e.jsx(Ie,{children:i("header.download.audio.server")}),e.jsx(We,{children:e.jsx(L,{variant:"solid",colorScheme:"blue",onClick:()=>{le(!1),a(Rn())},children:i("header.download.audio.serverExport")})})]})]})]}),e.jsx(Re,{})]})]}),e.jsx($n,{isOpen:p,onClose:()=>a(Pn())})]})}const Qn=(n,a,r="left",o="left",t,d=!0,h=!1,p="none",s=!1)=>({[H.Arrival]:{[b.ChineseWuSimplifiedXiaotong]:{terminal:n.zh,terminalPinyin:n.zh,doorDirection:r,thanksForTaking:t==null?void 0:t.at(0),thanksForTakingPinyin:t==null?void 0:t.at(0)},[b.ChineseMandarinSimplified]:{terminal:n.zh,terminalPinyin:n.zh,doorDirection:r,thanksForTaking:t==null?void 0:t.at(0),thanksForTakingPinyin:t==null?void 0:t.at(0)},[b.ChineseWuSimplifiedYunzhe]:{terminal:n.en,terminalPinyin:n.zh,doorDirection:r,thanksForTaking:t==null?void 0:t.at(1),thanksForTakingPinyin:t==null?void 0:t.at(1)}},[H.Departure]:{[b.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:t==null?void 0:t.at(0),welcomeAbroadPinyin:t==null?void 0:t.at(0),terminal:n.zh,terminalPinyin:n.zh,nextDoorDirection:o,lineName:a[0],lineNamePinyin:a[0],noteLastTrain:d,loop:p,loopTerminal:s},[b.ChineseMandarinSimplified]:{welcomeAbroad:t==null?void 0:t.at(0),welcomeAbroadPinyin:t==null?void 0:t.at(0),terminal:n.zh,terminalPinyin:n.zh,nextDoorDirection:o,lineName:a[0],lineNamePinyin:a[0],noteLastTrain:d,loop:p,loopTerminal:s},[b.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:t==null?void 0:t.at(1),welcomeAbroadPinyin:t==null?void 0:t.at(0),terminal:n.en,terminalPinyin:n.en,nextDoorDirection:o,lineName:a[1],lineNamePinyin:a[1]}},[H.Midway]:{[b.ChineseWuSimplifiedXiaotong]:{caution:h},[b.ChineseMandarinSimplified]:{caution:h},[b.ChineseWuSimplifiedYunzhe]:{}}}),Ve=n=>{var c;const a=structuredClone(In),{line_name:r,stn_list:o,loop:t}=n,d="left",h="left";let p="",s="linestart";for(;s!=="lineend";){const i=o[s].children[0];if(i==="lineend"){p=s;break}s=i}if(p==="")throw new Error("Invalid RMG save!");const{localisedName:l}=o[p];for(a.baseVariants=Qn(l,r,d,h,void 0,void 0,void 0,t?"inner":"none",!1),s=o.linestart.children[0];s!=="lineend";){const{localisedName:i}=o[s];a.metadata[s]={name:(c=Object.values(i).at(0))!=null?c:""},a.stations[s]={},a.stations[s][H.Midway]={[b.ChineseWuSimplifiedXiaotong]:{},[b.ChineseMandarinSimplified]:{},[b.ChineseWuSimplifiedYunzhe]:{}},o[s].parents[0]!=="linestart"&&(a.stations[s][H.Arrival]={[b.ChineseWuSimplifiedXiaotong]:{name:i.zh,namePinyin:i.zh},[b.ChineseMandarinSimplified]:{name:i.zh,namePinyin:i.zh},[b.ChineseWuSimplifiedYunzhe]:{name:i.en,namePinyin:i.en}});const S=o[s].children[0];if(S!=="lineend"||t){const T=t&&S==="lineend"?o.linestart.children[0]:S,{localisedName:k}=o[T],v=o[T].transfer.groups.map(g=>{var C;return(C=g.lines)==null?void 0:C.map(M=>M.name)}).filter(g=>g!==void 0);a.stations[s][H.Departure]={[b.ChineseWuSimplifiedXiaotong]:{next:k.zh,nextPinyin:k.zh,int:v==null?void 0:v.map(g=>g==null?void 0:g.map(C=>C[0]))},[b.ChineseMandarinSimplified]:{next:k.zh,nextPinyin:k.zh,int:v==null?void 0:v.map(g=>g==null?void 0:g.map(C=>C[0]))},[b.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:!1,next:k.en,nextPinyin:k.en,int:v==null?void 0:v.map(g=>g==null?void 0:g.map(C=>C[1])),noteLastTrain:!1}}}s=S}if(t){const i=o.linestart.children[0],{localisedName:u}=o[i];a.stations[i][H.Arrival]={[b.ChineseWuSimplifiedXiaotong]:{name:u.zh,namePinyin:u.zh,doorDirection:d},[b.ChineseMandarinSimplified]:{name:u.zh,namePinyin:u.zh,doorDirection:d},[b.ChineseWuSimplifiedYunzhe]:{name:u.en,namePinyin:u.en,doorDirection:d}}}return a},Zn="rmg-bridge--",Nn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function es(n){const{isOpen:a,onClose:r}=n,{t:o}=P(),t=U(),d=A.isAllowAnalytics(),[h]=Ce.useState(crypto.randomUUID()),p="/rmg/#/import?"+new URLSearchParams({parentComponent:A.getAppName(),parentId:h}),s=l=>{try{d&&A.event(ie.IMPORT_RMG_PARAM);const c=Ve(l);t(ze(c)),t(ke(Object.keys(c.metadata)[0])),t(ve(H.Departure))}catch(c){t(J({status:"error",message:o("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",c)}finally{r()}};return Ce.useEffect(()=>{const l=new BroadcastChannel(Zn+h);return l.onmessage=c=>{const{event:i,data:u}=c.data;E.info("Received event from RMG app clip:",i),i==="CLOSE"?r():i==="IMPORT"&&s(u)},()=>l.close()},[]),e.jsx(Wn,{isOpen:a,onClose:r,sx:Nn,children:e.jsx("iframe",{src:p,loading:"lazy"})})}function ns(){const n=U(),{t:a}=P(),r=z.useRef(null),o=z.useRef(null),[t,d]=z.useState(!1),h=l=>{const c=JSON.parse(l);n(ze(c)),n(ke(Object.keys(c.metadata)[0])),n(ve(H.Departure))},p=async l=>{var i;const c=(i=l.target.files)==null?void 0:i[0];if(E.info("OpenActions.handleUpload():: received file",c),(c==null?void 0:c.type)!=="application/json")n(J({status:"error",message:a("header.open.invalidType")})),E.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const u=await _e(c);h(u)}catch(u){n(J({status:"error",message:a("header.open.unknownError")})),E.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",u)}l.target.value=""},s=async l=>{var i;const c=(i=l.target.files)==null?void 0:i[0];if(E.info("OpenActions.handleUpload():: received file",c),(c==null?void 0:c.type)!=="application/json")n(J({status:"error",message:a("header.open.invalidType")})),E.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const u=await _e(c),S=Ve(JSON.parse(u));n(ze(S)),n(ke(Object.keys(S.metadata)[0])),n(ve(H.Departure))}catch(u){n(J({status:"error",message:a("header.open.unknownError")})),E.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",u)}l.target.value=""};return e.jsxs(Se,{children:[e.jsx(Ae,{as:ae,size:"sm",variant:"ghost",icon:e.jsx(me,{})}),e.jsxs(Te,{children:[e.jsx("input",{id:"upload_project",ref:r,type:"file",accept:".json",hidden:!0,onChange:p,"data-testid":"file-upload"}),e.jsx(R,{icon:e.jsx(me,{}),onClick:()=>{var l;return(l=r==null?void 0:r.current)==null?void 0:l.click()},children:a("header.open.config")}),e.jsx("input",{id:"upload_RMG",ref:o,type:"file",accept:".json",hidden:!0,onChange:s,"data-testid":"file-upload"}),e.jsx(R,{icon:e.jsx(me,{}),onClick:()=>{var l;return(l=o==null?void 0:o.current)==null?void 0:l.click()},children:a("header.open.RMG")}),e.jsx(R,{icon:e.jsx(Ln,{}),onClick:()=>d(!0),children:a("header.open.projectRMG")})]}),e.jsx(es,{isOpen:t,onClose:()=>d(!1)})]})}const _e=n=>new Promise(a=>{const r=new FileReader;r.onloadend=()=>a(r.result),r.readAsText(n)});function ss(){const{t:n}=P();U();const a=A.isAllowAnalytics(),[r,o]=z.useState(!1),[t,d]=z.useState(!1),h=Be(A.getEnv),p=Be(A.getAppVersion);z.useEffect(()=>{a&&h!==ge.DEV&&A.event(ie.APP_LOAD,{isStandaloneWindow:A.isStandaloneWindow()})},[h]);const s=l=>{A.getI18nInstance().changeLanguage(l)};return e.jsxs(Un,{children:[e.jsx(oe,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:n("header.about.rma")}),e.jsx(Bn,{environment:h,version:p,popoverHeader:h===ge.PRD?void 0:e.jsxs(Ue,{i18nKey:"header.popoverHeader",environment:h,children:["You're on ",{environment:h}," environment!"]}),popoverBody:h===ge.PRD?void 0:e.jsx(Ue,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(hn,{ml:"auto",children:[e.jsx(ne,{children:e.jsx(ns,{})}),e.jsx(ne,{children:e.jsx(qn,{})}),A.isStandaloneWindow()&&e.jsx(ne,{children:e.jsxs(Se,{children:[e.jsx(Ae,{as:ae,icon:e.jsx(Gn,{}),variant:"ghost",size:"sm"}),e.jsx(Te,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(l=>e.jsx(R,{onClick:()=>s(l),children:Vn[l][l]},l))})]})}),e.jsx(ne,{children:e.jsx(ae,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(Fn,{}),onClick:()=>d(!0)})})]}),e.jsx(Yn,{isOpen:t,onClose:()=>d(!1)})]})}function ts(){const n=U(),a=O(o=>o.runtime.globalAlerts),r=o=>{A.isStandaloneWindow()?window.open("/".concat(o),"_blank"):A.openApp({appId:o})};return e.jsx(e.Fragment,{children:Object.entries(a).map(([o,{message:t,url:d,linkedApp:h}])=>e.jsxs(pn,{status:o,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(un,{}),h?e.jsx(j,{onClick:()=>r(h),children:t}):d?e.jsx(j,{href:d,target:"_blank",children:t}):t,e.jsx(mn,{ml:"auto",onClick:()=>n(_n(o))})]},o))})}function rs(){return e.jsxs(e.Fragment,{children:[e.jsx(ss,{}),e.jsx(ts,{})]})}export{rs as default};
