import{j as e,h as he,aq as Ie,a1 as X,ak as $,M as J,al as K,G as q,H as Z,J as Q,ar as vn,K as j,B as L,an as _,am as se,T as me,as as xe,b as ge,L as ve,N as ue,at as Cn,O as Ge,au as Tn,ap as ne,Q as A,av as H,aw as yn,q as An,ad as Mn,ae as On,af as Hn,ag as Ze,ah as ae,ai as Pn,aj as oe,ao as Dn,ax as Fe,ay as Ve,az as _e,aA as te,aB as Rn,aC as We,aD as Qe,aE as Ne,a0 as en,aF as En,aG as In,k as Wn,W as re,R as Ln,U as Un,aH as Bn}from"./chakra-BiadmNKO.js";import{u as Gn,r as D,R as hn,a as Fn,b as un,c as Vn,d as _n,e as E,f as G,g as pn,v as fe,M as Yn,h as Xn,i as $n,s as Y,p as Jn,l as F,n as Kn,j as P,k as qn,m as Zn,o as Qn,q as Nn,A as nn,t as es,w as ns,x as ss,y as ts,z as is,E as Ce,B as as,C as os,D as rs,F as ls,G as cs,H as ds,I as hs,J as ze,K as sn,L as us,S as ce,N as ps,O as ms,P as O,V as x,Q as tn,T as an,U as on,W as rn,X as mn,Y as xn,Z as gn,_ as xs,$ as jn,a0 as Pe,a1 as Se,a2 as gs,a3 as ln,a4 as js,a5 as fs,a6 as bs,a7 as ws,a8 as zs,a9 as ks,aa as Ss,ab as vs,ac as Cs,ad as Ts}from"./index-Bqv_Vokh.js";import{a as Le,m as B,d as C,T as cn}from"./react-DFJlY5Ze.js";import{R as ys}from"./rmg-output-B97GirQX.js";var Ue=function(s){return Gn(D.ready(),s)};function De(s){var i=s.fields,o=s.noLabel,n=s.minW;return e.jsx(he,{wrap:"wrap",children:i.map(function(a,c){if(a.hidden)return e.jsx(Le.Fragment,{},c);var d=a.minW||n,u=d==="full";return e.jsx(hn,{className:u?"mw-full":"",label:a.label,flex:u?void 0:1,minW:u?void 0:d,noLabel:o,oneLine:a.oneLine,helper:a.helper,errorMessage:a.errorMessage,children:function(t){switch(t.type){case"input":return e.jsx(_n,{placeholder:t.placeholder,defaultValue:t.value,type:t.variant,validator:t.validator,onDebouncedChange:t.onChange,delay:t.debouncedDelay,optionList:t.optionList,isDisabled:t.isDisabled});case"output":return e.jsx(ys,{noWrap:t.noWrap,children:t.value});case"textarea":return e.jsx(Vn,{placeholder:t.placeholder,defaultValue:t.value,onDebouncedChange:t.onChange,isDisabled:t.isDisabled});case"slider":return e.jsx(un,{defaultValue:t.value,min:t.min,max:t.max,step:t.step,onThrottledChange:t.onChange,leftIcon:t.leftIcon,rightIcon:t.rightIcon,isDisabled:t.isDisabled});case"select":return e.jsx(Fn,{defaultValue:t.value,onChange:function(m){var f,r=m.target.value;return(f=t.onChange)===null||f===void 0?void 0:f.call(t,typeof t.value=="number"?Number(r):r.toString())},options:t.options,disabledOptions:t.disabledOptions,isInvalid:t.isInvalid,isDisabled:t.isDisabled});case"switch":return e.jsx(Ie,{isChecked:t.isChecked,isDisabled:t.isDisabled,onChange:function(m){var f,r=m.target.checked;return(f=t.onChange)===null||f===void 0?void 0:f.call(t,r)}});case"custom":return t.component;default:return e.jsx("div",{})}}(a)},c)})})}var As={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Ms=()=>{const s=navigator.platform.toLowerCase();return s.includes("win")?"win":s.includes("android")?"android":s.includes("mac")?"mac":s.includes("iphone")||s.includes("ipad")?"ios":s.includes("linux")?"linux":"unknown"},Os=Ms();function Hs(){const{reconciledPhrases:s,currentStyle:i,currentStationID:o,currentStage:n,currentVoice:a}=E(b=>b.runtime),{preference:{previewAudio:c}}=E(b=>b.app),d=G(),{t:u}=B(),[t,m]=C.useState(!1),[f,r]=C.useState(!1),l=pn();C.useEffect(()=>{var M,z;const b=(z=(M=fe[i])==null?void 0:M.defaultLang)==null?void 0:z[a],T=l.find(p=>p.lang===b);r(!!T)},[a,l]);const w=()=>{var V,U,I,k,R,W,N,pe,Te;d(Y({status:"info",message:u("header.paly.previewWarning")}));const b=window.speechSynthesis;if(b.paused&&b.speaking){m(!0),b.resume();return}const T=(U=(V=s[o])==null?void 0:V[n])==null?void 0:U[a],M=Jn(T!=null?T:[]),z=M===""?" ":M,p=new SpeechSynthesisUtterance(z),g=(W=c[a])!=null?W:(R=(k=(I=fe[i])==null?void 0:I.preferredPreviewVoiceName)==null?void 0:k[a])==null?void 0:R[Os],h=b.getVoices().find(Xe=>Xe.name===g),y=(pe=(N=fe[i])==null?void 0:N.defaultLang)==null?void 0:pe[a];if(h)p.voice=h;else if(y)p.lang=y;else{F.error("Preview language not found for",a);return}p.onend=()=>{m(!1)},m(!0),F.debug('Previewing audio "'.concat(z,'" with ').concat((Te=p.voice)==null?void 0:Te.name)),b.speak(p)},S=()=>{window.speechSynthesis.pause(),m(!1)};return e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Settings",icon:f?t?e.jsx(Yn,{}):e.jsx(Xn,{}):e.jsx($n,{}),isDisabled:!f,onClick:t?S:w})}const Ps=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B(),a=D.getAppVersion();return e.jsxs($,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:n("header.about.title")}),e.jsx(Z,{}),e.jsxs(Q,{paddingBottom:10,children:[e.jsxs(he,{direction:"row",children:[e.jsx(vn,{boxSize:"128px",src:"/rma//logo192.png"}),e.jsxs(he,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(j,{fontSize:"xl",as:"b",children:n("header.about.rma")}),e.jsx(j,{children:a}),e.jsx(j,{}),e.jsx(j,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(L,{margin:5,children:e.jsx(j,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(_,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx(se,{children:e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(j,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(j,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]})}),e.jsx(_,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs(se,{children:[e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rma/issues","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(j,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(j,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(j,{fontSize:"sm",as:"i",children:"#rma, #rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(_,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),e.jsxs(se,{children:[e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",pb:1,children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),e.jsx(j,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),e.jsxs(me,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(xe,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ge,{display:"block",width:"100%",pb:1,children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),e.jsx(j,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function be(s){const i=s.sizes.shift(),o=Math.max(Math.ceil(i[0]),1),n=Math.max(Math.ceil(i[1]),1),a=[o-1,n-1,1,1],c=performance.now(),d=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let u,t;d?(u=new OffscreenCanvas(1,1),t=new OffscreenCanvas(o,n)):(u=document.createElement("canvas"),u.width=1,u.height=1,t=document.createElement("canvas"),t.width=o,t.height=n);const m=u.getContext("2d"),f=t.getContext("2d");f&&(f.fillRect.apply(f,a),m.drawImage(t,o-1,n-1,1,1,0,0,1,1));const r=m&&m.getImageData(0,0,1,1).data[3]!==0,l=parseInt(performance.now()-c);return[u,t].forEach(w=>{w.height=0,w.width=0}),d?(postMessage({width:o,height:n,testTime:l,isTestPass:r}),!r&&s.sizes.length&&setTimeout(()=>{be(s)},0)):r?s.onSuccess({width:o,height:n,testTime:l}):(s.onError({width:o,height:n,testTime:l}),s.sizes.length&&setTimeout(()=>{be(s)},0)),r}const Re={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},de={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},je={};function Ee(s){const i=s.width===s.height,o=s.height===1,n=s.width===1,a=[];if(!s.width||!s.height)s.sizes.forEach(c=>{const d=i||o?c:1,u=i||n?c:1;a.push([d,u])});else{const c=s.min||de.min,d=s.step||de.step;let u=Math.max(s.width,s.height);for(;u>=c;){const t=i||o?u:1,m=i||n?u:1;a.push([t,m]),u-=d}}return a}function ke(s){const i=typeof window<"u",o=i&&"Promise"in window,n=i&&"HTMLCanvasElement"in window,a=i&&"OffscreenCanvas"in window,c=URL.createObjectURL(new Blob([])).slice(-36),d=performance.now(),{onError:u,onSuccess:t,...m}=s,f=()=>parseInt(performance.now()-d);let r=null;if(!n)return!1;if(s.useWorker&&a){const l="\n            var canvasTest = ".concat(be.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),w=new Blob([l],{type:"application/javascript"}),S=URL.createObjectURL(w);r=new Worker(S),URL.revokeObjectURL(S),r.onmessage=function(b){const{width:T,height:M,testTime:z,isTestPass:p}=b.data,g={width:T,height:M,testTime:z,totalTime:f()};p?(je[c].onSuccess(g),delete je[c]):je[c].onError(g)}}if(o)return new Promise(l=>{const w={...s,onError(S){let{width:b,height:T,testTime:M}=S;const z={width:b,height:T,testTime:M,totalTime:f()};let p;if(s.sizes.length===0)p=!0;else{const[[g,h]]=s.sizes.slice(-1);p=b===g&&T===h}u(z),p&&l({...z,success:!1})},onSuccess(S){let{width:b,height:T,testTime:M}=S;const z={width:b,height:T,testTime:M,totalTime:f()};t(z),l({...z,success:!0})}};if(r){const{onError:S,onSuccess:b}=w;je[c]={onError:S,onSuccess:b},r.postMessage(m)}else be(w)});if(r)je[c]={onError:u,onSuccess:t},r.postMessage(m);else return be(s)}const Ds={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=Ee({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...Re.area]}),o={...de,...s,sizes:i};return ke(o)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=Ee({width:1,height:s.max,min:s.min,step:s.step,sizes:[...Re.height]}),o={...de,...s,sizes:i};return ke(o)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=Ee({width:s.max,height:1,min:s.min,step:s.step,sizes:[...Re.width]}),o={...de,...s,sizes:i};return ke(o)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={...de,...s};return i.sizes=[...i.sizes],i.width&&i.height&&(i.sizes=[[i.width,i.height]]),ke(i)}},Be=(s,i,o)=>{const n=new Blob([o],{type:i});Ye(s,n)},Ye=(s,i)=>{const o=window.URL.createObjectURL(i),n=document.createElement("a");n.href=o,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)},Rs=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B(),a=G(),{reconciledPhrases:c}=E(t=>t.runtime),{points:d}=E(t=>t.audio),u=Object.keys(c).length*100;return e.jsxs($,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:n("header.audioTask.new.title")}),e.jsx(Z,{}),e.jsxs(Q,{paddingBottom:10,children:[e.jsx(j,{children:n("header.audioTask.new.content1")}),e.jsxs(j,{children:[n("header.audioTask.new.content2"),u]}),e.jsx(j,{children:n("header.audioTask.new.content3")}),e.jsx(j,{children:n("header.audioTask.new.content4")})]}),e.jsx(ve,{children:e.jsx(ue,{style:{alignSelf:"center"},onClick:()=>a(Kn()),isDisabled:d<u,children:n("header.audioTask.new.create")})})]})]})},Es=s=>{Cn();const{t:i}=B(),{isOpen:o,onClose:n}=s,a=G(),c=Ge("primary.500","primary.300"),[d,u]=C.useState("");return e.jsxs($,{isOpen:o,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:i("header.audioTask.redeem.title")}),e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(j,{mb:"4",children:i("header.audioTask.redeem.desc")}),e.jsx(Tn,{children:e.jsx(ne,{children:e.jsxs(A,{color:c,href:"https://afdian.com/item/851c2bb4110d11f0935a5254001e7c00",isExternal:!0,children:["爱发电 ",e.jsx(H,{as:P})]})})}),e.jsxs(yn,{mt:"5",direction:{base:"column",sm:"row"},children:[e.jsx(j,{mr:"auto",children:i("header.audioTask.redeem.input")}),e.jsx(An,{w:"200px",value:d,onChange:t=>u(t.target.value)}),e.jsx(ue,{colorScheme:"teal",onClick:()=>a(qn(d.trim())),children:i("header.audioTask.redeem.redeem")})]})]}),e.jsx(ve,{})]})]})},Is=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B(),a=G(),{telemetry:{project:c}}=E(h=>h.app),{tasks:d,points:u}=E(h=>h.audio),{rmtToken:t,reconciledPhrases:m}=E(h=>h.runtime),{project:f}=E(h=>h.param),{style:r,metadata:l}=f,w=D.isAllowAnalytics(),S=Ge("primary.500","primary.300"),[b,T]=C.useState(!1),[M,z]=C.useState(!1);C.useEffect(()=>{i&&a(Zn())},[i]);const p=async h=>{const y=await ts("".concat(is.AUDIOTASKS,"/").concat(h,"/download"),{},t);if(!y||!y.ok)throw new Error("Download error");Ye("".concat(h,".zip"),await y.blob())},g=()=>{w&&D.event(Ce.DOWNLOAD_TEXT,c?{style:r,"#stations":Object.keys(l).length}:{});const h=as(m);Be("RMA_".concat(new Date().valueOf(),".txt"),"text/plain",h.join("\n"))};return e.jsxs($,{isOpen:i,onClose:o,size:"4xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:n("header.download.audio")}),e.jsx(Z,{}),e.jsxs(Q,{paddingBottom:10,children:[e.jsx(j,{fontSize:"lg",mb:"4",children:n("header.audioTask.desc")}),e.jsx(j,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleZH")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-zh.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),e.jsx(j,{fontSize:"md",mt:"4",color:"gray.600",children:n("header.audioTask.exampleEN")}),e.jsxs("audio",{controls:!0,children:[e.jsx("source",{src:"audio/shmetro-en.mp3",type:"audio/mpeg"}),n("header.audioTask.audioNotSupported")]}),t?e.jsxs(e.Fragment,{children:[e.jsxs(he,{pl:"4",pr:"4",mt:"10",mb:"4",children:[e.jsx(j,{as:"b",fontSize:"4xl",children:u}),e.jsx(j,{style:{alignSelf:"self-end",marginLeft:"10px"},children:"pts"}),e.jsx(he,{style:{flex:1}}),e.jsx(j,{as:"b",style:{alignSelf:"self-end"},children:n("header.audioTask.title")}),e.jsx(he,{style:{flex:1}}),e.jsx(ue,{leftIcon:e.jsx(Qn,{}),style:{alignSelf:"center"},onClick:()=>z(!0),mr:"2",children:n("header.audioTask.topUp")}),e.jsx(Es,{isOpen:M,onClose:()=>z(!1)}),e.jsx(ue,{leftIcon:e.jsx(Nn,{}),style:{alignSelf:"center"},onClick:()=>T(!0),children:n("header.audioTask.new.title")}),e.jsx(Rs,{isOpen:b,onClose:()=>T(!1)})]}),e.jsx(Mn,{height:"100%",overflowY:"auto",children:e.jsxs(On,{variant:"simple",height:"100%",children:[e.jsx(Hn,{children:e.jsxs(Ze,{children:[e.jsx(ae,{children:n("header.audioTask.table.id")}),e.jsx(ae,{children:n("header.audioTask.table.status")}),e.jsx(ae,{children:n("header.audioTask.table.createdAt")}),e.jsx(ae,{children:n("header.audioTask.table.updatedAt")}),e.jsx(ae,{children:n("header.audioTask.table.points")}),e.jsx(ae,{children:n("header.audioTask.table.actions")})]})}),e.jsx(Pn,{children:d.map(({id:h,status:y,createdAt:V,updatedAt:U,points:I})=>e.jsxs(Ze,{children:[e.jsx(oe,{children:h}),e.jsx(oe,{children:y}),e.jsx(oe,{children:new Date(V).toLocaleString()}),e.jsx(oe,{children:new Date(U).toLocaleString()}),e.jsx(oe,{children:I}),e.jsxs(oe,{children:[y===nn.CREATED&&e.jsx(X,{icon:e.jsx(ns,{}),"aria-label":n("Cancel Task"),onClick:()=>a(es(h))}),y===nn.COMPLETED&&e.jsx(X,{icon:e.jsx(ss,{}),"aria-label":n("Download Audio"),onClick:()=>p(h)})]})]},h))})]})})]}):e.jsx(j,{mt:"10",textAlign:"center",children:n("header.audioTask.loginFirst")}),e.jsx(se,{mt:10,children:e.jsxs(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:[n("header.audioTask.freeInternet1"),e.jsx(A,{color:S,fontSize:"sm",lineHeight:"100%",onClick:g,children:n("header.audioTask.freeInternet2")}),n("header.audioTask.freeInternet3")]})})]})]})]})},Ws=s=>{const{isOpen:i,onClose:o}=s,{t:n}=B();return e.jsxs($,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:n("header.download.termsAndConditions")}),e.jsx(Z,{}),e.jsx(Q,{children:e.jsxs(Dn,{children:[e.jsxs(ne,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(A,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(H,{as:P})]}),", ",e.jsxs(A,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(H,{as:P})]})," or ",e.jsxs(A,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(H,{as:P})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(A,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(H,{as:P})]}),"，",e.jsxs(A,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(H,{as:P})]}),"或",e.jsxs(A,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(H,{as:P})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(ne,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:P})]})," and ",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:P})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:P})]}),"及",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:P})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(ne,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(A,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(H,{as:P})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(A,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(H,{as:P})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(ne,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(ne,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(A,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:P})]})," ","– the open-source emoji and icon project. License:",e.jsxs(A,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:P})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(A,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:P})]}),"所设计。许可证：",e.jsxs(A,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:P})]})]}),e.jsxs(ne,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Ls(){const{telemetry:{project:s}}=E(v=>v.app),i=G(),{realColumns:o}=E(v=>v.crawl),{project:n}=E(v=>v.param),{reconciledPhrases:a,currentStationID:c,currentStage:d,currentVoice:u}=E(v=>v.runtime),{isModalOpen:t}=E(v=>v.audio),{style:m,metadata:f}=n,r=D.isAllowAnalytics(),{t:l}=B(),[w,S]=C.useState("png"),b={png:l("header.download.png"),svg:l("header.download.svg")},[T,M]=C.useState({width:1,height:1,benchmark:.001}),[z,p]=C.useState(200),g=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],h=Object.fromEntries(g.map(v=>[v,"".concat(v,"%")])),[y,V]=C.useState([]),U=[{type:"select",label:l("header.download.format"),value:w,options:b,onChange:v=>S(v==="png"?"png":"svg")}],I=[],k=[{type:"select",label:l("header.download.scale"),value:z,options:h,disabledOptions:y,onChange:v=>p(v)}],[R,W]=C.useState(!1),[N,pe]=C.useState(!1),[Te,Xe]=C.useState(!1),[$e,bn]=C.useState(!1);C.useEffect(()=>{(async()=>{const ie=await Ds.maxArea({usePromise:!0,useWorker:!0});M(ie)})()},[]),C.useEffect(()=>{if(R){const[v,ie]=[o*ze*z/100,sn*ze*z/100],ye=g.filter(ee=>v*ee/100>T.width||ie*ee/100>T.height);V(ye)}},[R]);const wn=()=>{r&&D.event(Ce.DOWNLOAD_PARAM,s?{style:m,"#stations":Object.keys(f).length}:{}),Be("RMA_".concat(new Date().valueOf(),".json"),"application/json",JSON.stringify(n,null,2))},zn=()=>{var Ke,qe;const v=(qe=(Ke=a[c])==null?void 0:Ke[d])==null?void 0:qe[u],ie=us(v!=null?v:[]),ye=ie===""?" ":ie,ee=document.getElementById("crawl").cloneNode(!0),Je=ee.outerHTML;if(w==="svg"){Be("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Je);return}document.body.appendChild(ee);const kn="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Je)));document.body.removeChild(ee),ee.remove();const we=document.createElement("canvas"),[Ae,Me]=[o*ze*z/100,sn*ze*z/100];we.width=Ae,we.height=Me;const Oe=we.getContext("2d");Oe.fillStyle="black",Oe.fillRect(0,0,Ae,Me);const He=new Image;He.onload=()=>{setTimeout(()=>{Oe.drawImage(He,0,0,Ae,Me),we.toBlob(Sn=>{Ye("RMA_".concat(ye,".png"),Sn)},"image/png")},0)},He.src=kn};return e.jsxs(Fe,{id:"download",children:[e.jsx(Ve,{as:X,size:"sm",variant:"ghost",icon:e.jsx(os,{})}),e.jsxs(_e,{children:[e.jsx(te,{icon:e.jsx(rs,{}),onClick:wn,children:l("header.download.config")}),e.jsx(te,{icon:e.jsx(ls,{}),onClick:()=>W(!0),children:l("header.download.image")}),e.jsx(te,{icon:e.jsx(ds,{}),onClick:()=>i(cs()),children:l("header.download.audio")})]}),e.jsxs($,{size:"xl",isOpen:R,onClose:()=>W(!1),children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:l("header.download.image")}),e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(De,{fields:U}),w==="svg"&&e.jsx(De,{fields:I}),w==="png"&&e.jsx(De,{fields:k}),w==="png"&&y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(j,{as:"i",fontSize:"sm",children:l("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(j,{as:"i",fontSize:"sm",children:l("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(A,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(H,{as:P})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(Rn,{isChecked:$e,onChange:v=>bn(v.target.checked),children:e.jsxs(j,{children:[l("header.download.termsAndConditionsInfo"),e.jsxs(A,{color:"teal.500",onClick:()=>pe(!0),children:[l("header.download.termsAndConditions")," ",e.jsx(H,{as:P})]}),l("header.download.period")]})})]}),e.jsx(ve,{children:e.jsx(We,{children:e.jsx(ue,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!$e||w==="png"&&y.includes(z),onClick:zn,children:l("header.download.confirm")})})}),e.jsx(Ws,{isOpen:N,onClose:()=>pe(!1)})]})]}),e.jsx(Is,{isOpen:t,onClose:()=>i(hs())})]})}const fn=s=>{var a,c,d,u;const i=["linestart"],o=[["linestart"]];let n=0;for(;i.length;){let t=i.shift(),m=o[n].slice(-1)[0]||null;for(m&&t!=="linestart"?o[n].push(t):o[n]=[t];t!=="lineend";){m=t;const f=s[m].children;switch(f.length){case 1:t=f[0];break;case 2:{const r=s[m].branch.right,l=r[1];r[0]==="through"?(o.push(o[n].slice()),i.push(l)):n===0&&(o.push([m]),i.push(l)),t=f.filter(w=>w!==l)[0];break}}if(o[n].push(t),m===((c=(a=s[t].branch)==null?void 0:a.left)==null?void 0:c[1])&&((u=(d=s[t].branch)==null?void 0:d.left)==null?void 0:u[0])==="nonthrough")break}n++}return o},Us=(s,i,o="left",n="left",a,c=!0,d=!1,u="none",t=!1,m=ce.local)=>({[O.Arrival]:{[x.ChineseWuSimplifiedXiaotong]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:o,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[x.ChineseMandarinSimplified]:{terminal:s.zh,terminalPinyin:s.zh,doorDirection:o,thanksForTaking:a==null?void 0:a.at(0),thanksForTakingPinyin:a==null?void 0:a.at(0)},[x.ChineseWuSimplifiedYunzhe]:{terminal:s.en,terminalPinyin:s.en,doorDirection:o,thanksForTaking:a==null?void 0:a.at(1),thanksForTakingPinyin:a==null?void 0:a.at(1)}},[O.Departure]:{[x.ChineseWuSimplifiedXiaotong]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:c,loop:u,loopTerminal:t,service:m},[x.ChineseMandarinSimplified]:{welcomeAbroad:a==null?void 0:a.at(0),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.zh,terminalPinyin:s.zh,nextDoorDirection:n,lineName:i[0],lineNamePinyin:i[0],noteLastTrain:c,loop:u,loopTerminal:t,service:m},[x.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:a==null?void 0:a.at(1),welcomeAbroadPinyin:a==null?void 0:a.at(0),terminal:s.en,terminalPinyin:s.en,nextDoorDirection:n,lineName:i[1],lineNamePinyin:i[1],service:m}},[O.Midway]:{[x.ChineseWuSimplifiedXiaotong]:{caution:d},[x.ChineseMandarinSimplified]:{caution:d},[x.ChineseWuSimplifiedYunzhe]:{}}}),le=s=>{for(const i in s)s[i]=s[i].replaceAll("\\"," ").replaceAll("\n"," ");return s},Bs=(s,i,o=ce.local)=>{var M,z,p;const n=structuredClone(ps),{line_name:a,stn_list:c,loop:d,direction:u}=s,t="left",m="left",f=fn(c).map(g=>g.slice(1,-1));u===ms.left&&f.forEach(g=>g.reverse());let r=(M=f.at(i))!=null?M:f.at(-1);o!==ce.local&&(r=r.filter(g=>c[g].services.includes(o)));const l=r,w=new Set(l.map(g=>c[g].services).flat()),S=l.at(-1),b=f.map(g=>g[g.length-1]).find(g=>g!==S),{localisedName:T}=c[S];le(T),n.baseVariants=Us(T,a,t,m,void 0,void 0,void 0,d?"inner":"none",!1,w.has(o)?o:ce.local);for(const[g,h]of l.entries()){const{localisedName:y}=c[h];if(le(y),n.metadata[h]={name:(z=Object.values(y).at(0))!=null?z:""},n.stations[h]={},n.stations[h][O.Midway]={[x.ChineseWuSimplifiedXiaotong]:{},[x.ChineseMandarinSimplified]:{},[x.ChineseWuSimplifiedYunzhe]:{}},g!==0&&(n.stations[h][O.Arrival]={[x.ChineseWuSimplifiedXiaotong]:{name:y.zh,namePinyin:y.zh},[x.ChineseMandarinSimplified]:{name:y.zh,namePinyin:y.zh},[x.ChineseWuSimplifiedYunzhe]:{name:y.en,namePinyin:y.en}}),g!==l.length-1||d){const V=d&&g===l.length-1?l[0]:l[g+1],{localisedName:U}=c[V];le(U);const I=c[V].transfer.groups.map(k=>{var R;return(R=k.lines)==null?void 0:R.map(W=>W.name)}).filter(k=>k!==void 0);if(n.stations[h][O.Departure]={[x.ChineseWuSimplifiedXiaotong]:{next:U.zh,nextPinyin:U.zh,int:I==null?void 0:I.map(k=>k==null?void 0:k.map(R=>R[0]))},[x.ChineseMandarinSimplified]:{next:U.zh,nextPinyin:U.zh,int:I==null?void 0:I.map(k=>k==null?void 0:k.map(R=>R[0]))},[x.ChineseWuSimplifiedYunzhe]:{welcomeAbroad:!1,next:U.en,nextPinyin:U.en,int:I==null?void 0:I.map(k=>k==null?void 0:k.map(R=>R[1])),noteLastTrain:!1}},b&&g+1<l.length&&((p=c[l[g+1]].branch)!=null&&p[u==="l"?tn.left:tn.right])){const{localisedName:k}=c[b];le(k),n.stations[h][O.Departure][x.ChineseWuSimplifiedXiaotong]={...n.stations[h][O.Departure][x.ChineseWuSimplifiedXiaotong],branchTerminalName:k.zh,branchTerminalNamePinyin:k.zh},n.stations[h][O.Departure][x.ChineseMandarinSimplified]={...n.stations[h][O.Departure][x.ChineseMandarinSimplified],branchTerminalName:k.zh,branchTerminalNamePinyin:k.zh},n.stations[h][O.Departure][x.ChineseWuSimplifiedYunzhe]={...n.stations[h][O.Departure][x.ChineseWuSimplifiedYunzhe],branchTerminalName:k.en,branchTerminalNamePinyin:k.en}}if(o!==ce.local){const R=l.slice(g+1,-1).map(W=>{const{localisedName:N}=c[W];return le(N),N});n.stations[h][O.Departure][x.ChineseWuSimplifiedXiaotong]={...n.stations[h][O.Departure][x.ChineseWuSimplifiedXiaotong],stopovers:R.map(W=>W.zh)},n.stations[h][O.Departure][x.ChineseMandarinSimplified]={...n.stations[h][O.Departure][x.ChineseMandarinSimplified],stopovers:R.map(W=>W.zh)},n.stations[h][O.Departure][x.ChineseWuSimplifiedYunzhe]={...n.stations[h][O.Departure][x.ChineseWuSimplifiedYunzhe],stopovers:R.map(W=>W.en)}}}}if(d){const g=l[0],{localisedName:h}=c[g];le(h),n.stations[g][O.Arrival]={[x.ChineseWuSimplifiedXiaotong]:{name:h.zh,namePinyin:h.zh,doorDirection:t},[x.ChineseMandarinSimplified]:{name:h.zh,namePinyin:h.zh,doorDirection:t},[x.ChineseWuSimplifiedYunzhe]:{name:h.en,namePinyin:h.en,doorDirection:t}}}return n},Gs=()=>{var f;const{t:s}=B(),i=G(),o=D.isAllowAnalytics(),{rmgParam:n,route:a,service:c}=E(r=>r.import),d=n?fn(n.stn_list).map(r=>[r.at(1),r.at(-2)]):[],u=n?d.map(r=>r.map(l=>Object.values(n.stn_list[l].localisedName).join(" "))):[],t=new Set(Object.values((f=n==null?void 0:n.stn_list)!=null?f:{}).map(r=>r.services).flat()),m=()=>{if(n){o&&D.event(Ce.IMPORT_RMG_PARAM);try{const r=Bs(structuredClone(n),a,c);i(mn(r)),i(xn(Object.keys(r.metadata)[0])),i(gn(O.Departure))}catch(r){i(Y({status:"error",message:s("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",r)}finally{i(rn()),i(an(0)),i(on(ce.local))}}};return e.jsxs($,{isOpen:n!==void 0,onClose:()=>i(rn()),size:"lg",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:s("import.title")}),e.jsx(Z,{color:"white"}),e.jsxs(Q,{py:3,children:[d.length===1&&t.size===1&&e.jsx(j,{children:s("import.goodToGo")}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(_,{fontSize:"md",mb:4,children:s("import.routes")}),e.jsx(Qe,{onChange:r=>i(an(Number(r))),value:a.toString(),children:e.jsx(We,{spacing:4,align:"stretch",children:u.map((r,l)=>e.jsx(L,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:a===l?"blue.500":"gray.200",children:e.jsx(Ne,{value:l.toString(),colorScheme:"blue",children:e.jsx(se,{align:"start",spacing:1,ml:2,children:e.jsx(j,{fontSize:"sm",children:r.join(" <=> ")})})})},l))})})]}),t.size>1&&e.jsxs(e.Fragment,{children:[e.jsx(_,{fontSize:"md",mb:4,children:s("import.services")}),e.jsx(Qe,{onChange:r=>i(on(r)),value:c,children:e.jsx(We,{spacing:4,align:"stretch",children:[...t].map(r=>e.jsx(L,{borderWidth:"1px",borderRadius:"lg",p:4,_hover:{borderColor:"blue.300",bg:"blue.50"},borderColor:c===r?"blue.500":"gray.200",children:e.jsx(Ne,{value:r,colorScheme:"blue",children:e.jsx(se,{align:"start",spacing:1,ml:2,children:e.jsx(j,{fontSize:"sm",children:s("import.service.".concat(r))})})})},r))})})]})]}),e.jsx(ve,{children:e.jsx(ue,{colorScheme:"teal",variant:"outline",onClick:m,children:s("import.import")})})]})]})},Fs="rmg-bridge--",Vs={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function _s(s){const{isOpen:i,onClose:o}=s,{t:n}=B(),a=G(),[c]=Le.useState(crypto.randomUUID()),d="/rmg/#/import?"+new URLSearchParams({parentComponent:D.getAppName(),parentId:c}),u=t=>{try{a(jn(t))}catch(m){a(Y({status:"error",message:n("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",m)}finally{o()}};return Le.useEffect(()=>{const t=new BroadcastChannel(Fs+c);return t.onmessage=m=>{const{event:f,data:r}=m.data;F.info("Received event from RMG app clip:",f),f==="CLOSE"?o():f==="IMPORT"&&u(r)},()=>t.close()},[]),e.jsx(xs,{isOpen:i,onClose:o,sx:Vs,children:e.jsx("iframe",{src:d,loading:"lazy"})})}function Ys(){const s=G(),{t:i}=B(),{preference:{import:{route:o,service:n}}}=E(r=>r.app),a=Ue(D.getEnv),c=C.useRef(null),d=C.useRef(null),[u,t]=C.useState(!1),m=async r=>{var w;const l=(w=r.target.files)==null?void 0:w[0];if(F.info("OpenActions.handleUpload():: received file",l),(l==null?void 0:l.type)!=="application/json")s(Y({status:"error",message:i("header.open.invalidType")})),F.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const S=await dn(l),b=JSON.parse(S);if(!("baseVariants"in b)){s(Y({status:"error",message:i("header.open.invalidType")})),F.error("OpenActions.handleUpload():: Not a valid RMA project."),r.target.value="";return}s(mn(b)),s(xn(Object.keys(b.metadata)[0])),s(gn(O.Departure))}catch(S){s(Y({status:"error",message:i("header.open.unknownError")})),F.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",S)}r.target.value=""},f=async r=>{var w;const l=(w=r.target.files)==null?void 0:w[0];if(F.info("OpenActions.handleUpload():: received file",l),(l==null?void 0:l.type)!=="application/json")s(Y({status:"error",message:i("header.open.invalidType")})),F.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const S=await dn(l);s(jn(JSON.parse(S)))}catch(S){s(Y({status:"error",message:i("header.open.unknownError")})),F.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",S)}r.target.value=""};return e.jsxs(Fe,{children:[e.jsx(Ve,{as:X,size:"sm",variant:"ghost",icon:e.jsx(Pe,{})}),e.jsxs(_e,{children:[e.jsx("input",{id:"upload_project",ref:c,type:"file",accept:".json",hidden:!0,onChange:m,"data-testid":"file-upload"}),e.jsx(te,{icon:e.jsx(Pe,{}),onClick:()=>{var r;return(r=c==null?void 0:c.current)==null?void 0:r.click()},children:i("header.open.config")}),e.jsx("input",{id:"upload_RMG",ref:d,type:"file",accept:".json",hidden:!0,onChange:f,"data-testid":"file-upload"}),a===Se.DEV&&e.jsx(te,{icon:e.jsx(Pe,{}),onClick:()=>{var r;return(r=d==null?void 0:d.current)==null?void 0:r.click()},children:i("header.open.RMG")}),e.jsx(te,{icon:e.jsx(gs,{}),onClick:()=>t(!0),children:i("header.open.projectRMG")})]}),e.jsx(_s,{isOpen:u,onClose:()=>t(!1)})]})}const dn=s=>new Promise(i=>{const o=new FileReader;o.onloadend=()=>i(o.result),o.readAsText(s)}),Xs=s=>{var M,z;const{isOpen:i,onClose:o}=s,{telemetry:{project:n},preference:{import:{route:a,service:c},previewAudio:d}}=E(p=>p.app),u=G(),{t}=B(),m=Ge("primary.500","primary.300"),{scale:f}=E(p=>p.crawl),r=pn(),[l,w]=C.useState({[x.ChineseMandarinSimplified]:[],[x.ChineseWuSimplifiedXiaotong]:[],[x.ChineseWuSimplifiedYunzhe]:[]});C.useEffect(()=>{w({[x.ChineseMandarinSimplified]:r.filter(p=>{var g,h;return p.lang===((h=(g=fe[ln.ShanghaiMetro])==null?void 0:g.defaultLang)==null?void 0:h[x.ChineseMandarinSimplified])}).map(p=>p.name),[x.ChineseWuSimplifiedXiaotong]:[],[x.ChineseWuSimplifiedYunzhe]:r.filter(p=>{var g,h;return p.lang===((h=(g=fe[ln.ShanghaiMetro])==null?void 0:g.defaultLang)==null?void 0:h[x.ChineseWuSimplifiedYunzhe])}).map(p=>p.name)})},[r]);const S=(p,g)=>{u(g==="undefined"?fs(p):bs([p,g]))},b=D.isAllowAnalytics(),T=p=>{u(ws(p))};return e.jsxs($,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(q,{children:t("header.settings.title")}),e.jsx(Z,{}),e.jsx(Q,{children:e.jsxs(se,{divider:e.jsx(In,{borderColor:"gray.200"}),children:[e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(_,{fontSize:"md",children:t("header.settings.crawl.title")}),e.jsx(L,{mt:"3",children:e.jsx(hn,{label:t("header.settings.crawl.scale"),children:e.jsx(un,{defaultValue:f,value:f,min:.1,max:1,step:.1,onThrottledChange:p=>u(js(p))})})})]}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(_,{fontSize:"md",children:t("header.settings.previewAudio.title")}),e.jsxs(L,{mt:"3",children:[e.jsxs(L,{mb:"1",display:"flex",children:[e.jsx(j,{flex:"1",children:t("header.settings.previewAudio.shmetro-zh")}),e.jsxs(en,{size:"xs",width:"300px",ml:"1",defaultValue:(M=d[x.ChineseMandarinSimplified])!=null?M:"undefined",onChange:({target:{value:p}})=>S(x.ChineseMandarinSimplified,p),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),l[x.ChineseMandarinSimplified].map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs(L,{mb:"1",display:"flex",children:[e.jsx(j,{flex:"1",children:t("header.settings.previewAudio.shmetro-en")}),e.jsxs(en,{size:"xs",width:"300px",ml:"1",defaultValue:(z=d[x.ChineseWuSimplifiedYunzhe])!=null?z:"undefined",onChange:({target:{value:p}})=>S(x.ChineseWuSimplifiedYunzhe,p),children:[e.jsx("option",{value:"undefined",children:t("header.settings.previewAudio.notModified")}),l[x.ChineseWuSimplifiedYunzhe].map(p=>e.jsx("option",{value:p,children:p},p))]})]})]})]}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(_,{fontSize:"md",children:t("header.settings.telemetry.title")}),e.jsxs(L,{mt:"3",children:[e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.info")}),e.jsxs(L,{mt:"3",mb:"1",children:[e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:t("header.settings.telemetry.essential")}),e.jsx(En,{label:t("header.settings.telemetry.essentialTooltip"),children:e.jsx(Ie,{isChecked:b,isDisabled:!0})})]}),e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.essentialInfo")}),e.jsxs(A,{color:m,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[t("header.settings.telemetry.essentialLink")," ",e.jsx(H,{as:P})]})]}),e.jsxs(L,{mt:"1",mb:"1",children:[e.jsxs(L,{display:"flex",children:[e.jsx(j,{flex:"1",children:t("header.settings.telemetry.additional")}),e.jsx(Ie,{isChecked:n,onChange:({target:{checked:p}})=>T(p)})]}),e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:t("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})};function $s(){const{t:s}=B();G();const i=D.isAllowAnalytics(),[o,n]=C.useState(!1),[a,c]=C.useState(!1),d=Ue(D.getEnv),u=Ue(D.getAppVersion);C.useEffect(()=>{i&&d!==Se.DEV&&D.event(Ce.APP_LOAD,{isStandaloneWindow:D.isStandaloneWindow()})},[d]);const t=m=>{D.getI18nInstance().changeLanguage(m)};return e.jsxs(zs,{children:[e.jsx(_,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rma")}),e.jsx(ks,{environment:d,version:u,popoverHeader:d===Se.PRD?void 0:e.jsxs(cn,{i18nKey:"header.popoverHeader",environment:d,children:["You're on ",{environment:d}," environment!"]}),popoverBody:d===Se.PRD?void 0:e.jsx(cn,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(Wn,{ml:"auto",children:[e.jsx(re,{children:e.jsx(Hs,{})}),e.jsx(re,{children:e.jsx(Ys,{})}),e.jsx(re,{children:e.jsx(Ls,{})}),e.jsx(re,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(Ss,{}),onClick:()=>n(!0)})}),D.isStandaloneWindow()&&e.jsx(re,{children:e.jsxs(Fe,{children:[e.jsx(Ve,{as:X,icon:e.jsx(vs,{}),variant:"ghost",size:"sm"}),e.jsx(_e,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(m=>e.jsx(te,{onClick:()=>t(m),children:As[m][m]},m))})]})}),e.jsx(re,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(Cs,{}),onClick:()=>c(!0)})})]}),e.jsx(Xs,{isOpen:o,onClose:()=>n(!1)}),e.jsx(Ps,{isOpen:a,onClose:()=>c(!1)}),e.jsx(Gs,{})]})}function Js(){const s=G(),i=E(n=>n.runtime.globalAlerts),o=n=>{D.isStandaloneWindow()?window.open("/".concat(n),"_blank"):D.openApp({appId:n})};return e.jsx(e.Fragment,{children:Object.entries(i).map(([n,{message:a,url:c,linkedApp:d}])=>e.jsxs(Ln,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(Un,{}),d?e.jsx(A,{onClick:()=>o(d),children:a}):c?e.jsx(A,{href:c,target:"_blank",children:a}):a,e.jsx(Bn,{ml:"auto",onClick:()=>s(Ts(n))})]},n))})}function Ns(){return e.jsxs(e.Fragment,{children:[e.jsx($s,{}),e.jsx(Js,{})]})}export{Ns as default};
